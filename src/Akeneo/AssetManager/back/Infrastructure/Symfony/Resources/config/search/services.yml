parameters:
   akeneo_assetmanager.infrastructure.search.elasticsearch.asset_indexer.batch_size: 1000

services:
    # Subscribers
    akeneo_assetmanager.infrastructure.search.elasticsearch.asset.index_asset_event_aggregator:
        class: Akeneo\AssetManager\Infrastructure\Search\Elasticsearch\Asset\IndexAssetEventAggregator
        arguments:
            - '@akeneo_assetmanager.infrastructure.search.elasticsearch.asset_indexer'
            - '@akeneo_assetmanager.infrastructure.symfony.command.index_by_asset_family_in_background'
        tags:
            - { name: kernel.event_subscriber }

    akeneo_assetmanager.infrastructure.search.elasticsearch.asset.subscriber.remove_asset_from_index:
        class: Akeneo\AssetManager\Application\Asset\Subscribers\RemoveAssetFromIndexSubscriber
        arguments:
            - '@akeneo_assetmanager.infrastructure.search.elasticsearch.asset_indexer'
        tags:
            - { name: kernel.event_subscriber }

  # Query builder
    akeneo_assetmanager.infrastructure.search.elasticsearch.query_builder:
      class: Akeneo\AssetManager\Infrastructure\Search\Elasticsearch\Asset\AssetQueryBuilder
      arguments:
        - '@akeneo_assetmanager.infrastructure.persistence.query.find_required_value_key_collection_for_channel_and_locales'
        - '@akeneo_assetmanager.infrastructure.persistence.query.get_value_key_for_attribute_channel_and_locale'
        - '@akeneo_assetmanager.infrastructure.persistence.repository.attribute'
        - '@akeneo_assetmanager.infrastructure.persistence.query.find_identifiers_by_asset_family_and_codes'

    # Indexers
    akeneo_assetmanager.infrastructure.search.elasticsearch.asset_indexer:
        class: Akeneo\AssetManager\Infrastructure\Search\Elasticsearch\Asset\AssetIndexer
        arguments:
            - '@akeneo_assetmanager.client.asset'
            - '@akeneo_assetmanager.infrastructure.search.elasticsearch.asset_normalizer'
            - '%akeneo_assetmanager.infrastructure.search.elasticsearch.asset_indexer.batch_size%'

    akeneo_assetmanager.infrastructure.search.elasticsearch.asset_indexer_temporary:
        class: Akeneo\AssetManager\Infrastructure\Search\Elasticsearch\Asset\AssetIndexer
        arguments:
            - '@akeneo_assetmanager.client.asset_temporary'
            - '@akeneo_assetmanager.infrastructure.search.elasticsearch.asset_normalizer'
            - '%akeneo_assetmanager.infrastructure.search.elasticsearch.asset_indexer.batch_size%'

    # Normalizers
    akeneo_assetmanager.infrastructure.search.elasticsearch.asset_normalizer:
        class: Akeneo\AssetManager\Infrastructure\Search\Elasticsearch\Asset\AssetNormalizer
        arguments:
            - '@akeneo_assetmanager.infrastructure.search.elasticsearch.asset.query.find_values_to_index_for_channel_and_locale'
            - '@akeneo_assetmanager.infrastructure.search.elasticsearch.asset.query.find_searchable_assets'
            - '@akeneo_assetmanager.infrastructure.persistence.query.find_value_keys_by_attribute_type'
            - '@akeneo_assetmanager.infrastructure.persistence.query.find_activated_locales'

    # Query function
    akeneo_assetmanager.infrastructure.search.elasticsearch.asset.query.find_activated_locales_per_channels:
        class: Akeneo\AssetManager\Infrastructure\Persistence\Sql\Channel\SqlFindActivatedLocalesPerChannels
        arguments:
            - '@database_connection'

    akeneo_assetmanager.infrastructure.search.elasticsearch.asset.query.find_identifiers_for_query:
        class: Akeneo\AssetManager\Infrastructure\Search\Elasticsearch\Asset\FindIdentifiersForQuery
        arguments:
            - '@akeneo_assetmanager.client.asset'
            - '@akeneo_assetmanager.infrastructure.search.elasticsearch.query_builder'

    akeneo_assetmanager.infrastructure.search.elasticsearch.asset.query.count_assets:
        class: Akeneo\AssetManager\Infrastructure\Search\Elasticsearch\Asset\CountAssets
        arguments:
            - '@akeneo_assetmanager.client.asset'

    akeneo_assetmanager.infrastructure.search.elasticsearch.asset.query.find_values_to_index_for_channel_and_locale:
       class: Akeneo\AssetManager\Infrastructure\Persistence\Sql\Attribute\SqlFindValueKeysToIndexForAllChannelsAndLocales
       arguments:
           - '@database_connection'
           - '@akeneoassetmanager.infrastructure.persistence.cache.query.find_activated_locales_per_channels'

    akeneo_assetmanager.infrastructure.search.elasticsearch.asset.query.find_searchable_assets:
       class: Akeneo\AssetManager\Infrastructure\Persistence\Sql\Asset\SqlFindSearchableAssets
       arguments:
           - '@database_connection'

    # Commands
    akeneo_assetmanager.infrastructure.symfony.command.index_by_asset_family_in_background:
        class: Akeneo\AssetManager\Infrastructure\Symfony\Command\IndexByAssetFamilyInBackground
        arguments:
            - '@pim_catalog.command_launcher'
