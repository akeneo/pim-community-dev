parameters:
    env(AKENEO_PIM_URL): ''
    env(PAPO_PROJECT_CODE_TRUNCATED): ''
    env(PAPO_PROJECT_CODE_HASHED): ''

services:

    Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Install\InitializeCriteriaEvaluation:
        public: true
        arguments:
            - '@akeneo.pim.automation.data_quality_insights.feature'
            - '@database_connection'
            - '@akeneo.pim.automation.data_quality_insights.create_products_criteria_evaluations'

    akeneo.pimee.automation.data_quality_insights.mark_product_criteria_to_evaluate:
        class: Akeneo\Pim\Automation\DataQualityInsights\Application\ProductEvaluation\PimEnterpriseMarkCriteriaToEvaluate
        decorates: akeneo.pim.automation.data_quality_insights.mark_product_criteria_to_evaluate
        decoration_inner_name: akeneo.pim.automation.data_quality_insights.mark_product_criteria_to_evaluate.community
        arguments:
            - '@akeneo.pim.automation.data_quality_insights.mark_product_criteria_to_evaluate.community'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Query\ProductEvaluation\GetProductIdsWithOutdatedAttributeSpellcheckQuery'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Query\ProductEvaluation\GetProductIdsWithUpdatedFamilyAttributesListQuery'
            - '@akeneo.pim.automation.data_quality_insights.query.get_product_ids_with_outdated_attribute_option_spellcheck'
            - '@akeneo.pim.automation.data_quality_insights.create_products_criteria_evaluations'

    akeneo.pimee.automation.data_quality_insights.mark_product_model_criteria_to_evaluate:
        class: Akeneo\Pim\Automation\DataQualityInsights\Application\ProductEvaluation\PimEnterpriseMarkCriteriaToEvaluate
        decorates: akeneo.pim.automation.data_quality_insights.mark_product_model_criteria_to_evaluate
        decoration_inner_name: akeneo.pim.automation.data_quality_insights.mark_product_model_criteria_to_evaluate.community
        arguments:
            - '@akeneo.pim.automation.data_quality_insights.mark_product_model_criteria_to_evaluate.community'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Query\ProductEvaluation\GetProductModelIdsWithOutdatedAttributeSpellcheckQuery'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Query\ProductEvaluation\GetProductModelIdsWithUpdatedFamilyAttributesListQuery'
            - '@akeneo.pim.automation.data_quality_insights.query.get_product_model_ids_with_outdated_attribute_option_spellcheck'
            - '@akeneo.pim.automation.data_quality_insights.create_product_models_criteria_evaluations'

    # PIM enrichment BC anti-corruption layers
    akeneo.pim.automation.calculate_product_model_completeness_of_required_attributes:
        class: Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Enrichment\CalculateProductModelCompleteness
        arguments:
            - '@akeneo.pim.enrichment.completeness.query.get_product_masks'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Query\Completeness\GetRequiredProductModelAttributesMaskQuery'
            - '@pim_catalog.repository.product_model_without_permission'

    akeneo.pim.automation.calculate_product_model_completeness_of_non_required_attributes:
        class: Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Enrichment\CalculateProductModelCompleteness
        arguments:
            - '@akeneo.pim.enrichment.completeness.query.get_product_masks'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Query\Completeness\GetNonRequiredProductModelAttributesMaskQuery'
            - '@pim_catalog.repository.product_model_without_permission'

    Akeneo\Pim\Automation\DataQualityInsights\Application\Spellcheck\TextChecker: '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Spellcheck\Checker'

    Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Spellcheck\Checker:
        arguments:
            $spellerProvider: '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Spellcheck\TigitzSpeller'

    akeneo.pimee.automation.data_quality_insights.tigitz.aspell_speller:
        class: 'PhpSpellcheck\Spellchecker\Aspell'
        factory: ['PhpSpellcheck\Spellchecker\Aspell', 'create']
        arguments:
            - '%env(ASPELL_BINARY_PATH)%'

    Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Spellcheck\TigitzSpeller:
        arguments:
            - '@akeneo.pimee.automation.data_quality_insights.tigitz.aspell_speller'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Spellcheck\Result\AspellGlobalOffsetCalculator'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Spellcheck\Result\AspellLineNumberCalculator'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Repository\TextCheckerDictionaryRepository'

    Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Spellcheck\MultipleChecker:
        arguments:
            $checker: '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Spellcheck\Checker'
            $globalOffsetCalculator: '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Spellcheck\Result\AspellGlobalOffsetCalculator'

    Akeneo\Pim\Automation\DataQualityInsights\Application\Spellcheck\SupportedLocaleValidator: '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Spellcheck\SupportedLocale\ChainedSupportedLocaleValidator'
    Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Spellcheck\SupportedLocale\SupportedPrefixLocaleValidator:
        arguments:
            $allActivatedLocalesQuery: '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Query\Structure\CachedGetAllActivatedLocalesQuery'
        tags:
            - { name: pimee_data_quality_insights.inner_supported_locale_validator }
    Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Spellcheck\SupportedLocale\SupportedPortugueseLocaleValidator:
        arguments:
            $allActivatedLocalesQuery: '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Query\Structure\CachedGetAllActivatedLocalesQuery'
        tags:
            - { name: pimee_data_quality_insights.inner_supported_locale_validator }
    Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Spellcheck\SupportedLocale\ChainedSupportedLocaleValidator:
        arguments:
            $supportedLocaleValidatorList: !tagged pimee_data_quality_insights.inner_supported_locale_validator

    Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Spellcheck\Result\AspellGlobalOffsetCalculator: ~
    Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Spellcheck\Result\AspellLineNumberCalculator: ~

    Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Spellcheck\ProductValueInDatabaseDictionarySource:
        public: true
        arguments:
            $db: '@database_connection'

    Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Spellcheck\AspellDictionaryLocalFilesystem: ~

    Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Spellcheck\AspellDictionary:
        arguments:
            $filesystemProvider: '@akeneo_file_storage.file_storage.filesystem_provider'
            $clock: '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Clock\SystemClock'
            $localFilesystemProvider: '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Spellcheck\AspellDictionaryLocalFilesystem'
            $supportedLocaleValidator: '@Akeneo\Pim\Automation\DataQualityInsights\Application\Spellcheck\SupportedLocaleValidator'

    Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Spellcheck\AspellDictionaryGenerator:
        public: true
        arguments:
            $aspellDictionary: '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Spellcheck\AspellDictionary'
            $supportedLocaleValidator: '@Akeneo\Pim\Automation\DataQualityInsights\Application\Spellcheck\SupportedLocaleValidator'
            $clock: '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Clock\SystemClock'

    # Structure Evaluation
    Akeneo\Pim\Automation\DataQualityInsights\Application\StructureEvaluation\EvaluateAttributeLabelsSpelling:
        arguments:
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Query\Structure\GetAttributeLabelsQuery'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Application\Spellcheck\SupportedLocaleValidator'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Application\Spellcheck\TextChecker'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Clock\SystemClock'
            - '@logger'

    Akeneo\Pim\Automation\DataQualityInsights\Application\StructureEvaluation\EvaluateUpdatedAttributes:
        arguments:
            - '@Akeneo\Pim\Automation\DataQualityInsights\Application\StructureEvaluation\EvaluateAttributeLabelsSpelling'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Repository\AttributeSpellcheckRepository'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Query\Structure\GetAttributesCodesToEvaluateQuery'
            - '@event_dispatcher'

    Akeneo\Pim\Automation\DataQualityInsights\Application\StructureEvaluation\EvaluateAttributeOptionLabelsSpelling:
        arguments:
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Query\Structure\GetAttributeOptionLabelsQuery'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Application\Spellcheck\SupportedLocaleValidator'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Application\Spellcheck\TextChecker'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Clock\SystemClock'
            - '@logger'

    Akeneo\Pim\Automation\DataQualityInsights\Application\StructureEvaluation\EvaluateUpdatedAttributeOptions:
        arguments:
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Repository\AttributeOptionSpellcheckRepository'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Application\StructureEvaluation\EvaluateAttributeOptionLabelsSpelling'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Query\Structure\GetAttributeOptionCodesToEvaluateQuery'
            - '@event_dispatcher'

    Akeneo\Pim\Automation\DataQualityInsights\Application\StructureEvaluation\ConsolidateAttributeQuality:
        arguments:
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Query\Structure\CachedGetAllActivatedLocalesQuery'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Query\Structure\GetAttributeSpellcheckQuery'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Query\Structure\GetAttributeOptionSpellcheckQuery'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Repository\AttributeQualityRepository'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Repository\AttributeLocaleQualityRepository'

    Akeneo\Pim\Automation\DataQualityInsights\Application\Spellcheck\Dictionary\IgnoreWord:
        arguments:
            $supportedLocaleValidator: '@Akeneo\Pim\Automation\DataQualityInsights\Application\Spellcheck\SupportedLocaleValidator'
            $textCheckerDictionaryRepository: '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Repository\TextCheckerDictionaryRepository'

    Akeneo\Pim\Automation\DataQualityInsights\Application\Spellcheck\Dictionary\IgnoreWordForProduct:
        arguments:
            $ignoreWord: '@Akeneo\Pim\Automation\DataQualityInsights\Application\Spellcheck\Dictionary\IgnoreWord'
            $eventDispatcher: '@event_dispatcher'

    Akeneo\Pim\Automation\DataQualityInsights\Application\Spellcheck\Dictionary\IgnoreWordForProductModel:
        arguments:
            $ignoreWord: '@Akeneo\Pim\Automation\DataQualityInsights\Application\Spellcheck\Dictionary\IgnoreWord'
            $eventDispatcher: '@event_dispatcher'

    Akeneo\Pim\Automation\DataQualityInsights\Application\Spellcheck\Dictionary\IgnoreWordForAttribute:
        arguments:
            $ignoreWord: '@Akeneo\Pim\Automation\DataQualityInsights\Application\Spellcheck\Dictionary\IgnoreWord'
            $eventDispatcher: '@event_dispatcher'

    Akeneo\Pim\Automation\DataQualityInsights\Application\Spellcheck\Dictionary\IgnoreWordForAttributeOption:
        arguments:
            $ignoreWord: '@Akeneo\Pim\Automation\DataQualityInsights\Application\Spellcheck\Dictionary\IgnoreWord'
            $eventDispatcher: '@event_dispatcher'

    Akeneo\Pim\Automation\DataQualityInsights\Application\GetAttributeSpellcheckEvaluation:
        arguments:
            $attributeOptionsSpellcheckQuery: '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Query\Structure\GetAllAttributeOptionsSpellcheckQuery'
            $attributeSpellcheckQuery: '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Query\Structure\GetAttributeSpellcheckQuery'

    Akeneo\Pim\Automation\DataQualityInsights\Application\GetNumberOfProductsImpactedByAttributeOrOptionsSpellingMistakes:
        arguments:
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Query\Structure\GetAttributeQuery'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Query\Structure\GetNumberOfProductsImpactedByAttributeSpellingMistakesQuery'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Elasticsearch\Query\GetNumberOfProductsImpactedByAttributeOptionSpellingMistakesQuery'

    akeneo.pim.automation.data_quality_insights.synchronous_criterion_evaluations_filter:
        class: Akeneo\Pim\Automation\DataQualityInsights\Application\ProductEvaluation\PimEnterpriseSynchronousCriterionEvaluationsFilter

    akeneo.pimee.automation.data_quality_insights.get_key_indicators:
        class: Akeneo\Pim\Automation\DataQualityInsights\Application\PimEnterpriseGetKeyIndicators
        decorates: akeneo.pim.automation.data_quality_insights.get_key_indicators
        decoration_inner_name: akeneo.pim.automation.data_quality_insights.get_key_indicators.community
        arguments:
            - '@akeneo.pim.automation.data_quality_insights.get_key_indicators.community'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Query\KeyIndicator\ComputeAttributesWithPerfectSpellingQuery'
            - '@akeneo.pim.automation.data_quality_insights.all_criteria.feature'

    Akeneo\Pim\Automation\DataQualityInsights\Application\StructureEvaluation\EvaluateFamilyAttributesSpelling:
        arguments:
            - '@Akeneo\Pim\Automation\DataQualityInsights\Application\ProductEvaluation\Consistency\EvaluateAttributeSpelling'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Query\Structure\GetActivatedFamilyAttributesCodesQuery'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Repository\FamilyCriterionEvaluationRepository'
