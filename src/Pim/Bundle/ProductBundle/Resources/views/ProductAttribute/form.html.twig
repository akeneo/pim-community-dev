{% extends 'PimProductBundle::layout.html.twig' %}

{% block content %}
    {{ JSFV(form) }}
    <form id="{{ form.vars.id }}" class="form-horizontal" action="{{ form.vars.value.id ?
        path('pim_product_productattribute_edit', { id: form.vars.value.id }) :
        path('pim_product_productattribute_create') }}" method="POST">

        {% set title = 'Attributes'|trans %}

        {% set buttons %}
            {{ elements.link(null, path('pim_product_productattribute_index'), { title: 'Back to grid'|trans, icon: 'chevron-left'}) }}
            {% if form.vars.value.id and form.attributeType.vars.value != 'pim_product_identifier' %}
                {{ elements.link('Delete', path("pim_product_productattribute_remove", { id: form.vars.value.id }), { icon: 'trash', attr: { 'data-dialog': 'confirm', 'data-title': 'Delete confirmation'|trans, 'data-message': 'Are you sure you want to delete this attribute?'|trans }}) }}
            {% endif %}
            {{ elements.submitBtn }}
        {% endset %}

        {% set subtitle = form.vars.value.id ? form.vars.value.code : 'New attribute'|trans %}

        {% set left %}
            {% if form.vars.value.id %}
                <ul class="inline">
                   <li>{{ 'Last update'|trans }}: {{ form.vars.value.updated|date("Y-m-d") }}</li>
                   <li>{{ 'Created'|trans }}: {{ form.vars.value.created|date("Y-m-d") }}</li>
               </ul>
            {% endif %}
        {% endset %}

        {{ elements.page_header(title, buttons, subtitle, left) }}

        {% set tabs = form.vars.value.id ? ['Parameters', 'Values', 'History'] : ['Parameters', 'Values'] %}

        {{ elements.form_navbar(tabs) }}

        <div class="row-fluid tab-content">

            {{ elements.form_errors(form) }}

            <div class="tab-pane active" id="parameters">
                {% include 'PimProductBundle:ProductAttribute:_form_parameters.html.twig' with {'form': form} %}
            </div>

            <div class="tab-pane" id="values">
                {% include 'PimProductBundle:ProductAttribute:_form_values.html.twig' with {'form': form} %}
            </div>

            {% if form.vars.value.id %}
                <div class="tab-pane" id="history">
                    <div id="history-grid"></div>
                </div>
            {% endif %}

            {{ form_row(form.id) }}
            {{ form_row(form._token) }}
        </div>
    </form>
{% endblock %}

{% block head_script_component %}
    {{ parent() }}
    <script type="text/javascript" src="{{ asset('bundles/pimui/js/bootstrap-datetimepicker.min.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/oroui/lib/backbone.bootstrap-modal.js') }}"></script>
    <script type="text/javascript">
        {% include 'PimUIBundle::measures.html.twig' with measures %}
        {% include 'PimProductBundle:ProductAttribute:_js-handler.html.twig' %}
    </script>
    {% if form.vars.value.id %}
        {% include 'OroGridBundle:Include:javascript.html.twig' with {'datagridView': datagrid, 'selector': '#history-grid'} %}
    {% endif %}
{% endblock %}
