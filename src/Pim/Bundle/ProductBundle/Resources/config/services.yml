services:
    # Attribute property types
    pim_product.form.type.scopable:
        class: %pim_product.form.type.attribute_property_scopable.class%
        tags:
            - { name: form.type, alias: pim_product_scopable }

    pim_product.form.type.available_locales:
        class: %pim_product.form.type.attribute_property_available_locale.class%
        tags:
            - { name: form.type, alias: pim_product_available_locales }

    pim_product.form.type.options:
        class: %pim_product.form.type.attribute_property_options.class%
        tags:
            - { name: form.type, alias: pim_product_options }

    pim_product.form.type.image:
        class: %pim_product.form.type.image.class%
        tags:
            - { name: form.type, alias: pim_image }

    # Subscribers
    pim_product.form.subscriber.attribute:
        class:     %pim_product.subscriber.add_attribute_type.class%
        arguments: [@pim_product.manager.attribute_type, @oro_flexibleentity.attributetype.factory]

    pim_product.event_listener.user_preferences:
        class: %pim_product.event_listener.user_preferences.class%
        calls:
            - [ setContainer, [ @service_container ] ]
        tags:
            - { name: doctrine.event_subscriber }

    # Validators
    pim_product.form.validator.metric:
        class: Pim\Bundle\ProductBundle\Validator\Constraints\ValidMetricValidator
        arguments: [%oro_measure.measures_config%]
        tags:
            - { name: validator.constraint_validator, alias: pim_metric_validator }

    pim_product.form.validator.single_identifier_attribute:
        class: Pim\Bundle\ProductBundle\Validator\Constraints\SingleIdentifierAttributeValidator
        arguments:
            - @pim_product.manager.product
        tags:
            - { name: validator.constraint_validator, alias: pim_single_identifier_attribute_validator }

    pim_product.validator.constraints.unique_value:
        class: Pim\Bundle\ProductBundle\Validator\Constraints\UniqueValueValidator
        arguments:
            - @doctrine
        tags:
            - { name: validator.constraint_validator, alias: pim_unique_value_validator }

    pim_product.validator.valid_locale_fallback:
        class: Pim\Bundle\ProductBundle\Validator\Constraints\ValidLocaleFallbackValidator
        arguments:
            - @doctrine.orm.entity_manager
        tags:
            - { name: validator.constraint_validator, alias: pim_product.validator.valid_locale_fallback_validator }

    # Locale helper
    pim_product.helper.locale:
        class: Pim\Bundle\ProductBundle\Helper\LocaleHelper
        arguments:
            - @pim_product.manager.locale

    # twig extension
    pim_product.twig.product_extension:
        class: Pim\Bundle\ProductBundle\Twig\ProductExtension
        arguments:
            - @security.context
            - @pim_product.manager.locale
        tags:
            - { name: twig.extension }

    pim_product.twig.locale_extension:
        class: Pim\Bundle\ProductBundle\Twig\LocaleExtension
        arguments:
            - @pim_product.helper.locale
        tags:
            - { name: twig.extension }

    pim_product.twig.completeness_extension:
        class: Pim\Bundle\ProductBundle\Twig\CompletenessExtension
        tags:
            - { name: twig.extension }

    # extension listener
    stof_doctrine_extensions.event_listener.locale:
        class: %pim_product.listener.user_context.class%
        arguments:
            - @security.context
            - @pim_translation.listener.add_locale
            - @pim_product.manager.product
        tags:
            - { name: kernel.event_subscriber }

    # Product completeness calculator
    pim_product.calculator.completeness:
      class: %pim_product.calculator.completeness.class%
      arguments:
          - @pim_product.manager.channel
          - @pim_product.manager.locale
          - @doctrine.orm.entity_manager
