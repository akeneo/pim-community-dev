services:
    akeneo_enrichedentity.event_subscriber.installer:
        class: 'Akeneo\EnrichedEntity\Infrastructure\Symfony\EventListener\Installer'
        arguments:
            - '@filesystem'
            - '%kernel.project_dir%'
            - '@doctrine.dbal.default_connection'
            - '@akeneo_file_storage.file_storage.file.file_storer'
        tags:
            - { name: kernel.event_subscriber }

    akeneo_enrichedentity.infrastructure.persistence.enriched_entity:
        class: 'Akeneo\EnrichedEntity\Infrastructure\Persistence\Sql\EnrichedEntity\SqlEnrichedEntityRepository'
        arguments:
            - '@database_connection'

    akeneo_enrichedentity.infrastructure.action.record.index:
        class: 'Akeneo\EnrichedEntity\Infrastructure\Controller\Record\IndexAction'
        arguments:
          - '@akeneo_enrichedentity.infrastructure.persistence.query.find_record_items_for_enriched_entity'

    akeneo_enrichedentity.infrastructure.action.record.get:
        class: 'Akeneo\EnrichedEntity\Infrastructure\Controller\Record\GetAction'
        arguments:
            - '@akeneo_enrichedentity.infrastructure.persistence.query.find_record_details'

    akeneo_enrichedentity.infrastructure.action.record.edit:
        class: 'Akeneo\EnrichedEntity\Infrastructure\Controller\Record\EditAction'
        arguments:
            - '@akeneo_enrichedentity.application.enriched_entity.edit_record_handler'
            - '@validator'

    akeneo_enrichedentity.infrastructure.action.record.create:
        class: 'Akeneo\EnrichedEntity\Infrastructure\Controller\Record\CreateAction'
        arguments:
            - '@akeneo_enrichedentity.application.enriched_entity.create_record_handler'
            - '@enriched_entity_serializer'
            - '@validator'
            - '@oro_security.security_facade'

    akeneo_enrichedentity.infrastructure.action.attribute.index:
        class: 'Akeneo\EnrichedEntity\Infrastructure\Controller\Attribute\IndexAction'
        arguments:
            - '@akeneo_enrichedentity.infrastructure.persistence.query.find_attributes_details'
            - '@akeneo_enrichedentity.infrastructure.persistence.query.enriched_entity_exists'

    akeneo_enrichedentity.infrastructure.action.attribute.create:
        class: 'Akeneo\EnrichedEntity\Infrastructure\Controller\Attribute\CreateAction'
        arguments:
            - '@akeneo_enrichedentity.application.enriched_entity.create_attribute_handler'
            - '@akeneo_enrichedentity.infrastructure.persistence.query.find_attribute_next_order'
            - '@akeneo_enrichedentity.application.registry.create_attribute_command_factory_registry'
            - '@serializer'
            - '@validator'
            - '@oro_security.security_facade'

    akeneo_enrichedentity.infrastructure.action.attribute.edit:
        class: 'Akeneo\EnrichedEntity\Infrastructure\Controller\Attribute\EditAction'
        arguments:
            - '@akeneo_enrichedentity.application.factory.edit_attribute_command_factory'
            - '@akeneo_enrichedentity.application.attribute.edit_attribute.edit_attribute_handler'
            - '@serializer'
            - '@validator'
            - '@oro_security.security_facade'

    akeneo_enrichedentity.infrastructure.persistence.record:
        class: 'Akeneo\EnrichedEntity\Infrastructure\Persistence\Sql\Record\SqlRecordRepository'
        arguments:
            - '@database_connection'

    akeneo_enrichedentity.infrastructure.persistence.attribute:
        class: 'Akeneo\EnrichedEntity\Infrastructure\Persistence\Sql\Attribute\SqlAttributeRepository'
        arguments:
            - '@database_connection'

    akeneo_enrichedentity.infrastructure.persistence.query.find_record_items_for_enriched_entity:
        class: 'Akeneo\EnrichedEntity\Infrastructure\Persistence\Sql\Record\SqlFindRecordItemsForEnrichedEntity'
        arguments:
            - '@database_connection'

    akeneo_enrichedentity.infrastructure.persistence.query.find_record_details:
        class: 'Akeneo\EnrichedEntity\Infrastructure\Persistence\Sql\Record\SqlFindRecordDetails'
        arguments:
            - '@database_connection'

    akeneo_enrichedentity.infrastructure.persistence.query.enriched_entity_exists:
        class: 'Akeneo\EnrichedEntity\Infrastructure\Persistence\Sql\EnrichedEntity\SqlEnrichedEntityExists'
        arguments:
            - '@database_connection'

    akeneo_enrichedentity.infrastructure.persistence.query.record_exists:
        class: 'Akeneo\EnrichedEntity\Infrastructure\Persistence\Sql\Record\SqlRecordExists'
        arguments:
            - '@database_connection'

    akeneo_enrichedentity.infrastructure.persistence.query.find_enriched_entity_items:
        class: 'Akeneo\EnrichedEntity\Infrastructure\Persistence\Sql\EnrichedEntity\SqlFindEnrichedEntityItems'
        arguments:
            - '@database_connection'

    akeneo_enrichedentity.infrastructure.persistence.query.find_enriched_entity_details:
        class: 'Akeneo\EnrichedEntity\Infrastructure\Persistence\Sql\EnrichedEntity\SqlFindEnrichedEntityDetails'
        arguments:
            - '@database_connection'

    akeneo_enrichedentity.infrastructure.persistence.query.attribute_exists:
        class: 'Akeneo\EnrichedEntity\Infrastructure\Persistence\Sql\Attribute\SqlAttributeExists'
        arguments:
            - '@database_connection'

    akeneo_enrichedentity.infrastructure.persistence.query.find_attribute_next_order:
        class: 'Akeneo\EnrichedEntity\Infrastructure\Persistence\Sql\Attribute\SqlFindAttributeNextOrder'
        arguments:
            - '@database_connection'

    akeneo_enrichedentity.infrastructure.persistence.query.find_attributes_details:
        class: 'Akeneo\EnrichedEntity\Infrastructure\Persistence\Sql\Attribute\SqlFindAttributesDetails'
        arguments:
            - '@database_connection'

    akeneo_enrichedentity.infrastructure.persistence.query.enriched_entity_has_records:
        class: 'Akeneo\EnrichedEntity\Infrastructure\Persistence\Sql\EnrichedEntity\SqlEnrichedEntityHasRecords'
        arguments:
            - '@database_connection'

    akeneo_enrichedentity.infrastructure.persistence.query.enriched_entity_is_linked_to_at_least_one_product_attribute:
        class: 'Akeneo\EnrichedEntity\Infrastructure\Persistence\Sql\EnrichedEntity\SqlEnrichedEntityIsLinkedToAtLeastOneProductAttribute'
        arguments:
            - '@database_connection'

    akeneo_enrichedentity.application.enriched_entity.edit_enriched_entity_handler:
        class: 'Akeneo\EnrichedEntity\Application\EnrichedEntity\EditEnrichedEntity\EditEnrichedEntityHandler'
        arguments:
            - '@akeneo_enrichedentity.infrastructure.persistence.enriched_entity'
            - '@akeneo_file_storage.file_storage.file.file_storer'

    akeneo_enrichedentity.application.enriched_entity.edit_record_handler:
        class: 'Akeneo\EnrichedEntity\Application\Record\EditRecord\EditRecordHandler'
        arguments:
            - '@akeneo_enrichedentity.infrastructure.persistence.record'

    akeneo_enrichedentity.application.enriched_entity.create_enriched_entity_handler:
        class: 'Akeneo\EnrichedEntity\Application\EnrichedEntity\CreateEnrichedEntity\CreateEnrichedEntityHandler'
        arguments:
            - '@akeneo_enrichedentity.infrastructure.persistence.enriched_entity'

    akeneo_enrichedentity.application.enriched_entity.delete_enriched_entity_handler:
        class: 'Akeneo\EnrichedEntity\Application\EnrichedEntity\DeleteEnrichedEntity\DeleteEnrichedEntityHandler'
        arguments:
            - '@akeneo_enrichedentity.infrastructure.persistence.enriched_entity'

    akeneo_enrichedentity.application.enriched_entity.create_record_handler:
        class: 'Akeneo\EnrichedEntity\Application\Record\CreateRecord\CreateRecordHandler'
        arguments:
            - '@akeneo_enrichedentity.infrastructure.persistence.record'

    akeneo_enrichedentity.application.enriched_entity.create_attribute_handler:
        class: 'Akeneo\EnrichedEntity\Application\Attribute\CreateAttribute\CreateAttributeHandler'
        arguments:
            - '@akeneo_enrichedentity.application.registry.attribute_factory'
            - '@akeneo_enrichedentity.infrastructure.persistence.attribute'

    akeneo_enrichedentity.application.enriched_entity.delete_attribute_handler:
        class: 'Akeneo\EnrichedEntity\Application\Attribute\DeleteAttribute\DeleteAttributeHandler'
        arguments:
            - '@akeneo_enrichedentity.infrastructure.persistence.attribute'

    akeneo_enrichedentity.application.attribute.edit_attribute.edit_attribute_handler:
        class: 'Akeneo\EnrichedEntity\Application\Attribute\EditAttribute\EditAttributeHandler'
        arguments:
            - '@akeneo_enrichedentity.application.edit_attribute.attribute_updater.attribute_updater_registry'
            - '@akeneo_enrichedentity.infrastructure.persistence.attribute'

    # Attribute updaters
    akeneo_enrichedentity.application.edit_attribute.attribute_updater.attribute_updater_registry:
        class: 'Akeneo\EnrichedEntity\Application\Attribute\EditAttribute\AttributeUpdater\AttributeUpdaterRegistry'

    akeneo_enrichedentity.application.edit_attribute.attribute_updater.labels_updater:
        class: 'Akeneo\EnrichedEntity\Application\Attribute\EditAttribute\AttributeUpdater\LabelsUpdater'
        tags:
            - { name: akeneo_enrichedentity.attribute_updater, priority: 120 }

    akeneo_enrichedentity.application.edit_attribute.attribute_updater.is_required_updater:
        class: 'Akeneo\EnrichedEntity\Application\Attribute\EditAttribute\AttributeUpdater\IsRequiredUpdater'
        tags:
            - { name: akeneo_enrichedentity.attribute_updater, priority: 120 }

    akeneo_enrichedentity.application.edit_attribute.attribute_updater.max_length_updater:
        class: 'Akeneo\EnrichedEntity\Application\Attribute\EditAttribute\AttributeUpdater\MaxLengthUpdater'
        tags:
            - { name: akeneo_enrichedentity.attribute_updater, priority: 120 }

    akeneo_enrichedentity.application.edit_attribute.attribute_updater.is_text_area:
        class: 'Akeneo\EnrichedEntity\Application\Attribute\EditAttribute\AttributeUpdater\IsTextAreaUpdater'
        tags:
            - { name: akeneo_enrichedentity.attribute_updater, priority: 120 }

    akeneo_enrichedentity.application.edit_attribute.attribute_updater.validation_rule:
        class: 'Akeneo\EnrichedEntity\Application\Attribute\EditAttribute\AttributeUpdater\ValidationRuleUpdater'
        tags:
            - { name: akeneo_enrichedentity.attribute_updater, priority: 110 }

    akeneo_enrichedentity.application.edit_attribute.attribute_updater.regular_expression:
        class: 'Akeneo\EnrichedEntity\Application\Attribute\EditAttribute\AttributeUpdater\RegularExpressionUpdater'
        tags:
            - { name: akeneo_enrichedentity.attribute_updater, priority: 100 }

    akeneo_enrichedentity.application.edit_attribute.attribute_updater.is_rich_text_editor:
        class: 'Akeneo\EnrichedEntity\Application\Attribute\EditAttribute\AttributeUpdater\IsRichTextEditorUpdater'
        tags:
            - { name: akeneo_enrichedentity.attribute_updater, priority: 110 }

    akeneo_enrichedentity.application.edit_attribute.attribute_updater.max_file_size_updater:
        class: 'Akeneo\EnrichedEntity\Application\Attribute\EditAttribute\AttributeUpdater\MaxFileSizeUpdater'
        tags:
            - { name: akeneo_enrichedentity.attribute_updater, priority: 110 }

    akeneo_enrichedentity.application.edit_attribute.attribute_updater.allowed_extensions_updater:
        class: 'Akeneo\EnrichedEntity\Application\Attribute\EditAttribute\AttributeUpdater\AllowedExtensionsUpdater'
        tags:
            - { name: akeneo_enrichedentity.attribute_updater, priority: 110 }
