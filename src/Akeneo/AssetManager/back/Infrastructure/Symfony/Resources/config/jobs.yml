services:
    akeneo_assetmanager.infrastructure.job.product_link_rule_launcher:
        class: 'Akeneo\AssetManager\Infrastructure\Job\ProductLinkRuleLauncher'
        arguments:
            - '@akeneo_batch_queue.queue.publish_job_to_queue'

    akeneo_assetmanager.infrastructure.job.compute_transformations_from_asset_identifiers_launcher:
        class: Akeneo\AssetManager\Infrastructure\Job\ComputeTransformationFromAssetIdentifiersLauncher
        arguments:
            - '@akeneo_batch_queue.queue.publish_job_to_queue'
            - '@security.token_storage'

    akeneo_assetmanager.infrastructure.job.compute_transformations_from_asset_family_identifier_launcher:
        class: Akeneo\AssetManager\Infrastructure\Job\ComputeTransformationFromAssetFamilyIdentifierLauncher
        arguments:
            - '@akeneo_batch_queue.queue.publish_job_to_queue'
            - '@security.token_storage'

    akeneo_assetmanager.infrastructure.job.provider.link_assets_to_products:
        class: 'Akeneo\AssetManager\Infrastructure\Job\Provider\LinkAssetsToProducts'
        tags:
            - { name: akeneo_batch.job.job_parameters.constraint_collection_provider }
            - { name: akeneo_batch.job.job_parameters.default_values_provider }

    akeneo_assetmanager.infrastructure.job.provider.compute_transformations:
        class: 'Akeneo\AssetManager\Infrastructure\Job\Provider\ComputeTransformations'
        tags:
            - { name: akeneo_batch.job.job_parameters.constraint_collection_provider }
            - { name: akeneo_batch.job.job_parameters.default_values_provider }

    # JOBS
    akeneo_assetmanager.job.link_assets_to_products:
        class: '%pim_connector.job.simple_job.class%'
        arguments:
            - 'asset_manager_link_assets_to_products'
            - '@event_dispatcher'
            - '@akeneo_batch.job_repository'
            -
                - '@akeneo_assetmanager.step.link_assets_to_products'
        tags:
            - { name: akeneo_batch.job, connector: 'internal', type: 'akeneo_assetmanager.link_assets_to_products' }

    akeneo_assetmanager.job.compute_transformations:
        class: '%pim_connector.job.simple_job.class%'
        arguments:
            - 'asset_manager_compute_transformations'
            - '@event_dispatcher'
            - '@akeneo_batch.job_repository'
            - [ '@akeneo_assetmanager.step.compute_transformations' ]
        tags:
            - { name: akeneo_batch.job, connector: 'internal', type: 'akeneo_assetmanager.compute_transformations' }

    # STEPS
    akeneo_assetmanager.step.link_assets_to_products:
        class: '%pim_connector.step.tasklet.class%'
        arguments:
            - 'link_assets_to_products'
            - '@event_dispatcher'
            - '@akeneo_batch.job_repository'
            - '@akeneo_assetmanager.tasklet.link_assets_to_products'
        public: false

    akeneo_assetmanager.step.compute_transformations:
        class: '%pim_connector.step.tasklet.class%'
        arguments:
            - 'compute_transformations'
            - '@event_dispatcher'
            - '@akeneo_batch.job_repository'
            - '@akeneo_assetmanager.tasklet.compute_transformations'
        public: false

    # TASKLETS
    akeneo_assetmanager.tasklet.link_assets_to_products:
        class: 'Akeneo\AssetManager\Infrastructure\Job\LinkAssetsToProductsTasklet'
        arguments:
            - '@akeneo_assetmanager.application.asset.execute_rule_templates.rule_template_executor'
        public: false

    akeneo_assetmanager.tasklet.compute_transformations:
        class: 'Akeneo\AssetManager\Infrastructure\Job\ComputeTransformations'
        arguments:
            - '@akeneo_assetmanager.infrastructure.persistence.query.find_identifiers_by_asset_family'
            - '@Akeneo\AssetManager\Infrastructure\Persistence\Sql\AssetFamily\SqlGetTransformations'
            - '@akeneo_assetmanager.infrastructure.persistence.repository.asset'
            - '@akeneo_assetmanager.infrastructure.transformation.get_outdated_variation_source'
            - '@Akeneo\AssetManager\Infrastructure\Transformation\TransformationExecutor'
            - '@akeneo_assetmanager.application.asset.edit_asset_handler'
        public: false
