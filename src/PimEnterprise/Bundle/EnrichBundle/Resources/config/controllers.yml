parameters:
    pim_enrich.controller.category_tree.class:    PimEnterprise\Bundle\EnrichBundle\Controller\CategoryTreeController
    pim_enrich.controller.product.class:          PimEnterprise\Bundle\EnrichBundle\Controller\ProductController
    pim_enrich.controller.sequential_edit.class:  PimEnterprise\Bundle\EnrichBundle\Controller\SequentialEditController
    pim_enrich.controller.locale.class:           PimEnterprise\Bundle\EnrichBundle\Controller\LocaleController
    pimee_enrich.controller.rule_relation.class:  PimEnterprise\Bundle\EnrichBundle\Controller\RuleRelationController
    pimee_enrich.controller.channel_transformation.class: PimEnterprise\Bundle\EnrichBundle\Controller\ChannelTransformationController

    pim_enrich.controller.rest.product_category.class: PimEnterprise\Bundle\EnrichBundle\Controller\Rest\ProductCategoryController

services:
    # overriden to add security checks and use a smarter product saver which update draft or working copy
    pim_enrich.controller.product:
        scope: request
        class: %pim_enrich.controller.product.class%
        parent: pim_enrich.controller.abstract_doctrine
        arguments:
            - '@pim_catalog.manager.product'
            - '@pim_catalog.manager.category'
            - '@pim_user.context.user'
            - '@pim_versioning.manager.version'
            - '@oro_security.security_facade'
            - '@pim_catalog.manager.product_category'
            - '@pimee_workflow.saver.product_delegating'
            - '@pim_enrich.manager.sequential_edit'
            - '@pim_catalog.builder.product'
            - '@pim_catalog.factory.category'

    pim_enrich.controller.rest.product:
        class: %pim_enrich.controller.rest.product.class%
        arguments:
            - '@pim_catalog.repository.product'
            - '@pim_catalog.repository.attribute'
            - '@pim_catalog.updater.product_property_setter'
            - '@pimee_workflow.saver.product_delegating'
            - '@pim_internal_api_serializer'
            - '@pim_validator'
            - '@pim_user.context.user'
            - '@pim_catalog.filter.chained'
            - '@pimee_enrich.filter.product_edit_data'
            - '@pim_catalog.remover.product'
            - '@pim_catalog.builder.product'

    pimee_enrich.controller.rule_relation:
        class: %pimee_enrich.controller.rule_relation.class%
        arguments:
            - '@pimee_catalog_rule.repository.rule_relation'
            - '@pim_internal_api_serializer'
            - '@pim_catalog.resolver.fqcn'

    # overidden to filter categories with a category access repository that handles permissions
    pim_enrich.controller.category_tree.product:
        scope: request
        class: %pim_enrich.controller.category_tree.class%
        arguments:
            - '@event_dispatcher'
            - '@pim_user.context.user'
            - '@pim_catalog.saver.category'
            - '@pim_catalog.remover.category'
            - '@pim_catalog.factory.category'
            - '@pim_catalog.repository.category'
            - '@oro_security.security_facade'
            - { related_entity: product, form_type: pim_category, acl: pim_enrich_product, route: pim_enrich }
            - '@pimee_security.repository.category_access'
            - '@security.token_storage'
        calls:
            - [ setContainer, [ @service_container ] ]

    pim_enrich.controller.category_tree.published_product:
        scope: request
        class: %pim_enrich.controller.category_tree.class%
        arguments:
            - '@event_dispatcher'
            - '@pim_user.context.user'
            - '@pim_catalog.saver.category'
            - '@pim_catalog.remover.category'
            - '@pim_catalog.factory.category'
            - '@pim_catalog.repository.category'
            - '@oro_security.security_facade'
            - { related_entity: published_product, form_type: pim_category, acl: pim_enrich_product, route: pim_enrich }
            - '@pimee_security.repository.category_access'
            - '@security.token_storage'
        calls:
            - [ setContainer, [ @service_container ] ]

    pim_enrich.controller.file:
        class: %pim_enrich.controller.file.class%
        arguments:
            - '@liip_imagine.controller'
            - '@oneup_flysystem.mount_manager'
            - '@akeneo_file_storage.repository.file_info'
            - '@pim_enrich.guesser.file_type'
            - '@pim_enrich.provider.default_image'
            - ['catalogStorage', 'assetStorage']

    pimee_enrich.controller.channel_transformation:
        class: %pimee_enrich.controller.channel_transformation.class%
        arguments:
            - '@pimee_product_asset.repository.channel_configuration'

    pim_enrich.controller.mass_edit_action:
        scope: request
        class: %pim_enrich.controller.mass_edit_action.class%
        parent: pim_enrich.controller.abstract_doctrine
        arguments:
            - '@oro_datagrid.mass_action.parameters_parser'
            - '@pim_datagrid.adapter.oro_to_pim_grid_filter'
            - '@pim_connector.launcher.simple_job_launcher'
            - '@akeneo_batch.job_repository'
            - '@akeneo_batch.connectors'
            - '@pim_enrich.mass_edit_action.operation.registry'
            - '@pim_enrich.mass_edit_action.form_resolver'
            - {family-grid: 'pim_enrich_family_index', published-product-grid: 'pimee_workflow_published_product_index', default: 'pim_enrich_product_index'}

    pim_enrich.controller.rest.product_category:
        class: %pim_enrich.controller.rest.product_category.class%
        arguments:
            - '@pim_catalog.repository.product'
            - '@pim_catalog.repository.product_category'
            - '@pimee_catalog.filter.category'

    pim_enrich.controller.rest.attribute:
        class: %pim_enrich.controller.rest.attribute.class%
        arguments:
            - '@pim_catalog.repository.attribute'
            - '@pim_internal_api_serializer'
            - '@security.token_storage'
            - '@pim_catalog.filter.chained'
            - '@pimee_enrich.repository.attribute.search'
