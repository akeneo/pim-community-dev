services:
    # Feature flag
    akeneo.supplier_portal_supplier_file_dropping.feature:
        class: Akeneo\Platform\Bundle\FeatureFlagBundle\Configuration\EnvVarFeatureFlag
        arguments:
            - '%env(bool:FLAG_SUPPLIER_PORTAL_SUPPLIER_FILE_DROPPING_ENABLED)%'
        public: true

    # GCS Bucket service
    Akeneo\SupplierPortal\Supplier\Domain\ProductFileDropping\StoreProductsFile:
        class: Akeneo\SupplierPortal\Supplier\Infrastructure\ProductFileDropping\StoreProductsFileInGCSBucket
        arguments:
            - '@akeneo_file_storage.file_storage.filesystem_provider'
        public: true

    # Repositories
    Akeneo\SupplierPortal\Supplier\Domain\ProductFileDropping\Write\SupplierFileRepository:
        public: true
        class: Akeneo\SupplierPortal\Supplier\Infrastructure\ProductFileDropping\Repository\Sql\DatabaseRepository
        arguments:
            - '@database_connection'

    #Command handlers
    Akeneo\SupplierPortal\Supplier\Application\ProductFileDropping\CreateSupplierFileHandler:
        arguments:
            - '@Akeneo\SupplierPortal\Retailer\Domain\Supplier\Read\GetSupplierFromContributorEmail'
            - '@Akeneo\SupplierPortal\Supplier\Domain\ProductFileDropping\Write\SupplierFileRepository'
            - '@Akeneo\SupplierPortal\Supplier\Domain\ProductFileDropping\StoreProductsFile'
            - '@validator'
            - '@event_dispatcher'
            - '@monolog.logger.supplier_portal'

    # Queries
    Akeneo\SupplierPortal\Supplier\Domain\ProductFileDropping\GetProductFiles:
        class: Akeneo\SupplierPortal\Supplier\Infrastructure\ProductFileDropping\Query\Sql\DatabaseGetProductFiles
        arguments:
            - '@database_connection'

    Akeneo\SupplierPortal\Supplier\Domain\ProductFileDropping\GetProductFilenameFromIdentifier:
        public: true
        class: Akeneo\SupplierPortal\Supplier\Infrastructure\ProductFileDropping\Query\Sql\DatabaseGetProductFilenameFromIdentifier
        arguments:
            - '@database_connection'

    Akeneo\SupplierPortal\Supplier\Domain\ProductFileDropping\GetProductFilePath:
        public: true
        class: Akeneo\SupplierPortal\Supplier\Infrastructure\ProductFileDropping\Query\Sql\DatabaseGetProductFilePath
        arguments:
            - '@database_connection'
