parameters:
    akeneo.shared_catalog.connector.name: Akeneo Shared Catalogs
    akeneo.shared_catalog.connector.code: 'akeneo_shared_catalog'
    akeneo.shared_catalog.default_products_page_size: 10000
    env(FLAG_NEW_SHARED_CATALOG_BRANDING_ENABLED): 'false'

services:
    _defaults:
        public: true

    akeneo.shared_catalog.job.product:
        class: '%pim_connector.job.simple_job.class%'
        arguments:
            - '%akeneo.shared_catalog.connector.code%'
            - '@event_dispatcher'
            - '@akeneo_batch.job_repository'
            - []
        tags:
            - { name: akeneo_batch.job, connector: '%akeneo.shared_catalog.connector.name%', type: '%pim_connector.job.export_type%', feature: shared_catalog }

    akeneo.shared_catalog.job.job_parameters.default_values_provider:
        class: 'Akeneo\SharedCatalog\Connector\DefaultValueProvider'
        arguments:
            - '@akeneo_pim_enrichment.job.job_parameters.default_values_provider.simple_csv_export'
            - '@pim_catalog.repository.channel'
            - '@pim_catalog.repository.locale'
            -
                - '%akeneo.shared_catalog.connector.code%'
        tags:
            - { name: akeneo_batch.job.job_parameters.default_values_provider }

    akeneo.shared_catalog.job.job_parameters.constraint_collection_provider:
        class: 'Akeneo\SharedCatalog\Connector\ConstraintCollectionProvider'
        arguments:
            - '@akeneo_pim_enrichment.job.job_parameters.constraint_collection_provider.simple_csv_export'
            -
                - '%akeneo.shared_catalog.connector.code%'
        tags:
            - { name: akeneo_batch.job.job_parameters.constraint_collection_provider }

    akeneo.shared_catalog.provider.form.job_instance:
        class: 'Akeneo\Platform\Bundle\ImportExportBundle\Provider\Form\JobInstanceFormProvider'
        arguments:
            -
                akeneo_shared_catalog: pim-job-instance-shared-catalog
        tags:
            - { name: pim_enrich.provider.form }

    Akeneo\SharedCatalog\EventSubscriber\JobInstancePublisherSubscriber:
        arguments:
            - '@security.token_storage'
            - '%akeneo.shared_catalog.connector.code%'
        tags:
            - { name: doctrine.event_subscriber, connection: default }

    Akeneo\SharedCatalog\Query\FindSharedCatalogsQueryInterface:
        class: Akeneo\SharedCatalog\Query\FindSharedCatalogsQuery
        arguments:
            - '@database_connection'
            - '%akeneo.shared_catalog.connector.code%'

    Akeneo\SharedCatalog\Query\FindSharedCatalogQueryInterface:
        class: Akeneo\SharedCatalog\Query\FindSharedCatalogQuery
        arguments:
            - '@database_connection'
            - '%akeneo.shared_catalog.connector.code%'

    Akeneo\SharedCatalog\Query\GetProductUuidFromProductIdentifierQueryInterface:
        class: Akeneo\SharedCatalog\Query\GetProductUuidFromProductIdentifierQuery
        arguments:
            - '@database_connection'

    Akeneo\SharedCatalog\Query\FindProductIdentifiersQueryInterface:
        class: Akeneo\SharedCatalog\Query\FindProductIdentifiersQuery
        arguments:
            - '@Akeneo\SharedCatalog\Query\GetProductUuidFromProductIdentifierQueryInterface'
            - '@akeneo.shared_catalog.query.product_query_builder_factory'

    Akeneo\SharedCatalog\Query\FindProductUuidsQueryInterface:
        class: Akeneo\SharedCatalog\Query\FindProductUuidsQuery
        arguments:
            - '@akeneo.shared_catalog.query.product_query_builder_factory'

    Akeneo\SharedCatalog\Controller\SharedCatalogListAction:
        arguments:
            - '@Akeneo\SharedCatalog\Query\FindSharedCatalogsQueryInterface'

    Akeneo\SharedCatalog\Controller\ProductListAction:
        arguments:
            - '@Akeneo\SharedCatalog\Query\FindSharedCatalogQueryInterface'
            - '@Akeneo\SharedCatalog\Query\FindProductIdentifiersQueryInterface'
            - '%akeneo.shared_catalog.default_products_page_size%'

    Akeneo\SharedCatalog\Controller\ProductUuidListAction:
        arguments:
            - '@Akeneo\SharedCatalog\Query\FindSharedCatalogQueryInterface'
            - '@Akeneo\SharedCatalog\Query\FindProductUuidsQueryInterface'
            - '%akeneo.shared_catalog.default_products_page_size%'

    akeneo.shared_catalog.query.product_query_builder_factory:
        class: '%pim_catalog.query.elasticsearch.product_query_builder_factory.class%'
        arguments:
            - '%pim_catalog.query.product_query_builder.class%'
            - '@pim_catalog.repository.attribute'
            - '@pim_catalog.query.filter.product_registry'
            - '@pim_catalog.query.sorter.registry'
            - '@akeneo.pim.enrichment.factory.product_identifier_cursor_search_after_size_cursor'
            - '@pim_catalog.elasticsearch.product_query_builder_search_after_resolver'

    Akeneo\SharedCatalog\Command\SharedCatalogFixturesCommand:
        arguments:
            - '@database_connection'
            - '@validator'
            - '@pim_user.factory.user'
            - '@pim_user.updater.user'
            - '@pim_user.saver.user'
        tags:
            - { name: console.command }

    akeneo.shared_catalog.feature.new_shared_catalog_branding:
        class: Akeneo\Platform\Bundle\FeatureFlagBundle\Configuration\EnvVarFeatureFlag
        arguments:
            - '%env(bool:FLAG_NEW_SHARED_CATALOG_BRANDING_ENABLED)%'
        public: true
