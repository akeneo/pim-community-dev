parameters:
    pimee_workflow.datagrid.event_listener.inject_product_for_product_draft.class: PimEnterprise\Bundle\WorkflowBundle\Datagrid\EventListener\InjectProductForProductDraftSubscriber
    pimee_workflow.datagrid.configuration.product_draft.grid_helper.class: PimEnterprise\Bundle\WorkflowBundle\Datagrid\Configuration\ProductDraft\GridHelper
    pimee_workflow.datagrid.configuration.proposal.grid_helper.class: PimEnterprise\Bundle\WorkflowBundle\Datagrid\Configuration\Proposal\GridHelper
    pimee_workflow.datasource.result_record.hydrator.product_draft.class: PimEnterprise\Bundle\WorkflowBundle\Datagrid\Datasource\ResultRecord\ProductDraftHydrator
    pimee_workflow.datagrid.mass_action.handler.mass_approve.class: PimEnterprise\Bundle\WorkflowBundle\Datagrid\MassAction\Handler\MassApproveActionHandler
    pimee_workflow.datagrid.datasource.product_proposal.class: PimEnterprise\Bundle\WorkflowBundle\Datagrid\Datasource\ProductProposalDatasource
    pimee_workflow.datagrid.datasource.product_draft.class: Pim\Bundle\DataGridBundle\Datasource\Datasource

services:
    # Listener
    pimee_workflow.event_listener.product_drafts_grid_listener:
        class: '%pim_datagrid.event_listener.add_parameters_to_grid.class%'
        arguments:
          - [ product ]
          - '@oro_datagrid.datagrid.request_params'
        tags:
          - { name: kernel.event_listener, event: oro_datagrid.datgrid.build.after.product-draft-grid, method: onBuildAfter }

    pimee_workflow.datagrid.event_listener.inject_product_for_product_draft:
        class: '%pimee_workflow.datagrid.event_listener.inject_product_for_product_draft.class%'
        arguments:
            - '@oro_datagrid.datagrid.request_params'
        tags:
            - { name: kernel.event_listener, event: oro_datagrid.datgrid.build.before.product-draft-grid, method: buildBefore }

    pim_enrich.event_listener.product_grid_before_listener:
        class: '%pim_datagrid.event_listener.configure_product_grid_listener.class%'
        arguments:
            - '@pim_datagrid.datagrid.configuration.product.context_configurator'
            - '@pim_datagrid.datagrid.configuration.product.columns_configurator'
            - '@pim_datagrid.datagrid.configuration.product.filters_configurator'
            - '@pim_datagrid.datagrid.configuration.product.sorters_configurator'
            - '@pimee_datagrid.datagrid.configuration.product.row_actions_configurator'
        tags:
            - { name: kernel.event_listener, event: oro_datagrid.datgrid.build.before.product-grid, method: buildBefore }

    pim_enrich.event_listener.published_product_grid_before_listener:
        class: '%pim_datagrid.event_listener.configure_product_grid_listener.class%'
        arguments:
            - '@pim_datagrid.datagrid.configuration.product.context_configurator'
            - '@pim_datagrid.datagrid.configuration.product.columns_configurator'
            - '@pim_datagrid.datagrid.configuration.product.filters_configurator'
            - '@pim_datagrid.datagrid.configuration.product.sorters_configurator'
        tags:
            - { name: kernel.event_listener, event: oro_datagrid.datgrid.build.before.published-product-grid, method: buildBefore }

    pim_enrich.event_listener.published_product_grid_after_listener:
        class: '%pim_datagrid.event_listener.add_parameters_to_product_grid.class%'
        arguments:
          - [dataLocale]
          - '@oro_datagrid.datagrid.request_params'
          - '@pim_catalog.context.catalog'
          - '@pim_user.context.user'
          - false
          - '@request_stack'
        tags:
          - { name: kernel.event_listener, event: oro_datagrid.datgrid.build.after.published-product-grid, method: onBuildAfter }

    pimee_workflow.event_listener.proposal_grid_after_listener:
        class: '%pim_datagrid.event_listener.add_parameters_to_product_grid.class%'
        arguments:
          - [dataLocale]
          - '@oro_datagrid.datagrid.request_params'
          - '@pim_catalog.context.catalog'
          - '@pim_user.context.user'
          - false
          - '@request_stack'
        tags:
          - { name: kernel.event_listener, event: oro_datagrid.datgrid.build.after.proposal-grid, method: onBuildAfter }

    # Configuration
    pimee_workflow.datagrid.configuration.product_draft.grid_helper:
        class: '%pimee_workflow.datagrid.configuration.product_draft.grid_helper.class%'
        arguments:
            - '@security.authorization_checker'
            - '@pimee_workflow.helper.product_draft_changes_permission'

    pimee_workflow.datagrid.configuration.proposal.grid_helper:
        class: '%pimee_workflow.datagrid.configuration.proposal.grid_helper.class%'
        arguments:
            - '@security.authorization_checker'
            - '@pimee_workflow.helper.product_draft_changes_permission'

    # Result record
    pim_datagrid.datasource.result_record.hydrator.product_draft:
        class: '%pimee_workflow.datasource.result_record.hydrator.product_draft.class%'
        arguments:
          - '@pim_datagrid.datagrid.request.parameters_extractor'
          - '@pimee_workflow.normalizer.proposal_product'

    # Mass actions
    pimee_workflow.datagrid.mass_action.handler.mass_approve:
        class: '%pimee_workflow.datagrid.mass_action.handler.mass_approve.class%'
        arguments:
            - '@event_dispatcher'
            - '@pimee_workflow.factory.product_proposal_cursor'
        tags:
            - { name: pim_datagrid.extension.mass_action.handler, alias: mass_approve }

    pimee_workflow.datagrid.datasource.proposal_product:
        class: '%pimee_workflow.datagrid.datasource.product_proposal.class%'
        arguments:
            - '@pimee_workflow.doctrine.query.proposal_product_query_builder_from_size_factory_with_permissions'
            - '@pimee_workflow.normalizer.proposal_product'
        calls:
            - [ setMassActionRepository, ['@pimee_workflow.repository.product_draft' ]]
        tags:
            - { name: oro_datagrid.datasource, type: pimee_datasource_proposal_product }

    pimee_catalog.datasource.product_draft:
        class: '%pimee_workflow.datagrid.datasource.product_draft.class%'
        arguments:
            - '@pim_catalog.object_manager.product'
            - '@pim_datagrid.datasource.result_record.hydrator.product_draft'
        tags:
            - { name: oro_datagrid.datasource, type: pimee_datasource_product_draft }
