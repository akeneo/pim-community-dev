{% extends 'PimEnrichBundle::layout.html.twig' %}

{% oro_title_set({ params: { "%asset.code%": asset.code } }) %}

{% block content %}
    {% set title = 'pimee_product_asset.enrich_asset.view.title'|trans %}
    {# Copy dataset/stored and dataset/thumbnail folder in web/ for the demo #}

    {% set subtitle %}
        {{ asset.code }}
    {% endset %}

    {% set left %}
        <ul class="inline" xmlns="http://www.w3.org/1999/html">
            <li>{{ 'Created'|trans }}: {{ asset.createdAt ? asset.createdAt|date("Y-m-d H:i:s") : 'N/A'|trans }}</li>
            <li>{{ 'Last update'|trans }}: {{ asset.updatedAt ? asset.updatedAt|date("Y-m-d H:i:s") : 'N/A'|trans }}</li>
        </ul>
    {% endset %}

    {{ elements.page_header(title, [], subtitle, left) }}

    <div class="form-horizontal product-edit product-view">
        <div class="layout-content">
            {% set form_tabs = ['Global settings', 'Variations'] %}
            {{ elements.form_navbar(form_tabs) }}

            <div class="row-fluid tab-content">
                {# ASSET PANEL #}
                <div class="tab-pane active" id="global-settings">

                    <h3> </h3>

                    <div class="control-group attribute-field">
                        <label class="control-label">{{'pimee_product_asset.enrich_asset.view.code'|trans}}</label>
                        <div class="controls">
                            <div class="value-field">
                                {{ asset.code }}
                            </div>
                            <div class="icons-container"></div>
                        </div>
                    </div>

                    <div class="control-group attribute-field">
                        <label class="control-label">{{'pimee_product_asset.enrich_asset.view.description'|trans}}</label>
                        <div class="controls">
                            <div class="value-field">
                                {{ asset.description }}
                            </div>
                            <div class="icons-container"></div>
                        </div>
                    </div>

                    <div class="control-group attribute-field">
                        <label class="control-label">{{'pimee_product_asset.enrich_asset.view.end_of_use'|trans}}</label>
                        <div class="controls">
                            <div class="value-field">
                                {{ asset.endOfUseAt|date("m / d / Y") }}
                            </div>
                            <div class="icons-container"></div>
                        </div>
                    </div>
                </div>

                {# VARIATIONS PANEL #}
                <div class="tab-pane" id="variations">

                    {% for attachment in attachments %}

                        <div class="row-fluid variations">

                            <h3>
                                {% if attachment.reference.locale %}
                                    {{ attachment.reference.locale.code|flag }}
                                {% endif %}
                            </h3>

                            <ul>
                                <li>
                                    <div class="row-fluid reference">

                                        <h4>{{'pimee_product_asset.enrich_asset.view.reference'|trans}}</h4>

                                        <div class="row-fluid">
                                            {% if attachment.reference.file %}
                                                <div class="data">
                                                    <figure class="thumbnail">
                                                        <img src="{{ path('pim_enrich_media_show', { 'filename': attachment.reference.file.pathname, 'filter': 'thumbnail' }) }}">
                                                    </figure>

                                                    <table class="table">
                                                        <thead>
                                                        <tr>
                                                            <th>{{'pimee_product_asset.enrich_asset.view.filename'|trans}}</th>
                                                            <th>{{'pimee_product_asset.enrich_asset.view.actions'|trans}}</th>
                                                        </tr>
                                                        </thead>
                                                        <tbody>
                                                        <tr>
                                                            <td>{{ attachment.reference.file.originalFilename }}</td>
                                                            <td>
                                                                <a class="btn btn-info btn-mini no-hash" download="{{ attachment.reference.file.originalFilename }}" href="{{ path('pim_enrich_media_show', { 'filename': attachment.reference.file.pathname }) }}">
                                                                    {{'pimee_product_asset.enrich_asset.view.download'|trans}}
                                                                </a>
                                                            </td>
                                                        </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            {% endif %}
                                            <div class="upload{% if not attachment.reference.file %}-center{% endif %}">
                                                {% if attachment.uploadForm is defined and attachment.uploadForm is not empty %}
                                                    {{ form_start(attachment.uploadForm, {
                                                        'action': path('pimee_product_asset_upload_reference', {'assetId': asset.id, 'id': attachment.reference.id}),
                                                        'attr': {
                                                            'class': 'form-upload'
                                                        }
                                                    }) }}
                                                    {{ elements.form_errors(attachment.uploadForm) }}
                                                    <div class="row-fluid">
                                                        {{ form_row(attachment.uploadForm.file) }}
                                                        {{ elements.submitBtn('Upload') }}
                                                    </div>
                                                    {{ form_end(attachment.uploadForm) }}
                                                {% endif %}
                                            </div>
                                        </div>

                                    </div>
                                </li>

                                {% for variation in attachment.variations %}
                                    <li>
                                        <div class="row-fluid variation">

                                            <h4>{{ variation.entity.channel.label }}</h4>

                                            <div class="row-fluid">
                                                {% if variation.entity.file %}
                                                    <div class="data">
                                                        <table class="table">
                                                            <thead>
                                                            <tr>
                                                                <th>{{'pimee_product_asset.enrich_asset.view.filename'|trans}}</th>
                                                                {% if 'image' in variation.entity.file.mimeType %}
                                                                <th>{{'pimee_product_asset.enrich_asset.view.width'|trans}}</th>
                                                                <th>{{'pimee_product_asset.enrich_asset.view.height'|trans}}</th>
                                                                <th>{{'pimee_product_asset.enrich_asset.view.resolution'|trans}}</th>
                                                                <th>{{'pimee_product_asset.enrich_asset.view.colors'|trans}}</th>
                                                                {% endif %}
                                                                <th>{{'pimee_product_asset.enrich_asset.view.filesize'|trans}}</th>
                                                                <th>{{'pimee_product_asset.enrich_asset.view.filetype'|trans}}</th>
                                                                <th>{{'pimee_product_asset.enrich_asset.view.actions'|trans}}</th>
                                                            </tr>
                                                            </thead>
                                                            <tbody>
                                                            <tr>
                                                                <td>{{ variation.entity.file.originalFilename }}</td>
                                                                {% if 'image' in variation.entity.file.mimeType %}
                                                                <td>{% if variation.metadata %}{{ variation.metadata.exifSizeWidth }} px{% endif %}</td>
                                                                <td>{% if variation.metadata %}{{ variation.metadata.exifSizeHeight }} px{% endif %}</td>
                                                                <td>{% if variation.metadata %}{{ variation.metadata.exifResolution }}{% endif %}</td>
                                                                <td>{% if variation.metadata %}{{ variation.metadata.exifColorSpace }}{% endif %}</td>
                                                                {% endif %}
                                                                <td>{{ variation.entity.file.size|number_format(0, '.', ' ') }} ko</td>
                                                                <td>{{ variation.entity.file.mimeType }}</td>
                                                                <td>
                                                                    <a class="btn btn-info btn-mini no-hash" download="{{ variation.entity.file.originalFilename }}" href="{{ path('pim_enrich_media_show', { 'filename': variation.entity.file.pathname }) }}">
                                                                        {{'pimee_product_asset.enrich_asset.view.download'|trans}}
                                                                    </a>
                                                                </td>
                                                            </tr>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                {% endif %}
                                                <div class="upload{% if not variation.entity.file %}-center{% endif %}">
                                                    {% if variation.uploadForm is defined and variation.uploadForm is not empty %}
                                                        {{ form_start(variation.uploadForm, {
                                                            'id': 'pimee_product_asset_upload_variation' ~ variation.entity.id,
                                                            'action': path('pimee_product_asset_upload_variation', {'assetId': asset.id, 'id': variation.entity.id}),
                                                            'attr': {
                                                                'class': 'form-upload'
                                                            }
                                                        }) }}
                                                        {{ elements.form_errors(variation.uploadForm) }}
                                                        <div class="row-fluid">
                                                            {{ form_row(variation.uploadForm.file) }}
                                                            {{ elements.submitBtn('Upload') }}
                                                        </div>
                                                        {{ form_end(variation.uploadForm) }}
                                                    {% endif %}
                                                </div>
                                            </div>

                                        </div>
                                    </li>
                                {% endfor %}
                            </ul>

                        </div>
                    {% endfor %}

                </div>
            </div>

        </div>
    </div>
{% endblock %}
