parameters:
    pimee_teamwork_assistant.table_name_mapper.class: 'Akeneo\Pim\WorkOrganization\TeamworkAssistant\Bundle\Doctrine\ORM\TableNameMapper'
    pimee_teamwork_assistant.repository.user.class: 'Akeneo\Pim\WorkOrganization\TeamworkAssistant\Bundle\Doctrine\ORM\Repository\UserRepository'
    pimee_teamwork_assistant.repository.product.class: 'Akeneo\Pim\WorkOrganization\TeamworkAssistant\Bundle\Doctrine\ORM\Repository\ProductRepository'
    pimee_teamwork_assistant.repository.family_requirement.class: 'Akeneo\Pim\WorkOrganization\TeamworkAssistant\Bundle\Doctrine\ORM\Repository\FamilyRequirementRepository'
    pimee_teamwork_assistant.repository.attribute_permission.class: 'Akeneo\Pim\WorkOrganization\TeamworkAssistant\Bundle\Doctrine\ORM\Repository\AttributePermissionRepository'
    pimee_teamwork_assistant.repository.pre_processing.class: 'Akeneo\Pim\WorkOrganization\TeamworkAssistant\Bundle\Doctrine\ORM\Repository\PreProcessingRepository'
    pimee_teamwork_assistant.repository.project_status.class: 'Akeneo\Pim\WorkOrganization\TeamworkAssistant\Bundle\Doctrine\ORM\Repository\ProjectStatusRepository'
    pimee_teamwork_assistant.factory.project_calculation_notification.class: 'Akeneo\Pim\WorkOrganization\TeamworkAssistant\Bundle\Notification\ProjectCalculationNotificationFactory'
    pimee_teamwork_assistant.factory.project_notification.class: 'Akeneo\Pim\WorkOrganization\TeamworkAssistant\Bundle\Notification\ProjectNotificationFactory'
    pimee_teamwork_assistant.event_subscriber.catalog_updates.class: 'Akeneo\Pim\WorkOrganization\TeamworkAssistant\Bundle\EventListener\CatalogUpdatesSubscriber'
    pimee_teamwork_assistant.converter.filter.class: 'Akeneo\Pim\WorkOrganization\TeamworkAssistant\Bundle\Datagrid\FilterConverter'
    pimee_teamwork_assistant.event_subscriber.notification.class: 'Akeneo\Pim\WorkOrganization\TeamworkAssistant\Bundle\EventListener\NotificationSubscriber'
    pimee_teamwork_assistant.notifier.project_created.class: 'Akeneo\Pim\WorkOrganization\TeamworkAssistant\Bundle\Notification\ProjectCreatedNotifier'
    pimee_teamwork_assistant.notifier.project_finished.class: 'Akeneo\Pim\WorkOrganization\TeamworkAssistant\Bundle\Notification\ProjectFinishedNotifier'
    pimee_teamwork_assistant.notifier.project_due_date_reminder.class: 'Akeneo\Pim\WorkOrganization\TeamworkAssistant\Bundle\Notification\ProjectDueDateReminderNotifier'
    pimee_teamwork_assistant.reminder.days: [7, 3, 1]
    pimee_teamwork_assistant.calculator.attribute_group_completeness.class: 'Akeneo\Pim\WorkOrganization\TeamworkAssistant\Component\Calculator\AttributeGroupCompletenessCalculator'
    pimee_teamwork_assistant.calculator.contributor_group.class: 'Akeneo\Pim\WorkOrganization\TeamworkAssistant\Component\Calculator\ContributorGroupCalculator'
    pimee_teamwork_assistant.analytic.project.class: 'Akeneo\Pim\WorkOrganization\TeamworkAssistant\Bundle\Analytic\ProjectAnalyticProvider'
    pimee_teamwork_assistant.project_completeness_filter.class: 'Akeneo\Pim\WorkOrganization\TeamworkAssistant\Bundle\Datagrid\Filter\ProjectCompletenessFilter'

services:
    pimee_teamwork_assistant.table_name_mapper:
        class: '%pimee_teamwork_assistant.table_name_mapper.class%'
        arguments:
            - '@akeneo_storage_utils.doctrine.table_name_builder'
            - '%pimee_teamwork_assistant.pre_processing.tables%'

    ### Repositories
    pimee_teamwork_assistant.repository.user:
        class: '%pimee_teamwork_assistant.repository.user.class%'
        arguments:
            - '@doctrine.orm.default_entity_manager'
            - '%pim_user.entity.user.class%'

    pimee_teamwork_assistant.repository.product:
        class: '%pimee_teamwork_assistant.repository.product.class%'
        arguments:
            - '@pim_catalog.query.product_query_builder_factory_without_permission'
            - '@pimee_security.repository.category_access'

    pimee_teamwork_assistant.repository.family_requirement:
        class: '%pimee_teamwork_assistant.repository.family_requirement.class%'
        arguments:
            - '@doctrine.orm.default_entity_manager'
            - '%pim_catalog.entity.attribute_requirement.class%'

    pimee_teamwork_assistant.repository.attribute_permission:
        class: '%pimee_teamwork_assistant.repository.attribute_permission.class%'
        arguments:
            - '@doctrine.orm.default_entity_manager'
            - '%pimee_security.entity.attribute_group_access.class%'

    pimee_teamwork_assistant.repository.pre_processing:
        class: '%pimee_teamwork_assistant.repository.pre_processing.class%'
        arguments:
            - '@doctrine.orm.default_entity_manager'
            - '@pimee_teamwork_assistant.table_name_mapper'

    pimee_teamwork_assistant.repository.project_status:
        class: '%pimee_teamwork_assistant.repository.project_status.class%'
        arguments:
            - '@doctrine.orm.default_entity_manager'
            - '%pimee_teamwork_assistant.model.project_status.class%'

    ### Notifications
    pimee_teamwork_assistant.factory.project_calculation_notification:
        class: '%pimee_teamwork_assistant.factory.project_calculation_notification.class%'
        arguments:
            - '@pimee_teamwork_assistant.repository.project'
            - '@pim_catalog.localization.presenter.date'
            - ['project_calculation']
            - '%pim_notification.entity.notification.class%'
        public: false
        tags:
            - { name: pim_notification.factory.notification }

    pimee_teamwork_assistant.factory.project_notification:
        class: '%pimee_teamwork_assistant.factory.project_notification.class%'
        arguments:
            - '%pim_notification.entity.notification.class%'

    pimee_teamwork_assistant.notifier.project_created:
        class: '%pimee_teamwork_assistant.notifier.project_created.class%'
        arguments:
            - '@pimee_teamwork_assistant.factory.project_notification'
            - '@pim_notification.notifier'
            - '@pim_catalog.localization.presenter.date'
            - '@pimee_teamwork_assistant.repository.project_status'

    pimee_teamwork_assistant.notifier.project_finished:
        class: '%pimee_teamwork_assistant.notifier.project_finished.class%'
        arguments:
            - '@pimee_teamwork_assistant.factory.project_notification'
            - '@pim_notification.notifier'
            - '@pim_catalog.localization.presenter.date'
            - '@pimee_teamwork_assistant.repository.project_status'

    pimee_teamwork_assistant.notifier.project_due_date_reminder:
        class: '%pimee_teamwork_assistant.notifier.project_due_date_reminder.class%'
        arguments:
            - '@pimee_teamwork_assistant.factory.project_notification'
            - '@pim_notification.notifier'
            - '@pim_catalog.localization.presenter.date'
            - '%pimee_teamwork_assistant.reminder.days%'

    pimee_teamwork_assistant.event_subscriber.notification:
        class: '%pimee_teamwork_assistant.event_subscriber.notification.class%'
        arguments:
            - '@pimee_teamwork_assistant.repository.user'
            - '@pimee_teamwork_assistant.factory.project_status'
            - '@pimee_teamwork_assistant.repository.project_status'
            - '@pimee_teamwork_assistant.saver.project_status'
            - '@pimee_teamwork_assistant.repository.project_completeness'
            - '@pimee_teamwork_assistant.notifier.project_created'
            - '@pimee_teamwork_assistant.notifier.project_finished'
        tags:
            - { name: kernel.event_subscriber}

    ### Datagrid
    pimee_teamwork_assistant.converter.filter:
        class: '%pimee_teamwork_assistant.converter.filter.class%'
        arguments:
            - '@oro_datagrid.datagrid.request_params'
            - '@oro_datagrid.datagrid.manager'

    pimee_teamwork_assistant.event_subscriber.catalog_updates:
        class: '%pimee_teamwork_assistant.event_subscriber.catalog_updates.class%'
        arguments:
            - '@pimee_teamwork_assistant.project_remover.chained'
            - '@pimee_teamwork_assistant.launcher.job.refresh_project_completeness_calculation'
            - '@request_stack'
        tags:
            - { name: kernel.event_subscriber }

    pimee_teamwork_assistant.project_completeness_filter:
        class: '%pimee_teamwork_assistant.project_completeness_filter.class%'
        arguments:
            - '@form.factory'
            - '@pim_filter.product_utility'
            - '@oro_datagrid.datagrid.request_params'
            - '@pimee_teamwork_assistant.repository.project'
            - '@pimee_teamwork_assistant.repository.project_completeness'
            - '@security.token_storage'
            - '@pim_catalog.repository.attribute'
        tags:
            - { name: oro_filter.extension.orm_filter.filter, type: project_completeness }

    pimee_teamwork_assistant.datagrid.configuration.product.filters_configurator:
        class: 'Akeneo\Pim\WorkOrganization\TeamworkAssistant\Bundle\Datagrid\Configuration\Product\FiltersConfigurator'
        decorates: pim_datagrid.datagrid.configuration.product.filters_configurator
        decoration_inner_name: pim_datagrid.datagrid.configuration.product.filters_configurator.ce
        arguments:
            - '@pim_datagrid.datagrid.configuration.product.filters_configurator.ce'
            - '@request_stack'
            - '@pimee_teamwork_assistant.repository.project'
            - '@security.token_storage'

    ### Calculators
    pimee_teamwork_assistant.calculator.attribute_group_completeness:
        class: '%pimee_teamwork_assistant.calculator.attribute_group_completeness.class%'
        arguments:
            - '@pim_catalog.completeness.checker'
            - '@pimee_teamwork_assistant.repository.family_requirement'
            - '@pim_catalog.repository.cached_attribute'

    pimee_teamwork_assistant.calculator.contributor_group:
        class: '%pimee_teamwork_assistant.calculator.contributor_group.class%'
        arguments:
            - '@pimee_security.repository.category_access'
            - '@pimee_teamwork_assistant.repository.family_requirement'
            - '@pimee_teamwork_assistant.repository.attribute_permission'

    ### Analytics
    pimee_teamwork_assistant.analytic.project:
        class: '%pimee_teamwork_assistant.analytic.project.class%'
        arguments:
            - '@doctrine.orm.default_entity_manager'
            - '%pimee_teamwork_assistant.model.project.class%'
        tags:
            - { name: pim_analytics.data_collector, type: update_checker }
            - { name: pim_analytics.data_collector, type: system_info_report }
