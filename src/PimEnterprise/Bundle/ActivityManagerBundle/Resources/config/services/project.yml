parameters:
    akeneo_activity_manager.model.project.class: 'Akeneo\ActivityManager\Component\Model\Project'
    akeneo_activity_manager.model.project.interface: 'Akeneo\ActivityManager\Component\Model\ProjectInterface'

    activity_manager.normalizer.project.class: 'Akeneo\ActivityManager\Component\Normalizer\ProjectNormalizer'
    activity_manager.repository.project.class: 'Akeneo\ActivityManager\Bundle\Doctrine\Repository\ProjectRepository'
    activity_manager.updater.project.class: 'Akeneo\ActivityManager\Component\Updater\ProjectUpdater'
    activity_manager.event_listener.event_translation.class: 'Akeneo\ActivityManager\Bundle\EventListener\EventTranslationSubscriber'

services:
    ### Factory
    activity_manager.factory.project:
        class: '%akeneo_storage_utils.factory.simple.class%'
        arguments:
            - '%akeneo_activity_manager.model.project.class%'

    ### Normalizer
    activity_manager.normalizer.project:
        class: '%activity_manager.normalizer.project.class%'
        tags:
            - { name: pim_internal_api_serializer.normalizer }

    ### Repository
    activity_manager.repository.project:
        class: '%activity_manager.repository.project.class%'
        arguments:
            - '@doctrine.orm.default_entity_manager'
            - '%akeneo_activity_manager.model.project.class%'

    activity_manager.repository.project_completeness:
        class: 'Akeneo\ActivityManager\Bundle\Doctrine\ORM\Repository\ProjectCompletenessRepository'
        arguments:
            - '@doctrine.orm.entity_manager'

    ### Updater
    activity_manager.updater.project:
        class: '%activity_manager.updater.project.class%'
        arguments:
            - '@pim_catalog.repository.channel'
            - '@pim_catalog.repository.locale'

    ### Saver
    activity_manager.saver.project:
        class: '%akeneo_storage_utils.saver.base.class%'
        arguments:
            - '@doctrine.orm.entity_manager'
            - '@event_dispatcher'
            - '%akeneo_activity_manager.model.project.interface%'

    ### Subscribers
    activity_manager.event_listener.event_translation:
        class: '%activity_manager.event_listener.event_translation.class%'
        arguments:
            - '@event_dispatcher'
            - '@activity_manager.repository.project'
            - '%activity_manager.project_calculation.job_name%'
        tags:
            - { name: kernel.event_subscriber }

    ### Widget
    activity_manager.widget.progress:
        class: Akeneo\ActivityManager\Bundle\Widget\ProjectProgressWidget
        tags:
            - { name: pim_dashboard.widget, position: 15 }

    ### Voter
    activity_manager.voter.project:
        class: 'Akeneo\ActivityManager\Component\Voter\ProjectVoter'
        arguments:
            - '@activity_manager.repository.user'
        public: false
        tags:
            - { name: security.voter }
