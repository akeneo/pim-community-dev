services:
    akeneo_assetmanager.infrastructure.job.product_link_rule_launcher:
        class: 'Akeneo\AssetManager\Infrastructure\Job\ProductLinkRuleLauncher'
        arguments:
            - '@akeneo_batch_queue.queue.publish_job_to_queue'

    akeneo_assetmanager.infrastructure.job.naming_convention_launcher:
        class: Akeneo\AssetManager\Infrastructure\Job\NamingConventionLauncher
        arguments:
            - '@akeneo_batch_queue.queue.publish_job_to_queue'
            - '@security.token_storage'

    akeneo_assetmanager.infrastructure.job.mass_delete_launcher:
        class: Akeneo\AssetManager\Infrastructure\Job\MassDeleteAssetsLauncher
        arguments:
            - '@akeneo_batch_queue.queue.publish_job_to_queue'
            - '@security.token_storage'

    akeneo_assetmanager.infrastructure.job.mass_edit_launcher:
        class: Akeneo\AssetManager\Infrastructure\Job\MassEditAssetsLauncher
        arguments:
            - '@akeneo_batch_queue.queue.publish_job_to_queue'
            - '@security.token_storage'

    akeneo_assetmanager.infrastructure.job.compute_transformations_from_asset_identifiers_launcher:
        class: Akeneo\AssetManager\Infrastructure\Job\ComputeTransformationFromAssetIdentifiersLauncher
        arguments:
            - '@akeneo_batch_queue.queue.publish_job_to_queue'
            - '@security.token_storage'

    akeneo_assetmanager.infrastructure.job.compute_transformations_from_asset_family_identifier_launcher:
        class: Akeneo\AssetManager\Infrastructure\Job\ComputeTransformationFromAssetFamilyIdentifierLauncher
        arguments:
            - '@akeneo_batch_queue.queue.publish_job_to_queue'
            - '@security.token_storage'

    akeneo_assetmanager.infrastructure.job.provider.link_assets_to_products:
        class: 'Akeneo\AssetManager\Infrastructure\Job\Provider\LinkAssetsToProducts'
        tags:
            - { name: akeneo_batch.job.job_parameters.constraint_collection_provider }
            - { name: akeneo_batch.job.job_parameters.default_values_provider }

    akeneo_assetmanager.infrastructure.job.provider.mass_delete_assets:
        class: 'Akeneo\AssetManager\Infrastructure\Job\Provider\MassDeleteAssets'
        tags:
            - { name: akeneo_batch.job.job_parameters.constraint_collection_provider }
            - { name: akeneo_batch.job.job_parameters.default_values_provider }

    akeneo_assetmanager.infrastructure.job.provider.mass_edit_assets:
        class: 'Akeneo\AssetManager\Infrastructure\Job\Provider\MassEditAssets'
        tags:
            - { name: akeneo_batch.job.job_parameters.constraint_collection_provider }
            - { name: akeneo_batch.job.job_parameters.default_values_provider }

    akeneo_assetmanager.infrastructure.job.provider.execute_naming_convention:
        class: Akeneo\AssetManager\Infrastructure\Job\Provider\ExecuteNamingConvention
        tags:
            - { name: akeneo_batch.job.job_parameters.constraint_collection_provider }
            - { name: akeneo_batch.job.job_parameters.default_values_provider }

    akeneo_assetmanager.infrastructure.job.provider.compute_transformations:
        class: 'Akeneo\AssetManager\Infrastructure\Job\Provider\ComputeTransformations'
        tags:
            - { name: akeneo_batch.job.job_parameters.constraint_collection_provider }
            - { name: akeneo_batch.job.job_parameters.default_values_provider }

    # JOBS
    akeneo_assetmanager.job.link_assets_to_products:
        class: '%pim_connector.job.simple_job.class%'
        arguments:
            - 'asset_manager_link_assets_to_products'
            - '@event_dispatcher'
            - '@akeneo_batch.job_repository'
            -
                - '@akeneo_assetmanager.step.link_assets_to_products'
        tags:
            - { name: akeneo_batch.job, connector: 'internal', type: 'akeneo_assetmanager.link_assets_to_products' }

    akeneo_assetmanager.job.execute_naming_convention:
        class: '%pim_connector.job.simple_job.class%'
        arguments:
            - 'asset_manager_execute_naming_convention'
            - '@event_dispatcher'
            - '@akeneo_batch.job_repository'
            -
                - '@akeneo_assetmanager.step.execute_naming_convention'
        tags:
            - { name: akeneo_batch.job, connector: 'internal', type: 'akeneo_assetmanager.execute_naming_convention' }

    akeneo_assetmanager.job.compute_transformations:
        class: '%pim_connector.job.simple_job.class%'
        arguments:
            - 'asset_manager_compute_transformations'
            - '@event_dispatcher'
            - '@akeneo_batch.job_repository'
            - [ '@akeneo_assetmanager.step.compute_transformations' ]
        tags:
            - { name: akeneo_batch.job, connector: 'internal', type: 'akeneo_assetmanager.compute_transformations' }

    akeneo_assetmanager.job.mass_delete_assets:
        class: '%pim_connector.job.simple_job.class%'
        arguments:
            - 'asset_manager_mass_delete_assets'
            - '@event_dispatcher'
            - '@akeneo_batch.job_repository'
            - [ '@akeneo_assetmanager.step.mass_delete_assets' ]
            - true
        tags:
            - { name: akeneo_batch.job, connector: 'internal', type: 'akeneo_assetmanager.mass_delete_assets' }

    akeneo_assetmanager.job.mass_edit_assets:
        class: '%pim_connector.job.simple_job.class%'
        arguments:
            - 'asset_manager_mass_edit_assets'
            - '@event_dispatcher'
            - '@akeneo_batch.job_repository'
            - [ '@akeneo_assetmanager.step.mass_edit_assets' ]
            - true
        tags:
            - { name: akeneo_batch.job, connector: 'internal', type: 'akeneo_assetmanager.mass_edit_assets' }

    # STEPS
    akeneo_assetmanager.step.link_assets_to_products:
        class: '%pim_connector.step.tasklet.class%'
        arguments:
            - 'link_assets_to_products'
            - '@event_dispatcher'
            - '@akeneo_batch.job_repository'
            - '@akeneo_assetmanager.tasklet.link_assets_to_products'
        public: false

    akeneo_assetmanager.step.execute_naming_convention:
        class: '%pim_connector.step.tasklet.class%'
        arguments:
            - 'execute_naming_convention'
            - '@event_dispatcher'
            - '@akeneo_batch.job_repository'
            - '@akeneo_assetmanager.tasklet.execute_naming_convention'
        public: false

    akeneo_assetmanager.step.compute_transformations:
        class: '%pim_connector.step.tasklet.class%'
        arguments:
            - 'compute_transformations'
            - '@event_dispatcher'
            - '@akeneo_batch.job_repository'
            - '@akeneo_assetmanager.tasklet.compute_transformations'
        public: false

    akeneo_assetmanager.step.mass_delete_assets:
        class: '%pim_connector.step.tasklet.class%'
        arguments:
            - 'mass_delete_assets'
            - '@event_dispatcher'
            - '@akeneo_batch.job_repository'
            - '@akeneo_assetmanager.tasklet.mass_delete_assets_tasklet'
        public: false

    akeneo_assetmanager.step.mass_edit_assets:
        class: '%pim_connector.step.tasklet.class%'
        arguments:
            - 'mass_edit_assets'
            - '@event_dispatcher'
            - '@akeneo_batch.job_repository'
            - '@akeneo_assetmanager.tasklet.mass_edit_assets_tasklet'
        public: false

    # TASKLETS
    akeneo_assetmanager.tasklet.link_assets_to_products:
        class: 'Akeneo\AssetManager\Infrastructure\Job\LinkAssetsToProductsTasklet'
        arguments:
            - '@akeneo_assetmanager.application.asset.execute_rule_templates.rule_template_executor'
            - '@Akeneo\AssetManager\Infrastructure\Persistence\Sql\Asset\SqlFindAssetCodesByAssetFamily'
            - '@akeneo_assetmanager.infrastructure.search.elasticsearch.asset.query.count_assets'
            - '@akeneo_batch.job_repository'
            - 100
        public: false

    akeneo_assetmanager.tasklet.mass_delete_assets_tasklet:
        class: 'Akeneo\AssetManager\Infrastructure\Job\MassDeleteAssetsTasklet'
        arguments:
            - '@akeneo_assetmanager.application.asset.delete_assets_handler'
            - '@akeneo_assetmanager.infrastructure.search.elasticsearch.query_builder'
            - '@akeneo_assetmanager.client.asset'
            - '@akeneo_batch.job_repository'
            - '@akeneo_assetmanager.infrastructure.search.elasticsearch.asset_indexer'
            - '@akeneo_batch.job.job_stopper'
            - 1000
        public: false

    akeneo_assetmanager.tasklet.mass_edit_assets_tasklet:
        class: 'Akeneo\AssetManager\Infrastructure\Job\MassEditAssetsTasklet'
        arguments:
            - '@akeneo_assetmanager.application.asset.edit_asset_handler'
            - '@akeneo_assetmanager.infrastructure.search.elasticsearch.query_builder'
            - '@akeneo_assetmanager.client.asset'
            - '@akeneo_batch.job_repository'
            - '@akeneo_assetmanager.infrastructure.search.elasticsearch.asset_indexer'
            - '@akeneo_batch.job.job_stopper'
            - '@akeneo_assetmanager.application.registry.asset.edit_asset_value_command_factory_registry'
            - '@akeneo_assetmanager.infrastructure.persistence.query.find_attributes_indexed_by_identifier'
            - 1000
        public: false

    akeneo_assetmanager.tasklet.execute_naming_convention:
        class: Akeneo\AssetManager\Infrastructure\Job\NamingConventionTasklet
        arguments:
            - '@Akeneo\AssetManager\Application\Asset\ExecuteNamingConvention\ExecuteNamingConvention'
            - '@akeneo_assetmanager.infrastructure.persistence.query.find_identifiers_by_asset_family'
            - '@akeneo_assetmanager.infrastructure.search.elasticsearch.asset.query.count_assets'
            - '@akeneo_batch.job_repository'
            - 100
        public: false

    akeneo_assetmanager.tasklet.compute_transformations:
        class: 'Akeneo\AssetManager\Infrastructure\Job\ComputeTransformations'
        arguments:
            - '@akeneo_assetmanager.infrastructure.persistence.query.find_identifiers_by_asset_family'
            - '@Akeneo\AssetManager\Infrastructure\Persistence\Sql\AssetFamily\SqlGetTransformations'
            - '@akeneo_assetmanager.infrastructure.persistence.repository.asset'
            - '@akeneo_assetmanager.infrastructure.transformation.get_outdated_variation_source'
            - '@Akeneo\AssetManager\Infrastructure\Transformation\TransformationExecutor'
            - '@akeneo_assetmanager.application.asset.edit_asset_handler'
            - '@validator'
            - '@akeneo_assetmanager.infrastructure.search.elasticsearch.asset.query.count_assets'
            - '@akeneo_batch.job_repository'
            - 100
        public: false
