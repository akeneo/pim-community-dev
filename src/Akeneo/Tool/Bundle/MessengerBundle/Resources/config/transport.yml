services:
    Akeneo\Tool\Bundle\MessengerBundle\Transport\GooglePubSub\PubSubClientFactory:
        arguments:
            - '%env(string:SRNT_GOOGLE_APPLICATION_CREDENTIALS)%'

    Akeneo\Tool\Bundle\MessengerBundle\Transport\GooglePubSub\GpsTransportFactory:
        arguments:
            - '@Akeneo\Tool\Bundle\MessengerBundle\Transport\GooglePubSub\PubSubClientFactory'
            - '@Akeneo\Tool\Bundle\MessengerBundle\Ordering\OrderingKeySolver'
        tags: [messenger.transport_factory]

    Akeneo\Tool\Bundle\MessengerBundle\Ordering\OrderingKeySolver:
        arguments:
            - !tagged_iterator akeneo_messenger.ordering_key_candidate

    pim_enrich.messenger.serializer.business_event:
        class: Akeneo\Tool\Bundle\MessengerBundle\Serialization\JsonSerializer
        arguments:
            - !tagged pim_enrich.messenger.normalizer

    Akeneo\Platform\Component\EventQueue\EventNormalizer:
        tags:
            - { name: pim_enrich.messenger.normalizer, priority: 0 }

    Akeneo\Platform\Component\EventQueue\BulkEventNormalizer:
        arguments:
            - '@Akeneo\Platform\Component\EventQueue\EventNormalizer'
        tags:
            - { name: pim_enrich.messenger.normalizer, priority: 10 }
