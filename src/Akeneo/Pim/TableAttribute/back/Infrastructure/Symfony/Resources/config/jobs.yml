services:
    # Jobs
    pim_table_attribute.job.csv_option_export:
        class: '%pim_connector.job.simple_job.class%'
        arguments:
            - 'csv_table_attribute_options_export'
            - '@event_dispatcher'
            - '@akeneo_batch.job_repository'
            -
                - '@pim_table_attribute.step.csv_option_export'
            - true
        tags:
            - { name: akeneo_batch.job, connector: '%pim_connector.connector_name.csv%', type: '%pim_connector.job.export_type%' }

    pim_table_attribute.job.xlsx_option_export:
        class: '%pim_connector.job.simple_job.class%'
        arguments:
            - 'xlsx_table_attribute_options_export'
            - '@event_dispatcher'
            - '@akeneo_batch.job_repository'
            -
                - '@pim_table_attribute.step.xlsx_option_export'
            - true
        tags:
            - { name: akeneo_batch.job, connector: '%pim_connector.connector_name.xlsx%', type: '%pim_connector.job.export_type%' }

    # Steps
    pim_table_attribute.step.csv_option_export:
        class: '%pim_connector.step.item_step.class%'
        arguments:
            - 'export'
            - '@event_dispatcher'
            - '@akeneo_batch.job_repository'
            - '@Akeneo\Pim\TableAttribute\Infrastructure\Connector\Reader\Database\SelectOptionDetailsReader'
            - '@Akeneo\Pim\TableAttribute\Infrastructure\Connector\Processor\Normalization\SelectOptionDetailsProcessor'
            - '@pim_table_attribute.writer.select_option.file.csv'
            - 1000
            - '@akeneo_batch.job.job_stopper'

    pim_table_attribute.step.xlsx_option_export:
        class: '%pim_connector.step.item_step.class%'
        arguments:
            - 'export'
            - '@event_dispatcher'
            - '@akeneo_batch.job_repository'
            - '@Akeneo\Pim\TableAttribute\Infrastructure\Connector\Reader\Database\SelectOptionDetailsReader'
            - '@Akeneo\Pim\TableAttribute\Infrastructure\Connector\Processor\Normalization\SelectOptionDetailsProcessor'
            - '@pim_table_attribute.writer.select_option.file.xlsx'
            - 1000
            - '@akeneo_batch.job.job_stopper'

    # writers
    pim_table_attribute.writer.select_option.file.csv:
        class: Akeneo\Tool\Component\Connector\Writer\File\Csv\Writer
        arguments:
            - '@Akeneo\Pim\TableAttribute\Infrastructure\Connector\ArrayConverter\StandardToFlat\SelectOptionDetails'
            - '@pim_connector.factory.flat_item_buffer'
            - '@pim_table_attribute.writer.file.select_options.flat_item_buffer_flusher'

    pim_table_attribute.writer.select_option.file.xlsx:
        class: Akeneo\Tool\Component\Connector\Writer\File\Xlsx\Writer
        arguments:
            - '@Akeneo\Pim\TableAttribute\Infrastructure\Connector\ArrayConverter\StandardToFlat\SelectOptionDetails'
            - '@pim_connector.factory.flat_item_buffer'
            - '@pim_table_attribute.writer.file.select_options.flat_item_buffer_flusher'

    # Constraint providers
    pim_table_attribute.job.job_parameters.constraint_collection_provider.simple_csv_export:
        class: 'Akeneo\Tool\Component\Connector\Job\JobParameters\ConstraintCollectionProvider\SimpleCsvExport'
        arguments:
            - ['csv_table_attribute_options_export']
        tags:
            - { name: akeneo_batch.job.job_parameters.constraint_collection_provider }

    pim_table_attribute.job.job_parameters.constraint_collection_provider.simple_xlsx_export:
        class: 'Akeneo\Tool\Component\Connector\Job\JobParameters\ConstraintCollectionProvider\SimpleXlsxExport'
        arguments:
            - ['xlsx_table_attribute_options_export']
        tags:
            - { name: akeneo_batch.job.job_parameters.constraint_collection_provider }

    # Default values providers
    pim_table_attribute.job.job_parameters.default_values_provider.simple_csv_export:
        class: 'Akeneo\Tool\Component\Connector\Job\JobParameters\DefaultValuesProvider\SimpleCsvExport'
        arguments:
            - ['csv_table_attribute_options_export']
        tags:
            - { name: akeneo_batch.job.job_parameters.default_values_provider }

    pim_table_attribute.job.job_parameters.default_values_provider.simple_xlsx_export:
        class: 'Akeneo\Tool\Component\Connector\Job\JobParameters\DefaultValuesProvider\SimpleXlsxExport'
        arguments:
            - ['xlsx_table_attribute_options_export']
        tags:
            - { name: akeneo_batch.job.job_parameters.default_values_provider }

    Akeneo\Pim\TableAttribute\Infrastructure\Connector\Reader\Database\SelectOptionDetailsReader:
        arguments:
            - '@Akeneo\Pim\TableAttribute\Domain\TableConfiguration\Query\CountSelectOptions'
            - '@Akeneo\Pim\TableAttribute\Domain\TableConfiguration\Query\GetSelectOptionDetails'

    Akeneo\Pim\TableAttribute\Infrastructure\Connector\Processor\Normalization\SelectOptionDetailsProcessor: ~

    pim_table_attribute.writer.file.select_options.flat_item_buffer_flusher:
        class: '%pim_connector.writer.file.flat_item_buffer_flusher.class%'
        arguments:
            - '@pim_connector.writer.file.default.column_presenter'
            - '@pim_table_attribute.file.select_options.column_sorter'

    pim_table_attribute.file.select_options.column_sorter:
        class: '%pim_connector.writer.file.default.column_sorter.class%'
        arguments:
            - '@pim_connector.array_converter.field_splitter'
            - [ 'attribute', 'column', 'code' ]
