Akeneo\Pim\Structure\Component\Model\Attribute:
  constraints:
    - Akeneo\Pim\TableAttribute\Infrastructure\Validation\Attribute\IsTableAttributeConfigured: ~
    - Akeneo\Pim\TableAttribute\Infrastructure\Validation\Attribute\FirstColumnCodeCannotBeChanged: ~
  properties:
    rawTableConfiguration:
      - Type: array
      - Count:
          min: 2
          minMessage: pim_table_configuration.validation.table_configuration.must_contain_at_least_two_columns
      - Akeneo\Pim\TableAttribute\Infrastructure\Validation\Attribute\IsColumnCodeUnique: ~
      - Akeneo\Pim\TableAttribute\Infrastructure\Validation\Attribute\FirstColumnShouldHaveSelectDataType: ~
      - All:
          - Type: array
          - Akeneo\Pim\TableAttribute\Infrastructure\Validation\Attribute\ValidationShouldMatchColumnType: ~
          - Akeneo\Pim\TableAttribute\Infrastructure\Validation\Attribute\OptionsShouldOnlyBeSetOnSelectColumns: ~
          - Collection:
              fields:
                code:
                  - Required:
                      - NotBlank:
                          message: pim_table_configuration.validation.table_configuration.column_code_must_be_filled
                      - Regex:
                          pattern: /^[a-zA-Z0-9_]+$/
                          message: pim_table_configuration.validation.table_configuration.invalid_code
                      - Length:
                          max: 100
                          maxMessage: pim_table_configuration.validation.table_configuration.too_long_code
                data_type:
                  - Required:
                      - Type:
                          type: string
                          message: pim_table_configuration.validation.table_configuration.column_type_must_be_a_string
                      - Choice:
                          choices: [ "text", "number", "boolean", "select" ]
                          message: pim_table_configuration.validation.table_configuration.unknown_data_type
                labels:
                  - Optional:
                      - Type:
                          type: array
                          message: pim_table_configuration.validation.table_configuration.invalid_labels_format
                      - Akeneo\Pim\TableAttribute\Infrastructure\Validation\Attribute\LabelCollection: ~
                      - All:
                          - Type:
                              type: string
                              message: pim_table_configuration.validation.table_configuration.column_label_must_be_a_string
                          - NotNull:
                              message: pim_table_configuration.validation.table_configuration.column_label_must_be_a_string
                          - Length:
                              max: 250
                              maxMessage: pim_table_configuration.validation.table_configuration.too_long_label
                validations:
                  - Optional:
                      - Type:
                          type: array
                          message: TODO Validation should be an object
                      - Collection:
                          fields:
                            max_length:
                              - Type:
                                  type: int
                                  message: TODO integer
                              - Positive:
                                  message: TODO positive int
                              - LessThanOrEqual:
                                  value: 100
                                  message: 'TODO max_length should be less than or equal to {{ compared_value }} (given: {{ value }})'
                            min:
                              - Type:
                                  type: numeric
                                  message: TODO numeric
                            max:
                              - Type:
                                  type: numeric
                                  message: TODO numeric
                            decimals_allowed:
                              - Type:
                                  type: bool
                                  message: TODO bool
                          allowMissingFields: true
                          allowExtraFields: true # handled in ValidationShouldMatchColumnType
                      - Akeneo\Pim\TableAttribute\Infrastructure\Validation\Attribute\MaxShouldBeGreaterThanMin: ~
                options:
                  - Optional:
                      - Type:
                          type: array
                          message: TODO options should be an array
                      - Count:
                          max: 20000
                          maxMessage: TODO too many options
                      - All:
                        - Type:
                            type: array
                            message: TODO each option should be an array
                        - Collection:
                            fields:
                              code:
                                - Required:
                                    - NotBlank:
                                        message: pim_table_configuration.validation.table_configuration.option_code_must_be_filled
                                    - Regex:
                                        pattern: /^[a-zA-Z0-9_]+$/
                                        message: pim_table_configuration.validation.table_configuration.invalid_option_code
                                    - Length:
                                        max: 100
                                        maxMessage: pim_table_configuration.validation.table_configuration.too_long_option_code
                              labels:
                                - Optional:
                                    - Type:
                                        type: array
                                        message: pim_table_configuration.validation.table_configuration.invalid_option_labels_format
                                    - Akeneo\Pim\TableAttribute\Infrastructure\Validation\Attribute\LabelCollection: ~
                                    - All:
                                        - Type:
                                            type: string
                                            message: pim_table_configuration.validation.table_configuration.option_label_must_be_a_string
                                        - Length:
                                            max: 255
                                            maxMessage: pim_table_configuration.validation.table_configuration.too_long_option_label
                                        - NotNull:
                                            message: pim_table_configuration.validation.table_configuration.option_label_must_be_a_string
                            missingFieldsMessage: pim_table_configuration.validation.table_configuration.missing_option_field
                            extraFieldsMessage: pim_table_configuration.validation.table_configuration.unknown_option_field
              missingFieldsMessage: pim_table_configuration.validation.table_configuration.missing_column
              extraFieldsMessage: pim_table_configuration.validation.table_configuration.unknown_column_field
