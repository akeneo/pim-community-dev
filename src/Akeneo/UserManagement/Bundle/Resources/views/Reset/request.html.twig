{% extends 'PimUserBundle::layout.html.twig' %}

{% block bodyClass %}AknLogin{% endblock %}

{% block content %}
    <form action="{{ path('pim_user_reset_send_email') }}" method="post" class="Form">
        <div class="InputGroup">
            <div class="InputBlock">
                <label class="InputLabel" for="username">{{ 'pim_user.user.login.username_or_email'|trans }}</label>
                <input class="InputText" type="text" id="username" name="username" required="required" autofocus="autofocus"/>
            </div>
            <div class="CancelPasswordReset">
                <a href="{{ path('pim_user_security_login') }}" class="AknLogin-link cancel">{{ 'pim_common.cancel'|trans }}</a>
            </div>
        </div>
        <button type="submit" class="AknButton AknButton--apply AknButton--big" id="_submit">
            {{- 'pim_user.user.login.request'|trans -}}
        </button>
    </form>
{% endblock %}
{% block deferred_javascript %}
    <script type="text/javascript" nonce="{{ js_nonce() }}">
      (function () {
        const init = function(fields, submit, form) {
          if (!Array.isArray(fields) || !submit || !form) {
            return;
          }

          const validate = function (fields) {
            return fields.reduce(function (isValid, field) {
              return (isValid && field.value.length > 0);
            }, true);
          };

          const changeHandler = function () {
            if (validate(fields) ) {
              submit.removeAttribute('disabled');
              submit.classList.remove('AknButton--disabled');
            } else {
              submit.setAttribute('disabled', 'true');
              submit.classList.add('AknButton--disabled');
            }
          };

          fields.forEach(function (field) {
            field.addEventListener('input', changeHandler);
            field.dispatchEvent(new Event('input'));
          });

          form.addEventListener('submit', function() {
            return validate(fields);
          });
        }

        const username = document.getElementById('username');
        const submit = document.getElementById('_submit');
        const form = document.querySelector('form.Form');

        init([username], submit, form);
      })();
    </script>
{% endblock %}
