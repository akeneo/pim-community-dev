parameters:
    pimee_workflow.event_subscriber.published_product.check_removal.class:              Akeneo\Pim\WorkOrganization\Workflow\Bundle\EventSubscriber\PublishedProduct\CheckPublishedProductOnRemovalSubscriber
    pimee_workflow.event_subscriber.published_product.detach_product.class:             Akeneo\Pim\WorkOrganization\Workflow\Bundle\EventSubscriber\PublishedProduct\DetachProductPostPublishSubscriber
    pimee_workflow.event_subscriber.product_draft.send_for_approval.class:              Akeneo\Pim\WorkOrganization\Workflow\Bundle\EventSubscriber\ProductDraft\SendForApprovalSubscriber
    pimee_workflow.event_subscriber.import.new_proposals.class:                         Akeneo\Pim\WorkOrganization\Workflow\Bundle\EventSubscriber\Import\ImportProposalsSubscriber
    pimee_workflow.event_subscriber.product_draft.approve_notification.class:           Akeneo\Pim\WorkOrganization\Workflow\Bundle\EventSubscriber\ProductDraft\ApproveNotificationSubscriber
    pimee_workflow.event_subscriber.product_draft.refuse_notification.class:            Akeneo\Pim\WorkOrganization\Workflow\Bundle\EventSubscriber\ProductDraft\RefuseNotificationSubscriber
    pimee_workflow.event_subscriber.product_draft.remove_notification.class:            Akeneo\Pim\WorkOrganization\Workflow\Bundle\EventSubscriber\ProductDraft\RemoveNotificationSubscriber
    pimee_workflow.event_subscriber.product_draft.ensure_global_status.class:           Akeneo\Pim\WorkOrganization\Workflow\Bundle\EventSubscriber\ProductDraft\EnsureProductDraftGlobalStatusSubscriber
    pimee_workflow.subscriber.product_draft.exclude_deleted_attribute.class: Akeneo\Pim\WorkOrganization\Workflow\Bundle\EventSubscriber\ProductDraft\ORM\ExcludeDeletedAttributeSubscriber
    pimee_workflow.event_subscriber.index_product_proposals.class: Akeneo\Pim\WorkOrganization\Workflow\Bundle\EventSubscriber\ProductProposal\IndexProductProposalsSubscriber
    pimee_workflow.event_subscriber.index_product_model_proposals.class: Akeneo\Pim\WorkOrganization\Workflow\Bundle\EventSubscriber\ProductModelProposal\IndexProductModelProposalsSubscriber

services:
    ##
    # Published product events
    ##
    pim_versioning.event_listener.addversion:
        class: 'Akeneo\Pim\WorkOrganization\Workflow\Bundle\EventSubscriber\PublishedProduct\SkipVersionListener'
        lazy: true
        arguments:
            - '@pim_versioning.manager.version'
            - '@pim_versioning.serializer'
            - '@pim_versioning.update_guesser.chained'
            - '@pim_versioning.context.version'
        tags:
            - { name: doctrine.event_listener, event: onFlush, lazy: true }
            - { name: doctrine.event_listener, event: postFlush, lazy: true }

    pimee_workflow.event_subscriber.published_product.check_removal:
        class: '%pimee_workflow.event_subscriber.published_product.check_removal.class%'
        arguments:
            - '@pimee_workflow.repository.published_product'
            - '@pimee_workflow.doctrine.query.published_product_query_builder_factory.without_permission'
            - '@pim_catalog.repository.channel'
            - '@pim_catalog.repository.locale'
        tags:
            - { name: kernel.event_subscriber, priority: 255 }

    pimee_workflow.event_subscriber.published_product.detach_product:
        class: '%pimee_workflow.event_subscriber.published_product.detach_product.class%'
        arguments:
            - '@pim_catalog.object_manager.product'
        tags:
            - { name: kernel.event_subscriber }

    Akeneo\Pim\WorkOrganization\Workflow\Bundle\EventSubscriber\PublishedProduct\DispatchProductCreatedAndUpdatedEventSubscriber:
        decorates: Akeneo\Pim\Enrichment\Bundle\EventSubscriber\BusinessEvent\DispatchProductCreatedAndUpdatedEventSubscriber
        decoration_inner_name: base_dispatch_product_created_and_updated_event_subscriber
        arguments:
            - '@base_dispatch_product_created_and_updated_event_subscriber'

    Akeneo\Pim\WorkOrganization\Workflow\Bundle\EventSubscriber\PublishedProduct\DispatchProductRemovedEventSubscriber:
        decorates: Akeneo\Pim\Enrichment\Bundle\EventSubscriber\BusinessEvent\DispatchProductRemovedEventSubscriber
        decoration_inner_name: base_dispatch_product_removed_event_subscriber
        arguments:
            - '@base_dispatch_product_removed_event_subscriber'

    ##
    # Import event subscribers
    ##
    pimee_workflow.event_subscriber.import.new_proposals:
        class: '%pimee_workflow.event_subscriber.import.new_proposals.class%'
        arguments:
            - '@pim_notification.notifier'
            - '@pim_user.repository.user'
            - '@pimee_workflow.provider.owner_groups'
            - '@pimee_workflow.provider.users_to_notify'
            - '@akeneo_batch.job.job_instance_repository'
            - '@pim_notification.factory.notification'
        tags:
            - { name: kernel.event_subscriber }

    ##
    # Product drafts event subscribers
    ##
    pimee_workflow.event_subscriber.product_draft.approve_notification:
        class: '%pimee_workflow.event_subscriber.product_draft.approve_notification.class%'
        arguments:
            - '@pim_notification.notifier'
            - '@pim_user.context.user'
            - '@pim_user.repository.user'
            - '@pim_catalog.repository.attribute'
            - '@pim_notification.factory.notification'
        tags:
            - { name: kernel.event_subscriber }

    pimee_workflow.event_subscriber.product_draft.refuse_notification:
        class: '%pimee_workflow.event_subscriber.product_draft.refuse_notification.class%'
        arguments:
            - '@pim_notification.notifier'
            - '@pim_user.context.user'
            - '@pim_user.repository.user'
            - '@pim_catalog.repository.attribute'
            - '@pim_notification.factory.notification'
        tags:
            - { name: kernel.event_subscriber }

    pimee_workflow.event_subscriber.product_draft.remove_notification:
        class: '%pimee_workflow.event_subscriber.product_draft.remove_notification.class%'
        arguments:
            - '@pim_notification.notifier'
            - '@pim_user.context.user'
            - '@pim_user.repository.user'
            - '@pim_catalog.repository.attribute'
            - '@pim_notification.factory.notification'
        tags:
            - { name: kernel.event_subscriber }

    pimee_workflow.event_subscriber.product_draft.send_for_approval:
        class: '%pimee_workflow.event_subscriber.product_draft.send_for_approval.class%'
        arguments:
            - '@pim_notification.notifier'
            - '@pim_user.repository.user'
            - '@pimee_workflow.provider.owner_groups'
            - '@pimee_workflow.provider.users_to_notify'
            - '@pim_notification.factory.notification'
        tags:
            - { name: kernel.event_subscriber }

    pimee_workflow.event_subscriber.product_draft.ensure_global_status:
        class: '%pimee_workflow.event_subscriber.product_draft.ensure_global_status.class%'
        tags:
            - { name: kernel.event_subscriber }

    pimee_workflow.subscriber.product_draft.exclude_deleted_attribute:
        class: '%pimee_workflow.subscriber.product_draft.exclude_deleted_attribute.class%'
        arguments:
            - '@pimee_workflow.sql.product.find_existing_attribute_codes'
        tags:
            - { name: doctrine.event_subscriber }

    pimee_workflow.event_subscriber.index_product_proposals:
        class: '%pimee_workflow.event_subscriber.index_product_proposals.class%'
        arguments:
            - '@pim_catalog.elasticsearch.product_proposal_indexer'
        tags:
            - { name: kernel.event_subscriber }

    pimee_workflow.event_subscriber.index_product_model_proposals:
        class: '%pimee_workflow.event_subscriber.index_product_model_proposals.class%'
        arguments:
            - '@pim_catalog.elasticsearch.product_model_proposal_indexer'
        tags:
            - { name: kernel.event_subscriber }

    pimee_workflow.subscriber.product_draft.updated_author:
        class: Akeneo\Pim\WorkOrganization\Workflow\Bundle\EventSubscriber\ProductDraft\UpdateDraftAuthorSubscriber
        arguments:
            - '@pimee_workflow.sql.product.update_draft_author'
        tags:
            - { name: kernel.event_subscriber }

    pimee_workflow.subscriber.product_model_draft.updated_author:
        class: Akeneo\Pim\WorkOrganization\Workflow\Bundle\EventSubscriber\ProductModelDraft\UpdateDraftAuthorSubscriber
        arguments:
            - '@pimee_workflow.sql.product_model.update_draft_author'
        tags:
            - { name: kernel.event_subscriber }

    pimee_workflow.subscriber.track_proposal:
        class: Akeneo\Pim\WorkOrganization\Workflow\Bundle\EventSubscriber\ProposalTracking\TrackProposalSubscriber
        arguments:
            - '@Akeneo\Pim\WorkOrganization\Workflow\Bundle\ProposalTracking\TrackProposal'
            - '@Akeneo\Pim\WorkOrganization\Workflow\Bundle\FeatureFlag\ProposalTrackingFeature'
            - '@logger'
        tags:
            - { name: kernel.event_subscriber }

    pimee_workflow.subscriber.published_product.save.compute_published_product:
        class: 'Akeneo\Pim\WorkOrganization\Workflow\Bundle\EventSubscriber\PublishedProduct\OnSave\ComputePublishedProductsSubscriber'
        arguments:
            - '@pimee_workflow.query.save_published_product_completenesses'
            - '@pim_catalog.completeness.calculator'
            - '@pim_catalog.elasticsearch.published_product_indexer'
        tags:
            - { name: kernel.event_subscriber }

    pimee_workflow.subscriber.published_product.delete.compute_published_product:
        class: 'Akeneo\Pim\WorkOrganization\Workflow\Bundle\EventSubscriber\PublishedProduct\OnDelete\ComputePublishedProductsSubscriber'
        arguments:
            - '@pim_catalog.elasticsearch.published_product_indexer'
        tags:
            - { name: kernel.event_subscriber }

    # External bounded context events
    pimee_workflow.subscriber.product.remove_proposals_index:
        class: Akeneo\Pim\WorkOrganization\Workflow\Bundle\EventSubscriber\Product\RemoveProposalsIndexSubscriber
        arguments:
            - '@pimee_workflow.query.select_proposal_ids_from_product_ids'
            - '@pim_catalog.elasticsearch.product_proposal_indexer'
        tags:
            - { name: kernel.event_subscriber }

    pimee_workflow.subscriber.product_model.remove_model_proposals_index:
        class: Akeneo\Pim\WorkOrganization\Workflow\Bundle\EventSubscriber\ProductModel\RemoveModelProposalsIndexSubscriber
        arguments:
            - '@pimee_workflow.query.select_model_proposal_ids_from_product_model_ids'
            - '@pimee_workflow.query.select_proposal_ids_from_product_ids'
            - '@pim_catalog.query.descendant_product_ids'
            - '@pim_catalog.query.descendant_product_model_ids'
            - '@pim_catalog.elasticsearch.product_model_proposal_indexer'
            - '@pim_catalog.elasticsearch.product_proposal_indexer'
        tags:
            - { name: kernel.event_subscriber }

    pimee_workflow.evnt_subscriber.create_published_product_completeness_tables:
        class: 'Akeneo\Pim\WorkOrganization\Workflow\Bundle\EventSubscriber\PublishedProduct\CreatePublishedProductCompletenessTablesSubscriber'
        arguments:
            - '@database_connection'
        tags:
            - { name: kernel.event_subscriber }

    pimee_workflow.event_subscriber.proposal_tracking.install_database:
        class: Akeneo\Pim\WorkOrganization\Workflow\Bundle\EventSubscriber\ProposalTracking\InstallDatabaseSubscriber
        arguments:
            - '@database_connection'
        tags:
            - { name: kernel.event_subscriber }

    pimee_workflow.event_subscriber.removed_attributes.clean_drafts:
        class: Akeneo\Pim\WorkOrganization\Workflow\Bundle\EventSubscriber\Attribute\CleanRemovedAttributesFromDraftsSubscriber
        arguments:
            - '@pimee_workflow.cleaner.removed_attribute'
        tags:
            - { name: kernel.event_subscriber }
