services:
    exception_listener:
        class: 'Akeneo\Platform\Bundle\FrameworkBundle\EventListener\ErrorListener'
        arguments:
            - '%kernel.error_controller%'
            - '@logger'
            - '%kernel.debug%'
        tags:
            - { name: "kernel.event_subscriber" }
            - { name: "monolog.logger", channel: "request" }

    console.error_listener:
        class: 'Akeneo\Platform\Bundle\FrameworkBundle\Console\EventListener\ErrorListener'
        arguments:
            - '@logger'
        tags:
            - { name: "kernel.event_subscriber" }
            - { name: "monolog.logger", channel: "console" }

    Akeneo\Platform\Bundle\FrameworkBundle\Logging\BoundedContextResolver:
        arguments:
            - '@controller_resolver'
            - '%pimee.bounded_contexts%'

    Akeneo\Platform\Bundle\FrameworkBundle\Logging\ContextLogProcessor:
        arguments:
            - '@request_stack'
            - '@Akeneo\Platform\Bundle\FrameworkBundle\Logging\BoundedContextResolver'
            - '%env(default::string:APP_TENANT_ID)%'
        tags:
            - { name: monolog.processor }

    Akeneo\Platform\Bundle\FrameworkBundle\EventListener\AddContextHeaderResponseListener:
        arguments:
            - '@Akeneo\Platform\Bundle\FrameworkBundle\Logging\BoundedContextResolver'
            - '@Akeneo\Connectivity\Connection\Infrastructure\Apps\Security\FindCurrentAppId'
            - '%env(default::string:APP_TENANT_ID)%'
        tags:
            - { name: kernel.event_listener, event: kernel.response, method: injectAkeneoContextHeader }

    Akeneo\Platform\Bundle\FrameworkBundle\EventListener\CommandExecutionContextListener:
        arguments:
            - '@Akeneo\Platform\Bundle\FrameworkBundle\Logging\ContextLogProcessor'
        tags:
            - { name: kernel.event_listener, event: console.command }
