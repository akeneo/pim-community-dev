client-to-clone-grth: &client-to-clone-grth

workflows:

    ge2ee_bulk_deploy_last:
        when:
            not:
                equal: [ scheduled_pipeline, << pipeline.trigger_source >> ]
        jobs:
            - ready_to_build?:
                  type: approval
                  filters:
                      branches:
                          only:
                              - /BH-.*/
                              - /SDO-.*/
            - checkout:
                requires:
                    - ready_to_build?
            - build_env_vars:
                PRODUCT_TYPE: grth
                requires:
                    - checkout
            - ge2ee_bulk_deploy_last_release:
                  name: "[<< matrix.PRODUCT_TYPE >>] [<< matrix.GE2EE_ID >>] Bulk Deploy last ge2ee"
                  matrix:
                      parameters:
                          PRODUCT_TYPE: ["grth"]
                          #GE2EE_ID: ["01","02","03","04","05","06","07","08","09"]
                          GE2EE_ID: ["01","02","03"]
                  requires:
                    - build_env_vars

    on_demand_ge2ee_jenkins_mig:
        when:
            and:
                - equal: [ true, << pipeline.parameters.trigger_jenkins_ge2ee_mig >> ]
                - not:
                    equal: [ "", << pipeline.parameters.source_pfid >> ]
        jobs:
            - checkout
            - jenkins_ge2ee_migration:
                name: "Migrate Ge to EE via Jenkins"
                SOURCE_PFID: << pipeline.parameters.source_pfid >>
                GE2EE_SCRIPT_RELEASE: << pipeline.parameters.ge2ee_script_release >>
                PRODUCT_TYPE: grth
                requires:
                    - checkout

    ge2ee_mig_build_script:
        when:
            not:
                equal: [ scheduled_pipeline, << pipeline.trigger_source >> ]
        jobs:
            - ready_to_build?:
                  type: approval
                  filters:
                      branches:
                          only:
                              - /BH-.*/
                              - /SDO-.*/
            - checkout:
                requires:
                    - ready_to_build?
            - ge2ee_bulk_deploy_last_release:
                name: "[grth] Deploy last release"
                PRODUCT_TYPE: "grth"
                GE2EE_ID: "01"
                requires:
                    - checkout
            - ge2ee_mig-build_srnt_prod:
                  name: "[srnt] Build release with scripts"
                  requires:
                      - checkout
            - jenkins_ge2ee_migration:
                name: "Migrate Ge to EE via Jenkins"
                PRODUCT_TYPE: grth
                requires:
                    - "[grth] Deploy last release"
                    - "[srnt] Build release with scripts"