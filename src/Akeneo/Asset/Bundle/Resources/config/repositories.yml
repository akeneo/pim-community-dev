parameters:
    pimee_product_asset.repository.asset.class:                 Akeneo\Asset\Bundle\Doctrine\ORM\Repository\AssetRepository
    pimee_product_asset.repository.channel_configuration.class: Akeneo\Asset\Bundle\Doctrine\ORM\Repository\ChannelConfigurationRepository
    pimee_product_asset.repository.file_metadata.class:         Akeneo\Asset\Bundle\Doctrine\ORM\Repository\FileMetadataRepository
    pimee_product_asset.repository.reference.class:             Akeneo\Asset\Bundle\Doctrine\ORM\Repository\ReferenceRepository
    pimee_product_asset.repository.variation.class:             Akeneo\Asset\Bundle\Doctrine\ORM\Repository\VariationRepository
    pimee_product_asset.repository.asset_category.class:        Akeneo\Asset\Bundle\Doctrine\ORM\Repository\AssetCategoryRepository
    pimee_catalog_rule.repository.asset_mass_action.class:      Akeneo\Asset\Bundle\Doctrine\ORM\Repository\AssetMassEditRepository
    pimee_product_asset.repository.category.class:              Akeneo\Tool\Bundle\ClassificationBundle\Doctrine\ORM\Repository\CategoryRepository
    pimee_product_asset.repository.tag.class:                   Akeneo\Tool\Bundle\ClassificationBundle\Doctrine\ORM\Repository\TagRepository
    pimee_product_asset.api.repository.asset.class: Akeneo\Asset\Bundle\Doctrine\ORM\Repository\ExternalApi\AssetRepository

services:
    pimee_product_asset.repository.channel_configuration:
        class: '%pimee_product_asset.repository.channel_configuration.class%'
        factory: 'doctrine.orm.default_entity_manager:getRepository'
        arguments: ['%pimee_product_asset.model.channel_variations_configuration.class%']
        tags:
            - { name: 'pim_repository' }

    pimee_product_asset.repository.asset:
        class: '%pimee_product_asset.repository.asset.class%'
        factory: 'doctrine.orm.default_entity_manager:getRepository'
        arguments: ['%pimee_product_asset.model.asset.class%']
        calls:
            - [setCategoryRepository, ['@pimee_product_asset.repository.category']]
            - [setAssetCategoryRepository, ['@pimee_product_asset.repository.asset_category']]
            - [setProductClass, ['%pim_catalog.entity.product.class%']]
        tags:
            - { name: 'pim_repository' }

    pimee_product_asset.repository.file_metadata:
        class: '%pimee_product_asset.repository.file_metadata.class%'
        factory: 'doctrine.orm.default_entity_manager:getRepository'
        arguments:
            - '%pimee_product_asset.model.file_metadata.class%'
        tags:
            - { name: 'pim_repository' }

    pimee_product_asset.repository.reference:
        class: '%pimee_product_asset.repository.reference.class%'
        factory: 'doctrine.orm.default_entity_manager:getRepository'
        arguments:
            - '%pimee_product_asset.model.reference.class%'
        tags:
            - { name: 'pim_repository' }

    pimee_product_asset.repository.variation:
        class: '%pimee_product_asset.repository.variation.class%'
        factory: 'doctrine.orm.default_entity_manager:getRepository'
        arguments:
            - '%pimee_product_asset.model.variation.class%'
        tags:
            - { name: 'pim_repository' }

    pimee_product_asset.repository.category:
        class: '%pimee_product_asset.repository.category.class%'
        factory: 'doctrine.orm.default_entity_manager:getRepository'
        arguments:
            - '%pimee_product_asset.model.category.class%'
        tags:
            - { name: 'pim_repository' }

    pimee_product_asset.repository.asset_category:
        class:  '%pimee_product_asset.repository.asset_category.class%'
        parent: akeneo_classification.repository.abstract_item_category
        arguments:
            - '@doctrine.orm.entity_manager'
            - '%pimee_product_asset.model.asset.class%'

    pimee_product_asset.repository.external_api.asset_category:
        class: '%pim_api.repository.api_resource.class%'
        arguments:
            - '@doctrine.orm.entity_manager'
            - '%pimee_product_asset.model.category.class%'
            - '@pimee_product_asset.repository.asset_category'

    pimee_product_asset.repository.tag:
        class: '%pimee_product_asset.repository.tag.class%'
        factory: 'doctrine.orm.default_entity_manager:getRepository'
        arguments:
            - '%pimee_product_asset.model.tag.class%'
        tags:
            - { name: 'pim_repository' }

    pimee_product_asset.repository.external_api.tag:
        class: '%pim_api.repository.api_resource.class%'
        arguments:
            - '@doctrine.orm.entity_manager'
            - '%pimee_product_asset.model.tag.class%'
            - '@pimee_product_asset.repository.tag'

    pimee_product_asset.repository.asset_category_access:
        class: '%pimee_security.repository.category_access.class%'
        factory: 'doctrine.orm.default_entity_manager:getRepository'
        arguments: ['%pimee_security.entity.asset_category_access.class%']
        tags:
            - { name: 'pim_repository' }
        calls:
            - [setTableNameBuilder, ['@akeneo_storage_utils.doctrine.table_name_builder']]

    pimee_catalog_rule.repository.asset_mass_action:
        class: '%pimee_catalog_rule.repository.asset_mass_action.class%'
        arguments:
            - '@pimee_product_asset.repository.asset'
            - '@pimee_product_asset.remover.asset'

    # Query
    pimee_product_asset.asset_grid.query.fetch_user_rights_on_asset:
        class: Akeneo\Asset\Bundle\Doctrine\ORM\Query\FetchUserRightsOnAsset
        arguments:
            - '@database_connection'

    # External API
    pimee_product_asset.api.repository.asset:
        class: '%pimee_product_asset.api.repository.asset.class%'
        arguments:
            - '@doctrine.orm.entity_manager'
            - '%pimee_product_asset.model.asset.class%'
            - '@pimee_product_asset.repository.asset'

    pimee_enrich.repository.asset_category_choices:
        class: 'Akeneo\Pim\Enrichment\Bundle\Doctrine\ORM\Repository\InternalApi\CategoryRepository'
        arguments:
            - '@pim_user.context.user'
            - '@doctrine.orm.entity_manager'
            - '%pimee_product_asset.model.category.class%'
