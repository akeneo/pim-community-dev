parameters:
    pimee_workflow.event_subscriber.published_product.check_removal.class: PimEnterprise\Bundle\WorkflowBundle\EventSubscriber\PublishedProduct\CheckPublishedProductOnRemovalSubscriber
    pimee_workflow.event_subscriber.published_product.consistency_exception.class: PimEnterprise\Bundle\WorkflowBundle\EventSubscriber\PublishedProduct\PublishedProductConsistencyExceptionSubscriber
    pimee_workflow.event_subscriber.published_product.detach_product.class: PimEnterprise\Bundle\WorkflowBundle\EventSubscriber\PublishedProduct\DetachProductPostPublishSubscriber
    pimee_workflow.event_subscriber.product_draft.replace_flash_message.class: PimEnterprise\Bundle\WorkflowBundle\EventSubscriber\ProductDraft\ReplaceProductUpdatedFlashMessageSubscriber
    pimee_workflow.event_subscriber.enrich.inject_current_user_product_draft.class: PimEnterprise\Bundle\WorkflowBundle\EventSubscriber\Enrich\InjectCurrentUserProductDraftSubscriber
    pimee_workflow.event_subscriber.enrich.add_product_draft_form_view_parameter.class: PimEnterprise\Bundle\WorkflowBundle\EventSubscriber\Enrich\AddProductDraftFormViewParameterSubscriber

services:
    ##
    # Published product events
    ##
    pimee_workflow.event_subscriber.published_product.check_removal:
        class: %pimee_workflow.event_subscriber.published_product.check_removal.class%
        arguments:
            - '@pimee_workflow.repository.published_product'
            - '@pim_catalog.repository.category'
        tags:
            - { name: kernel.event_subscriber, priority: 255 }

    pimee_workflow.event_subscriber.published_product.consistency_exception:
        class: %pimee_workflow.event_subscriber.published_product.consistency_exception.class%
        arguments:
            - '@router'
        tags:
            - { name: kernel.event_subscriber }

    pimee_workflow.event_subscriber.published_product.detach_product:
        class: %pimee_workflow.event_subscriber.published_product.detach_product.class%
        arguments:
            - '@pim_catalog.manager.product'
        tags:
            - { name: kernel.event_subscriber }

    ##
    # Product drafts event subscribers
    ##
    pimee_workflow.event_subscriber.product_draft.replace_flash_message:
        class: %pimee_workflow.event_subscriber.product_draft.replace_flash_message.class%
        arguments:
            - '@security.authorization_checker'
            - '@pim_catalog.repository.product'
        tags:
            - { name: kernel.event_subscriber }

    ##
    # Product to edit preparation
    ##
    pimee_workflow.event_subscriber.enrich.inject_current_user_product_draft:
        class: %pimee_workflow.event_subscriber.enrich.inject_current_user_product_draft.class%
        arguments:
            - '@pim_user.context.user'
            - '@pim_catalog.context.catalog'
            - '@pimee_workflow.repository.product_draft'
            - '@pimee_workflow.applier.product_draft_changes_applier'
        tags:
            - { name: kernel.event_subscriber }

    pimee_workflow.event_subscriber.enrich.add_product_draft_form_view_parameter:
        class: %pimee_workflow.event_subscriber.enrich.add_product_draft_form_view_parameter.class%
        arguments:
            - '@form.factory'
            - '@pimee_workflow.manager.product_draft'
        tags:
            - { name: kernel.event_subscriber }
