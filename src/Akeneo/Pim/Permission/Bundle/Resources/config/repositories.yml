parameters:
    pimee_security.repository.attribute_group_access.class: Akeneo\Pim\Permission\Bundle\Entity\Repository\AttributeGroupAccessRepository
    pimee_security.repository.category_access.class:        Akeneo\Pim\Permission\Bundle\Entity\Repository\CategoryAccessRepository
    pimee_security.repository.job_profile_access.class:     Akeneo\Pim\Permission\Bundle\Entity\Repository\JobProfileAccessRepository
    pimee_security.repository.locale_access.class:          Akeneo\Pim\Permission\Bundle\Entity\Repository\LocaleAccessRepository
    pimee_security.repository.product_model.class: Akeneo\Pim\Permission\Bundle\Persistence\ORM\EntityWithValue\ProductModelRepository
    pimee_security.repository.product.class: Akeneo\Pim\Permission\Bundle\Persistence\ORM\EntityWithValue\ProductRepository
    pim_catalog.repository.product_mass_action.class: Akeneo\Pim\Permission\Bundle\Persistence\ORM\EntityWithValue\ProductMassActionRepository
    pim_catalog.repository.attribute.class: Akeneo\Pim\Permission\Bundle\Persistence\ORM\Attribute\AttributeRepository

services:
    pimee_security.repository.attribute_group_access:
        class: '%pimee_security.repository.attribute_group_access.class%'
        factory: 'doctrine.orm.default_entity_manager:getRepository'
        arguments: ['%pimee_security.entity.attribute_group_access.class%']
        tags:
            - { name: 'pim_repository' }
        calls:
            - [setTableNameBuilder, ['@akeneo_storage_utils.doctrine.table_name_builder']]

    pimee_security.repository.category_access:
        class: '%pimee_security.repository.category_access.class%'
        factory: 'doctrine.orm.default_entity_manager:getRepository'
        arguments: ['%pimee_security.entity.product_category_access.class%']
        tags:
            - { name: 'pim_repository' }
        calls:
            - [setTableNameBuilder, ['@akeneo_storage_utils.doctrine.table_name_builder']]

    pimee_security.repository.job_profile_access:
        class: '%pimee_security.repository.job_profile_access.class%'
        factory: 'doctrine.orm.default_entity_manager:getRepository'
        arguments: ['%pimee_security.entity.job_profile_access.class%']
        tags:
            - { name: 'pim_repository' }

    pimee_security.repository.locale_access:
        class: '%pimee_security.repository.locale_access.class%'
        factory: 'doctrine.orm.default_entity_manager:getRepository'
        arguments: ['%pimee_security.entity.locale_access.class%']
        tags:
            - { name: 'pim_repository' }

    pimee_security.repository.product_model:
        class: '%pimee_security.repository.product_model.class%'
        decorates: pim_catalog.repository.product_model
        decoration_inner_name: pim_catalog.repository.product_model_without_permission
        arguments:
            - '@pim_catalog.object_manager.product'
            - '@pim_catalog.repository.product_model_without_permission'
            - '@pimee_catalog.security.factory.filtered_product_model'
            - '@pimee_catalog.security.factory.filtered_product'
            - '@pimee_security.deny_not_granted_categorized_entity'
            - '%pim_catalog.entity.product_model.class%'
            - '@pimee_security.cached_authorization_checker'

    pimee_security.repository.product:
        class: '%pimee_security.repository.product.class%'
        decorates: pim_catalog.repository.product
        decoration_inner_name: pim_catalog.repository.product_without_permission
        arguments:
            - '@pim_catalog.object_manager.product'
            - '@pim_catalog.repository.product_without_permission'
            - '@pimee_catalog.security.factory.filtered_product'
            - '@pimee_security.deny_not_granted_categorized_entity'
            - '%pim_catalog.entity.product.class%'

    pim_catalog.repository.product_mass_action:
        class: '%pim_catalog.repository.product_mass_action.class%'
        arguments:
            - '@doctrine.orm.entity_manager'
            - '%pim_catalog.entity.product.class%'
            - '@pimee_workflow.repository.published_product'
            - '@security.token_storage'
            - '%pimee_security.entity.product_category_access.class%'
