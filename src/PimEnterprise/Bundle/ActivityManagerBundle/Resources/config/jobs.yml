parameters:
    activity_manager.project_calculation.connector_name: 'activity manager'
    activity_manager.project_calculation.tasklet_name: 'project_calculation'
    activity_manager.project_calculation.job_name: 'project_calculation'
    activity_manager.project_calculation.job_type: 'project_calculation'

services:
    ### Tasklet
    activity_manager.tasklet.project_calculation:
        class: 'Akeneo\ActivityManager\Component\Job\ProjectCalculation\ProjectCalculationTasklet'
        arguments:
            - '@activity_manager.repository.product'
            - '@activity_manager.repository.project'
            - '@activity_manager.calculation_step.chained'
            - '@activity_manager.saver.project'
            - '@akeneo_storage_utils.doctrine.object_detacher'

    ### Steps
    activity_manager.step.project_calculation:
        class: '%pim_connector.step.tasklet.class%'
        arguments:
            - '%activity_manager.project_calculation.tasklet_name%'
            - '@event_dispatcher'
            - '@akeneo_batch.job_repository'
            - '@activity_manager.tasklet.project_calculation'

    ### Job
    activity_manager.job.project_calculation:
        class: '%pim_connector.job.simple_job.class%'
        arguments:
            - '%activity_manager.project_calculation.job_name%'
            - '@event_dispatcher'
            - '@akeneo_batch.job_repository'
            -
                - '@activity_manager.step.project_calculation'
        tags:
            - { name: akeneo_batch.job, connector: '%activity_manager.project_calculation.connector_name%', type: '%activity_manager.project_calculation.job_type%' }

    ### Calculation step
    activity_manager.calculation_step.user_group:
        class: 'Akeneo\ActivityManager\Component\Job\ProjectCalculation\CalculationStep\UserGroupCalculationStep'
        arguments:
            - '@activity_manager.updater.project'
            - '@akeneo_storage_utils.doctrine.object_detacher'
            - '@pimee_product_asset.repository.asset_category_access'
            - '@pimee_security.repository.attribute_group_access'
            - '@activity_manager.repository.attribute_requirement'
            - '@activity_manager.repository.acces_group'
        public: false
        tags:
            - { name: activity_manager.calculation_step }

    activity_manager.calculation_step.chained:
        class: 'Akeneo\ActivityManager\Component\Job\ProjectCalculation\CalculationStep\ChainedCalculationStep'
        arguments:
            - []

    ### Job launcher
    activity_manager.launcher.job.project_calculation:
        class: 'Akeneo\ActivityManager\Bundle\Job\ProjectCalculationJobLauncher'
        arguments:
            - '@akeneo_batch.launcher.simple_job_launcher'
            - '@pim_import_export.repository.job_instance'
