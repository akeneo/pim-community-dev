parameters:
    pimee_security.query.product_category_access.class: Akeneo\Pim\Permission\Bundle\Entity\Query\ItemCategoryAccessQuery

services:
    pimee_security.query.product_category_access:
        class: '%pimee_security.query.product_category_access.class%'
        arguments:
            - '@doctrine.orm.entity_manager'
            - '%pim_catalog.entity.product.class%'

    pimee_security.query.product_model_category_access:
        class: '%pimee_security.query.product_category_access.class%'
        arguments:
            - '@doctrine.orm.entity_manager'
            - '%pim_catalog.entity.product_model.class%'

    pim_catalog.query.get_associated_product_codes_by_product:
        class: Akeneo\Pim\Permission\Bundle\Entity\Query\GetAssociatedProductCodesByProductFromDB
        arguments:
            - '@doctrine.orm.entity_manager'
            - '@security.token_storage'

    pimee_enrich.doctrine.counter.category_product:
        class: 'Akeneo\Pim\Permission\Bundle\Persistence\ORM\Category\Query\GrantedCategoryProductsCounter'
        arguments:
            - '@pim_catalog.query.product_query_builder_factory_without_permission'
            - '@pim_catalog.repository.category'
            - '@pimee_security.repository.category_access'
            - '@security.authorization_checker'
            - '@security.token_storage'
        tags:
            - { name: pim_enrich.doctrine.counter.category_item, type: product }

    pimee_security.product_grid.query.list_attributes:
        class: Akeneo\Pim\Permission\Bundle\Datagrid\Query\Sql\ListAttributesUseableInProductGrid
        arguments:
            - '@database_connection'

    pimee_security.product_grid.query.list_available_columns:
        class: Akeneo\Pim\Permission\Bundle\Datagrid\Query\Sql\ListProductGridAvailableColumns
        arguments:
            - '@database_connection'
            - '@oro_datagrid.configuration.provider.chain'

    pimee_security.product_grid.query.list_available_column_groups:
        class: Akeneo\Pim\Permission\Bundle\Datagrid\Query\Sql\ListProductGridAvailableColumnGroups
        arguments:
            - '@database_connection'
            - '@oro_datagrid.configuration.provider.chain'

    akeneo.pim.permission.product.query.fetch_user_rights_on_product:
        class: Akeneo\Pim\Permission\Bundle\Enrichment\Storage\Sql\Product\FetchUserRightsOnProduct
        arguments:
            - '@database_connection'

    akeneo.pim.permission.product.query.fetch_user_rights_on_product_model:
        class: Akeneo\Pim\Permission\Bundle\Enrichment\Storage\Sql\ProductModel\FetchUserRightsOnProductModel
        arguments:
            - '@database_connection'

    akeneo.pim.enrichement.connector.write.file.flat.generate_headers_from_family_codes_without_permission:
        class: 'Akeneo\Pim\Enrichment\Bundle\Storage\Sql\Connector\Writer\File\Flat\GenerateHeadersFromFamilyCodes'
        arguments:
            - '@database_connection'

    akeneo.pim.enrichment.connector.write.file.flat.generate_headers_from_family_codes:
        class: 'Akeneo\Pim\Permission\Bundle\Enrichment\Storage\Sql\Connector\Writer\File\Flat\GenerateHeadersFromFamilyCodes'
        arguments:
            - '@database_connection'
            - '@security.token_storage'
            - '@akeneo.pim.enrichement.connector.write.file.flat.generate_headers_from_family_codes_without_permission'

    akeneo.pim.enrichement.connector.write.file.flat.generate_headers_from_attribute_codes_without_permission:
        class: 'Akeneo\Pim\Enrichment\Bundle\Storage\Sql\Connector\Writer\File\Flat\GenerateHeadersFromAttributeCodes'
        arguments:
            - '@database_connection'

    akeneo.pim.enrichment.connector.write.file.flat.generate_headers_from_attribute_codes:
        class: 'Akeneo\Pim\Permission\Bundle\Enrichment\Storage\Sql\Connector\Writer\File\Flat\GenerateHeadersFromAttributeCodes'
        arguments:
            - '@database_connection'
            - '@security.token_storage'
            - '@akeneo.pim.enrichement.connector.write.file.flat.generate_headers_from_attribute_codes_without_permission'

    pimee_security.query.get_last_operations:
        class: 'Akeneo\Pim\Permission\Bundle\Persistence\Sql\GetLastOperations'
        decorates: pim_import_export.query.get_last_operations
        decoration_inner_name: pim_import_export.query.get_last_operations.without_permission
        arguments:
            - '@pim_import_export.query.get_last_operations.without_permission'

    pimee_security.query.get_viewable_attribute_codes_for_user:
        class: 'Akeneo\Pim\Permission\Bundle\Persistence\Sql\GetViewableAttributeCodesForUser'
        arguments:
            - '@database_connection'

    pimee_security.query.get_all_viewable_locales_for_user:
        class: 'Akeneo\Pim\Permission\Bundle\Persistence\Sql\LocaleRight\GetAllViewableLocalesForUser'
        arguments:
            - '@database_connection'

    akeneo.pim.enrichment.category.get_viewable_category_codes:
        class: 'Akeneo\Pim\Permission\Bundle\Enrichment\Storage\Sql\Category\GetViewableCategoryCodes'
        arguments:
            - '@database_connection'

    akeneo.pim.enrichment.category.get_ownable_category_codes:
        class: 'Akeneo\Pim\Permission\Bundle\Enrichment\Storage\Sql\Category\GetOwnableCategoryCodes'
        arguments:
            - '@database_connection'

    akeneo.pim.enrichment.category.get_editable_category_codes:
        class: 'Akeneo\Pim\Permission\Bundle\Enrichment\Storage\Sql\Category\GetEditableCategoryCodes'
        arguments:
            - '@database_connection'

    # CE override
    akeneo.pim.enrichment.product.query.get_elasticsearch_product_projection:
        class: Akeneo\Pim\Enrichment\Bundle\Doctrine\ORM\Query\GetElasticsearchProductProjection
        arguments:
            - '@pim_catalog.repository.product_without_permission'
            - '@pim_catalog.repository.locale'
            - '@pim_catalog.repository.channel'
            - '@pim_indexing_serializer'
            - '@akeneo.pim.enrichment.product.query.get_product_completenesses'
            - '@pim_catalog.family_variant.provider.entity_with_family_variant_attributes'
            - !tagged akeneo.pim.enrichment.product.query.indexing_additional_properties
