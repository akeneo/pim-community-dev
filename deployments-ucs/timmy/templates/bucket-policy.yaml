apiVersion: storage.gcp.crossplane.io/v1alpha1
kind: BucketPolicy
metadata:
  name: {{ include "timmy.bucketName" . }}
  namespace: {{ .Release.Namespace | quote }}
  labels:
    {{- include "timmy.labels" . | nindent 4 }}
  annotations:
    argocd.argoproj.io/sync-wave: "-5"
spec:
  forProvider:
    bucketRef:
      name: {{ include "timmy.bucketName" . }}
    policy:
      bindings:
        - role: roles/storage.legacyBucketOwner
          members:
            - "projectEditor:{{ .Values.common.gcpProjectID }}"
            - "projectOwner:{{ .Values.common.gcpProjectID }}"
        - role: roles/storage.objectAdmin
          members:
            - "serviceAccount:{{ .Values.common.workloadIdentityGSA }}@{{ .Values.common.gcpProjectID }}.iam.gserviceaccount.com"
  providerConfigRef:
    name: "provider-config-gcp"
