kind: Gateway
apiVersion: gateway.networking.k8s.io/v1beta1
metadata:
  name: external-http
  labels:
    domain: {{ .Values.global.publicDomain }}
  annotations:
    {{ if and ( hasPrefix "gke-l7-gxlb" .Values.gateways.externalHttp.gatewayClassName ) .Values.gateways.externalHttp.certmap -}}
    networking.gke.io/certmap: {{ .Values.gateways.externalHttp.certmap }}
    {{- end }}
spec:
  gatewayClassName: {{ .Values.gateways.externalHttp.gatewayClassName }}
  listeners:
  - name: https
    protocol: HTTPS
    port: 443
    {{ if not ( hasPrefix "gke-l7-gxlb" .Values.gateways.externalHttp.gatewayClassName ) -}}
    tls:
      certificateRefs:
      - kind: Secret
        group: ""
        name: {{ .Values.gateways.externalHttp.certSecret | default "test-cert" }}
    {{- end }}
    allowedRoutes:
      kinds:
      - kind: HTTPRoute
      namespaces:
        from: All
  - name: http
    protocol: HTTP
    port: 80
    allowedRoutes:
      kinds:
      - kind: HTTPRoute
      namespaces:
        from: All
