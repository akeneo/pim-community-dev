parameters:
    pim_batch.connectors.class:         Pim\Bundle\BatchBundle\Connector\ConnectorRegistry
    pim_batch.job_repository.class:     Pim\Bundle\BatchBundle\Job\DoctrineJobRepository
    pim_batch.job_factory.class:        Pim\Bundle\BatchBundle\Job\JobFactory
    pim_batch.step_factory.class:       Pim\Bundle\BatchBundle\Step\StepFactory
    pim_batch.logger_subscriber.class:  Pim\Bundle\BatchBundle\EventListener\LoggerSubscriber
    pim_batch.connectors_config:        ~
    pim_batch.jobs_config:              ~
    pim_batch.logger.batch_log_handler.class:  Pim\Bundle\BatchBundle\Monolog\Handler\BatchLogHandler

services:
    # connectors registry
    pim_batch.connectors:
        class: %pim_batch.connectors.class%
        arguments:
            - @pim_batch.job_factory
            - @pim_batch.step_factory

    pim_batch.job_repository:
        class: %pim_batch.job_repository.class%
        arguments:
            - @doctrine.orm.entity_manager

    pim_batch.job_factory:
        class: %pim_batch.job_factory.class%
        arguments:
            - @event_dispatcher
            - @pim_batch.job_repository

    pim_batch.logger_subscriber:
        class: %pim_batch.logger_subscriber.class%
        arguments:
            - @logger
        tags:
            - { name: kernel.event_subscriber }
            - { name: monolog.logger, channel: batch }

    pim_batch.step_factory:
        class: %pim_batch.step_factory.class%
        arguments:
            - @logger
            - @pim_batch.job_repository

    pim_batch.logger.batch_log_handler:
        class: %pim_batch.logger.batch_log_handler.class%
        arguments:
            - %kernel.root_dir%
            - %pim_batch.log_dir%
