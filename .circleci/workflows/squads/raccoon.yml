workflows:
  raccoon_tailored_import_pull_request:
    when:
      not:
        equal: [ scheduled_pipeline, << pipeline.trigger_source >> ]
    jobs:
      - ready_to_test_tailored_import?:
          name: "Start? (tailored import)"
          type: approval
          filters:
            branches:
              only:
                - /RAB-.*/
                - /RAC-.*/
      - checkout:
          name: "Checkout"
          requires:
            - "Start?"
      - build_srnt_dev:
          name: "Build dev"
          requires:
            - "Checkout"
      - test_helm_generated_k8s_files:
          name: "ðŸ¤· Ã§a bouine"
          requires:
            - "Checkout"
      - deploy_pr_environment?:
          name: "Deploy PR environment?"
          type: approval
          filters:
            branches:
              only:
                - /RAB-.*/
                - /RAC-.*/
      - build_srnt_prod:
          name: "Build prod"
          requires:
            - "ðŸ¤· Ã§a bouine"
            - "Deploy PR environment?"
      - deploy_pr_environment:
          name: "Deploy PR environment"
          requires:
            - "Build prod"
      - delete_pr_environment?:
          name: "Delete PR environment?"
          type: approval
          requires:
            - "Deploy PR environment"
      - delete_pr_environment:
          name: "Delete PR environment"
          requires:
            - "Delete PR environment?"
      - test_front_tailored_import:
          name: "Front test (tailored import)"
          requires:
            - "Build dev"
      - test_back_tailored_import:
          name: "Back test (tailored import)"
          requires:
            - "Build dev"
      - pull_request_success:
          name: "PR Success"
          requires:
            - "Front test (tailored import)"
            - "Back test (tailored import)"

  raccoon_job_automation_pull_request:
    when:
      not:
        equal: [ scheduled_pipeline, << pipeline.trigger_source >> ]
    jobs:
      - ready_to_test_job_automation?:
          name: "Start? (job automation)"
          type: approval
          filters:
            branches:
              only:
                - /RAB-.*/
                - /RAC-.*/
      - checkout:
          name: "Checkout"
          requires:
            - "Start?"
      - build_srnt_dev:
          name: "Build dev"
          requires:
            - "Checkout"
      - test_helm_generated_k8s_files:
          name: "ðŸ¤· Ã§a bouine"
          requires:
            - "Checkout"
      - deploy_pr_environment?:
          name: "Deploy PR environment?"
          type: approval
          filters:
            branches:
              only:
                - /RAB-.*/
                - /RAC-.*/
      - build_srnt_prod:
          name: "Build prod"
          requires:
            - "ðŸ¤· Ã§a bouine"
            - "Deploy PR environment?"
      - deploy_pr_environment:
          name: "Deploy PR environment"
          requires:
            - "Build prod"
      - delete_pr_environment?:
          name: "Delete PR environment?"
          type: approval
          requires:
            - "Deploy PR environment"
      - delete_pr_environment:
          name: "Delete PR environment"
          requires:
            - "Delete PR environment?"
      - test_front_job_automation:
          name: "Front test (job automation)"
          requires:
            - "Build dev"
      - test_back_job_automation:
          name: "Back test (job automation)"
          requires:
            - "Build dev"
      - pull_request_success:
          name: "PR Success"
          requires:
            - "Front test (job automation)"
            - "Back test (job automation)"
