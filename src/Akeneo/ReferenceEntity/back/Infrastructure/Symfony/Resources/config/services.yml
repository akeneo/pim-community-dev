services:
    akeneo_referenceentity.command.installer.fixtures_installer:
        class: Akeneo\ReferenceEntity\Infrastructure\Symfony\Command\Installer\FixturesInstaller
        arguments:
            - '@doctrine.dbal.default_connection'
            - '@akeneo_file_storage.file_storage.file.file_storer'
            - '@akeneo_referenceentity.client.record'
            - '@pim_catalog.command_launcher'

    akeneo_referenceentity.command.installer.assets_installer:
        class: Akeneo\ReferenceEntity\Infrastructure\Symfony\Command\Installer\AssetsInstaller
        arguments:
            - '@filesystem'
            - '%kernel.project_dir%'

    akeneo_referenceentity.event_subscriber.installer:
        class: Akeneo\ReferenceEntity\Infrastructure\Symfony\Command\InstallerCommand
        arguments:
            - '@akeneo_referenceentity.command.installer.fixtures_installer'
            - '@akeneo_referenceentity.command.installer.assets_installer'
            - '%installer_data%'
        tags:
            - { name: kernel.event_subscriber }
            - { name: 'console.command'}

    akeneo_referenceentity.command.refresh_records:
        class: Akeneo\ReferenceEntity\Infrastructure\Symfony\Command\RefreshRecordsCommand
        arguments:
            - '@akeneo_referenceentity.infrastructure.search.elasticsearch.record.query.find_identifiers_for_query'
            - '@akeneo_referenceentity.infrastructure.persistence.repository.record'
        tags:
            - { name: 'console.command'}

    akeneo_referenceentity.event_subscriber.remove_user_group:
        class: Akeneo\ReferenceEntity\Infrastructure\EventSubscriber\RemoveUserGroupSubscriber
        arguments:
            - '@akeneo.referencentity.infrastructure.persistence.query.find_reference_entity_where_user_group_is_last_to_have_edit_right'
        tags:
            - { name: kernel.event_subscriber }

    akeneo_referenceentity.updater.adder.reference_entity_collection:
        class: Akeneo\Pim\Enrichment\ReferenceEntity\Component\Updater\Adder\ReferenceEntityCollectionAdder
        arguments:
        - '@pim_catalog.builder.entity_with_values'
        - ['akeneo_reference_entity_collection']
        tags:
        - { name: 'pim_catalog.updater.adder' }

    akeneo_referenceentity.application.attribute.subscribers.set_default_attributes_on_reference_entity_creation_subscriber:
        class: Akeneo\ReferenceEntity\Application\Attribute\Subscribers\SetDefaultAttributesOnReferenceEntityCreationSubscriber
        arguments:
            - '@akeneo_referenceentity.infrastructure.persistence.repository.reference_entity'
            - '@akeneo_referenceentity.infrastructure.persistence.repository.attribute'
            - '@akeneo_referenceentity.application.attribute.create_attribute_handler'
        tags:
            - { name: kernel.event_subscriber }

    akeneo_referenceentity.application.reference_entity.subscribers.set_null_on_default_attributes_deletion_subscriber:
        class: Akeneo\ReferenceEntity\Application\ReferenceEntity\Subscribers\SetNullOnDefaultAttributesDeletionSubscriber
        arguments:
            - '@akeneo_referenceentity.infrastructure.persistence.repository.reference_entity'
        tags:
            - { name: kernel.event_subscriber }

    akeneo_referenceentity.infrastructure.reference_entity.subscribers.refresh_record_subscriber:
            class: Akeneo\ReferenceEntity\Infrastructure\Persistence\Sql\Subscribers\RefreshRecordsSubscriber
            arguments:
                - '@pim_catalog.command_launcher'
            tags:
                - { name: kernel.event_subscriber }
