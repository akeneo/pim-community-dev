parameters:
    pimee_enrich.mass_edit_action.publish.class:                    PimEnterprise\Bundle\EnrichBundle\MassEditAction\Operation\Publish
    pimee_enrich.mass_edit_action.unpublish.class:                  PimEnterprise\Bundle\EnrichBundle\MassEditAction\Operation\Unpublish
    pimee_enrich.mass_edit_tasklet.publish_product.class:           PimEnterprise\Bundle\EnrichBundle\MassEditAction\Tasklet\PublishProductTasklet
    pimee_enrich.mass_edit_tasklet.unpublish_product.class:         PimEnterprise\Bundle\EnrichBundle\MassEditAction\Tasklet\UnpublishProductTasklet

    pimee_enrich.mass_edit.publish_product_memory_cleaner.class:    PimEnterprise\Bundle\EnrichBundle\MassEditAction\Tasklet\PublishProductMemoryCleaner

services:
    # Published products operation
    pimee_enrich.mass_edit_action.unpublish:
        public: false
        class: '%pimee_enrich.mass_edit_action.unpublish.class%'
        arguments:
            - 'unpublish_product'
        tags:
            -
                name: pim_enrich.mass_edit_action
                alias: unpublish
                datagrid: published-product-grid
                operation_group: mass-edit
                acl: pimee_workflow_published_product_index

    #Â New products operations
    pimee_enrich.mass_edit_action.publish:
        public: false
        class: '%pimee_enrich.mass_edit_action.publish.class%'
        arguments:
            - 'publish_product'
        tags:
            -
                name: pim_enrich.mass_edit_action
                alias: publish
                datagrid: product-grid
                operation_group: mass-edit
                acl: pim_enrich_product_edit_attributes

    pim_enrich.mass_edit_tasklet.publish_product:
        class: '%pimee_enrich.mass_edit_tasklet.publish_product.class%'
        arguments:
            - '@pimee_workflow.manager.published_product'
            - '@pim_enrich.product.paginator'
            - '@pim_catalog.validator.product'
            - '@akeneo_storage_utils.doctrine.object_detacher'
            - '@oro_user.manager'
            - '@security.token_storage'
            - '@security.authorization_checker'
            - '@pim_catalog.query.product_query_builder_factory'
            - '@pimee_enrich.mass_edit.publish_product_memory_cleaner'

    pim_enrich.mass_edit_tasklet.unpublish_product:
        class: '%pimee_enrich.mass_edit_tasklet.unpublish_product.class%'
        arguments:
            - '@pimee_workflow.manager.published_product'
            - '@pim_enrich.product.paginator'
            - '@pim_catalog.validator.product'
            - '@akeneo_storage_utils.doctrine.object_detacher'
            - '@oro_user.manager'
            - '@security.token_storage'
            - '@security.authorization_checker'
            - '@pimee_workflow.doctrine.query.published_product_query_factory'

    pimee_enrich.mass_edit.publish_product_memory_cleaner:
        class: %pimee_enrich.mass_edit.publish_product_memory_cleaner.class%
        arguments:
            - '@akeneo_storage_utils.doctrine.smart_manager_registry'
            - '%pim_catalog.entity.product.class%'
            - '%pim_versioning.entity.version.class%'
            - '%pimee_workflow.entity.published_product_value.class%'
            - '%pimee_workflow.entity.published_product.class%'

    # We override mass edit operations services to inject a different background job which
    # take permissions in account & apply rules
    pim_enrich.mass_edit_action.change_status:
        public: false
        class: '%pim_enrich.mass_edit_action.change_status.class%'
        arguments:
            - 'update_product_value_with_permission_and_rules'
        tags:
            -
                name: pim_enrich.mass_edit_action
                alias: change-status
                datagrid: product-grid
                operation_group: mass-edit
                acl: pim_enrich_product_change_state
                form_type: pim_enrich_mass_change_status

    pim_enrich.mass_edit_action.edit_common_attributes:
        public: false
        class: '%pim_enrich.mass_edit_action.edit_common_attributes.class%'
        arguments:
            - '@pim_catalog.builder.product'
            - '@pim_user.context.user'
            - '@pim_catalog.repository.attribute'
            - '@pim_catalog.updater.product'
            - '@pim_catalog.validator.product'
            - '@pim_internal_api_serializer'
            - '@pim_catalog.localization.localizer.converter'
            - '@pim_catalog.localization.localizer.registry'
            - '@pim_enrich.filter.product_values_edit_data'
            - '@pim_enrich.converter.enrich_to_standard.product_value'
            - 'edit_common_attributes_with_permission_and_rules'
        tags:
            -
                name: pim_enrich.mass_edit_action
                alias: edit-common-attributes
                datagrid: product-grid
                operation_group: mass-edit
                acl: pim_enrich_product_edit_attributes

    pim_enrich.mass_edit_action.classify.add:
        public: false
        class: '%pim_enrich.mass_edit_action.classify.class%'
        arguments:
            - 'add_product_value_with_permission_and_rules'
            - 'pim_enrich_mass_classify'
        tags:
            -
                name: pim_enrich.mass_edit_action
                alias: classify-add
                datagrid: product-grid
                operation_group: category-edit
                acl: pim_enrich_product_categories_view

    pim_enrich.mass_edit_action.classify.move:
        public: false
        class: '%pim_enrich.mass_edit_action.classify.class%'
        arguments:
            - 'update_product_value_with_permission_and_rules'
            - 'pim_enrich_mass_classify'
        tags:
            -
                name: pim_enrich.mass_edit_action
                alias: classify-move
                datagrid: product-grid
                operation_group: category-edit
                acl: pim_enrich_product_categories_view

    pim_enrich.mass_edit_action.classify.remove:
        public: false
        class: '%pim_enrich.mass_edit_action.classify.class%'
        arguments:
            - 'remove_product_value_with_permission_and_rules'
            - 'pim_enrich_mass_classify'
        tags:
            -
                name: pim_enrich.mass_edit_action
                alias: classify-remove
                datagrid: product-grid
                operation_group: category-edit
                acl: pim_enrich_product_categories_view

    pim_enrich.mass_edit_action.change_family:
        public: false
        class: '%pim_enrich.mass_edit_action.change_family.class%'
        arguments:
            - 'update_product_value_with_permission_and_rules'
        tags:
            -
                name: pim_enrich.mass_edit_action
                alias: change-family
                datagrid: product-grid
                operation_group: mass-edit
                acl: pim_enrich_product_change_family

    pim_enrich.mass_edit_action.add_to_groups:
        class: '%pim_enrich.mass_edit_action.add_to_groups.class%'
        arguments:
            - 'add_product_value_with_permission_and_rules'
        tags:
            -
                name: pim_enrich.mass_edit_action
                alias: add-to-groups
                datagrid: product-grid
                operation_group: mass-edit
                acl: pim_enrich_product_add_to_groups

    pim_enrich.mass_edit_action.add_to_variant_group:
        class: '%pim_enrich.mass_edit_action.add_to_variant_group.class%'
        arguments:
            - 'add_to_variant_group_with_rules'
        tags:
            -
                name: pim_enrich.mass_edit_action
                alias: add-to-variant-group
                datagrid: product-grid
                operation_group: mass-edit
                acl: pim_enrich_product_add_to_variant_group
