services:
    Akeneo\Tool\Bundle\MessengerBundle\Transport\GooglePubSub\PubSubClientFactory:
        arguments:
            - '%env(string:SRNT_GOOGLE_APPLICATION_CREDENTIALS)%'

    Akeneo\Tool\Bundle\MessengerBundle\Transport\GooglePubSub\GpsTransportFactory:
        arguments:
            - '@Akeneo\Tool\Bundle\MessengerBundle\Transport\GooglePubSub\PubSubClientFactory'
            - '@Akeneo\Tool\Bundle\MessengerBundle\Ordering\OrderingKeySolver'
        tags: [messenger.transport_factory]

    Akeneo\Tool\Bundle\MessengerBundle\Ordering\OrderingKeySolver:
        arguments:
            - !tagged_iterator akeneo_messenger.ordering_key_candidate

    Akeneo\Tool\Bundle\MessengerBundle\Middleware\UcsMiddleware:
        arguments:
            - '%env(default::string:APP_TENANT_ID)%'

    Akeneo\Tool\Bundle\MessengerBundle\Transport\MessengerProxy\MessengerProxyTransportFactory:
        arguments:
            - '@Akeneo\Tool\Bundle\MessengerBundle\Transport\GooglePubSub\GpsTransportFactory'
            - '%env(GOOGLE_CLOUD_PROJECT)%'
            - '@akeneo_messenger.envelope.serializer'
            - '%env(string:APP_ENV)%'
            - '%kernel.project_dir%'
        tags: [messenger.transport_factory]

    akeneo_messenger.bus.proxy:
        class: Akeneo\Tool\Bundle\MessengerBundle\Transport\MessengerProxy\MessengerProxyBus
        arguments:
            - '@messenger.default_bus'
            - '%env(default::string:APP_TENANT_ID)%'

    Akeneo\Tool\Bundle\MessengerBundle\Handler\MessageWrapperHandler:
        arguments:
            - '@akeneo_messenger.message.serializer'
            - '@logger'
        tags:
            -
                name: messenger.message_handler
                handles: Akeneo\Tool\Bundle\MessengerBundle\Transport\MessengerProxy\MessageWrapper
