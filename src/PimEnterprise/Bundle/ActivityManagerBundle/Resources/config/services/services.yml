parameters:
    pim_datagrid.datagrid.configuration.product.context_configurator.class: 'Akeneo\ActivityManager\Bundle\Datagrid\ContextConfigurator'
    pim_datagrid.extension.filter.class: 'Akeneo\ActivityManager\Bundle\Datagrid\FilterExtension'

    activity_manager.repository.user.class: 'Akeneo\ActivityManager\Bundle\Doctrine\ORM\Repository\UserRepository'
    activity_manager.repository.product.class: 'Akeneo\ActivityManager\Bundle\Doctrine\ORM\Repository\ProductRepository'
    activity_manager.repository.familly_requirement.class: 'Akeneo\ActivityManager\Bundle\Doctrine\ORM\Repository\FamilyRequirementRepository'
    activity_manager.repository.attribute_permission.class: 'Akeneo\ActivityManager\Bundle\Doctrine\ORM\Repository\AttributePermissionRepository'
    activity_manager.repository.job_instance.class: 'Akeneo\ActivityManager\Bundle\Doctrine\ORM\Repository\JobInstanceRepository'
    activity_manager.repository.attribute.class: 'Akeneo\ActivityManager\Bundle\Doctrine\ORM\Repository\AttributeRepository'
    activity_manager.factory.project_calculation_notification.class: 'Akeneo\ActivityManager\Bundle\Notification\ProjectCalculationNotificationFactory'
    activity_manager.factory.project_created_notification.class: 'Akeneo\ActivityManager\Bundle\Notification\ProjectCreatedNotificationFactory'
    activity_manager.event_subscriber.project_creation_notifier.class: 'Akeneo\ActivityManager\Bundle\EventListener\ProjectCreationNotifierSubscriber'
    activity_manager.converter.filter.class: 'Akeneo\ActivityManager\Bundle\Datagrid\FilterConverter'
    activity_manager.controller.project_controller.class: 'Akeneo\ActivityManager\Bundle\Controller\ProjectController'
    activity_manager.controller.project_completeness_controller.class: 'Akeneo\ActivityManager\Bundle\Controller\ProjectCompletenessController'

services:
    ### Repositories
    activity_manager.repository.user:
        class: '%activity_manager.repository.user.class%'
        arguments:
            - '@doctrine.orm.default_entity_manager'
            - '%pim_user.entity.user.class%'

    activity_manager.repository.product:
        class: '%activity_manager.repository.product.class%'
        arguments:
            - '@pim_catalog.query.product_query_builder_factory'
            - '@pimee_security.repository.category_access'

    activity_manager.repository.familly_requirement:
        class: '%activity_manager.repository.familly_requirement.class%'
        arguments:
            - '@doctrine.orm.default_entity_manager'
            - '%pim_catalog.entity.attribute_requirement.class%'

    activity_manager.repository.attribute_permission:
        class: '%activity_manager.repository.attribute_permission.class%'
        arguments:
            - '@doctrine.orm.default_entity_manager'
            - '%pimee_security.entity.attribute_group_access.class%'

    activity_manager.repository.job_instance:
        class: '%activity_manager.repository.job_instance.class%'
        arguments:
            - '@doctrine.orm.default_entity_manager'
            - '%akeneo_batch.entity.job_instance.class%'
            - '%activity_manager.project_calculation.job_name%'

    activity_manager.repository.attribute:
        class: '%activity_manager.repository.attribute.class%'
        arguments:
            - '@doctrine.orm.default_entity_manager'
            - '%pim_catalog.entity.attribute.class%'

    ### Notifications
    activity_manager.factory.project_calculation_notification:
        class: '%activity_manager.factory.project_calculation_notification.class%'
        arguments:
            - ['project_calculation']
            - '%pim_notification.entity.notification.class%'
        tags:
            - { name: pim_notification.factory.notification }

    activity_manager.factory.project_created_notification:
        class: '%activity_manager.factory.project_created_notification.class%'
        arguments:
            - '%pim_notification.entity.notification.class%'

    activity_manager.event_subscriber.project_creation_notifier:
        class: '%activity_manager.event_subscriber.project_creation_notifier.class%'
        arguments:
            - '@activity_manager.factory.project_created_notification'
            - '@pim_notification.notifier'
            - '@activity_manager.repository.user'
            - '@pim_catalog.localization.presenter.date'
        tags:
            - { name: kernel.event_subscriber }

    ### Datagrid
    activity_manager.converter.filter:
        class: '%activity_manager.converter.filter.class%'
        arguments:
            - '@pim_datagrid.adapter.oro_to_pim_grid_filter'

    pim_datagrid.extension.filter:
        class: '%pim_datagrid.extension.filter.class%'
        arguments:
            - '@oro_datagrid.datagrid.request_params'
            - '@translator'
            - '@pim_datagrid.datasource.adapter_resolver'
            - '@activity_manager.repository.attribute'
            - '@pimee_security.repository.attribute_group_access'
            - '@pim_user.context.user'
            - '@pim_datagrid.repository.datagrid_view'
            - '@activity_manager.repository.project'
        tags:
             - { name: oro_datagrid.extension }

    ### Controllers
    activity_manager.controller.project_controller:
        class: '%activity_manager.controller.project_controller.class%'
        arguments:
            - '@activity_manager.converter.filter'
            - '@pim_datagrid.factory.datagrid_view'
            - '@activity_manager.factory.project'
            - '@pim_datagrid.updater.datagrid_view'
            - '@activity_manager.updater.project'
            - '@activity_manager.saver.project'
            - '@validator'
            - '@activity_manager.launcher.job.project_calculation'
            - '@pim_internal_api_serializer'
            - '@activity_manager.repository.project'
            - '@activity_manager.repository.user'
            - '@security.token_storage'

    activity_manager.controller.project_completeness_controller:
        class: '%activity_manager.controller.project_completeness_controller.class%'
        arguments:
            - '@activity_manager.repository.project'
            - '@activity_manager.repository.project_completeness'