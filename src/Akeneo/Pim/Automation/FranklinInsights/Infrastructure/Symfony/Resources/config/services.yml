services:
    akeneo.pim.automation.franklin_insights.proposal.create_proposal:
        class: 'Akeneo\Pim\Automation\FranklinInsights\Infrastructure\Proposal\ProposalUpsert'
        arguments:
            - '@pim_catalog.repository.product_without_permission'
            - '@pimee_workflow.updater.product_without_permission'
            - '@pimee_workflow.product.builder.draft'
            - '@pimee_workflow.saver.product_draft'
            - '@event_dispatcher'
            - '@Akeneo\Pim\Automation\FranklinInsights\Infrastructure\Proposal\Factory\FranklinUserDraftSourceFactory'

    akeneo.pim.automation.franklin_insights.application.mapping.service.remove_attributes_from_mapping:
        class: 'Akeneo\Pim\Automation\FranklinInsights\Infrastructure\Connector\JobLauncher\RemoveAttributesFromMapping'
        arguments:
            - '@akeneo_batch.job.job_instance_repository'
            - '@akeneo_batch_queue.launcher.queue_job_launcher'
            - '@security.token_storage'

    akeneo.pim.automation.franklin_insights.application.mapping.service.remove_option_from_attribute_options_mapping:
        class: 'Akeneo\Pim\Automation\FranklinInsights\Infrastructure\Connector\JobLauncher\RemoveAttributeOptionFromMapping'
        arguments:
            - '@akeneo_batch.job.job_instance_repository'
            - '@akeneo_batch_queue.launcher.queue_job_launcher'
            - '@security.token_storage'

    akeneo.pim.automation.franklin_insights.application.mapping.service.identify_products_to_resubscribe:
        class: 'Akeneo\Pim\Automation\FranklinInsights\Infrastructure\Connector\JobLauncher\IdentifyProductsToResubscribe'
        arguments:
            - '@akeneo_batch.job.job_instance_repository'
            - '@akeneo_batch_queue.launcher.queue_job_launcher'
            - '@security.token_storage'

    akeneo.pim.automation.franklin_insights.application.subscription.service.resubscribe_products:
        class: 'Akeneo\Pim\Automation\FranklinInsights\Infrastructure\Connector\JobLauncher\ResubscribeProducts'
        arguments:
            - '@akeneo_batch.job.job_instance_repository'
            - '@akeneo_batch_queue.launcher.queue_job_launcher'
            - '@security.token_storage'

    akeneo.pim.automation.franklin_insights.proposal.factory.suggested_data:
        class: 'Akeneo\Pim\Automation\FranklinInsights\Application\Proposal\Factory\ProposalSuggestedDataFactory'
        arguments:
            - '@akeneo.pim.automation.franklin_insights.normalizers.suggested_data'

    akeneo.pim.automation.franklin_insights.notifier.notify_about_missing_mapping:
        class: 'Akeneo\Pim\Automation\FranklinInsights\Infrastructure\UserNotification\NotifyUserAboutMissingMapping'
        arguments:
            - '@pim_notification.factory.notification'
            - '@pim_notification.notifier'

    akeneo.pim.automation.franklin_insights.notifier.notify_about_invalid_token:
        class: 'Akeneo\Pim\Automation\FranklinInsights\Infrastructure\UserNotification\NotifyUserAboutInvalidToken'
        arguments:
            - '@pim_notification.factory.notification'
            - '@pim_notification.notifier'
            - '@pim_user.context.user'

    akeneo.pim.automation.franklin_insights.application.structure.service.create_attribute:
        class: 'Akeneo\Pim\Automation\FranklinInsights\Infrastructure\Structure\Service\CreateAttribute'
        arguments:
            - '@pim_catalog.factory.attribute'
            - '@pim_catalog.updater.attribute'
            - '@pim_catalog.saver.attribute'
            - '@validator'
            - '@akeneo.pim.automation.franklin_insights.application.structure.service.ensure_franklin_attribute_group_exists'
            - '@akeneo.pim.automation.franklin_insights.infrastructure.persistence.query.select_active_locale_codes_managed_by_franklin'
            - '@logger'

    akeneo.pim.automation.franklin_insights.application.structure.service.add_attribute_to_family:
        class: 'Akeneo\Pim\Automation\FranklinInsights\Infrastructure\Structure\Service\AddAttributeToFamily'
        arguments:
            - '@pim_catalog.updater.family'
            - '@pim_catalog.saver.family'
            - '@pim_catalog.repository.family'
            - '@validator'

    akeneo.pim.automation.franklin_insights.application.structure.service.ensure_franklin_attribute_group_exists:
        class: 'Akeneo\Pim\Automation\FranklinInsights\Infrastructure\Structure\Service\EnsureFranklinAttributeGroupExists'
        arguments:
            - '@pim_catalog.factory.attribute_group'
            - '@pim_catalog.saver.attribute_group'
            - '@pim_catalog.repository.attribute_group'
            - '@validator'
            - '@akeneo.pim.automation.franklin_insights.infrastructure.persistence.query.select_active_locale_codes_managed_by_franklin'

    akeneo.pim.automation.franklin_insights.application.mapping.service.data_processor.apply_attribute_exact_matches:
        class: 'Akeneo\Pim\Automation\FranklinInsights\Application\Mapping\Service\DataProcessor\ApplyAttributeExactMatches'
        arguments:
            - '@akeneo.pim.automation.franklin_insights.infrastructure.persistence.query.select_exact_match_attribute_codes'
            - '@akeneo.pim.automation.franklin_insights.handler.update_attributes_mapping_by_family'
            - '@monolog.logger.franklin'

    akeneo.pim.automation.franklin_insights.application.mapping.service.data_processor.suggest_attribute_exact_matches_from_other_family:
        class: 'Akeneo\Pim\Automation\FranklinInsights\Application\Mapping\Service\DataProcessor\SuggestExactMatchAttributesFromOtherFamilies'
        arguments:
            - '@akeneo.pim.automation.franklin_insights.infrastructure.persistence.query.select_exact_match_attribute_code_from_other_family_query'

    Akeneo\Pim\Automation\FranklinInsights\Infrastructure\Symfony\Command\FetchProductsCommand:
        arguments:
            - '@akeneo.pim.automation.franklin_insights.connector.job_launcher.schedule_fetch_products'
            - '@akeneo.pim.automation.franklin_insights.application.configuration.query.get_connection_is_active_handler'
        tags:
            - { name: console.command }

    Akeneo\Pim\Automation\FranklinInsights\Infrastructure\Symfony\Command\InitJobInstancesCommand:
        arguments:
            - '@pim_enrich.repository.job_instance'
            - '@database_connection'
        tags:
            - { name: console.command }

    Akeneo\Pim\Automation\FranklinInsights\Infrastructure\Proposal\Factory\FranklinUserDraftSourceFactory: ~

    akeneo.pim.automation.franklin_insights.application.quality_highlights.synchronize_attributes_with_franklin:
        class: Akeneo\Pim\Automation\FranklinInsights\Application\QualityHighlights\SynchronizeAttributesWithFranklin
        arguments:
            - '@akeneo.pim.automation.franklin_insights.infrastructure.persistence.query.select_pending_items'
            - '@akeneo.pim.automation.franklin_insights.infrastructure.persistence.query.select_attributes_to_apply'
            - '@akeneo.pim.automation.franklin_insights.data_provider.quality_highlights'
            - '@akeneo.pim.automation.franklin_insights.repository.quality_highlights_pending_items'
            - '@monolog.logger.franklin'

    akeneo.pim.automation.franklin_insights.application.quality_highlights.synchronize_families_with_franklin:
        class: Akeneo\Pim\Automation\FranklinInsights\Application\QualityHighlights\SynchronizeFamiliesWithFranklin
        arguments:
            - '@akeneo.pim.automation.franklin_insights.infrastructure.persistence.query.select_pending_items'
            - '@akeneo.pim.automation.franklin_insights.data_provider.quality_highlights'
            - '@akeneo.pim.automation.franklin_insights.repository.quality_highlights_pending_items'
            - '@akeneo.pim.automation.franklin_insights.infrastructure.persistence.query.select_families_to_apply'
            - '@monolog.logger.franklin'

    akeneo.pim.automation.franklin_insights.application.quality_highlights.synchronize_products_with_franklin:
        class: Akeneo\Pim\Automation\FranklinInsights\Application\QualityHighlights\SynchronizeProductsWithFranklin
        arguments:
            - '@akeneo.pim.automation.franklin_insights.infrastructure.persistence.query.select_pending_items'
            - '@Akeneo\Pim\Automation\FranklinInsights\Infrastructure\Persistence\Query\Doctrine\QualityHighlights\SelectUpdatedProductsIdsToApplyQuery'
            - '@akeneo.pim.automation.franklin_insights.data_provider.quality_highlights'
            - '@akeneo.pim.automation.franklin_insights.repository.quality_highlights_pending_items'
            - '@akeneo.pim.automation.franklin_insights.infrastructure.persistence.query.quality_highlights.select_products_to_apply'
            - '@akeneo.pim.automation.franklin_insights.normalizer.quality_highlights.product'
            - '@monolog.logger.franklin'

    Akeneo\Pim\Automation\FranklinInsights\Application\QualityHighlights\PushStructureAndProductsToFranklin:
        arguments:
            - '@akeneo.pim.automation.franklin_insights.repository.quality_highlights_pending_items'
            - '@akeneo.pim.automation.franklin_insights.application.quality_highlights.synchronize_families_with_franklin'
            - '@akeneo.pim.automation.franklin_insights.application.quality_highlights.synchronize_attributes_with_franklin'
            - '@akeneo.pim.automation.franklin_insights.application.quality_highlights.synchronize_products_with_franklin'
            - '@akeneo.pim.automation.franklin_insights.data_provider.quality_highlights'
