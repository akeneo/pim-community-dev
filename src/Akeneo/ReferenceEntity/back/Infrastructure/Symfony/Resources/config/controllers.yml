services:
    _defaults:
        public: true

    # Reference entity
    akeneo_referenceentity.infrastructure.action.reference_entity.create:
        class: Akeneo\ReferenceEntity\Infrastructure\Controller\ReferenceEntity\CreateAction
        arguments:
            - '@akeneo_referenceentity.application.reference_entity.create_reference_entity_handler'
            - '@reference_entity_serializer'
            - '@validator'
            - '@oro_security.security_facade'
            - '@pim_user.context.user'

    akeneo_referenceentity.infrastructure.action.reference_entity.index:
        class: Akeneo\ReferenceEntity\Infrastructure\Controller\ReferenceEntity\IndexAction
        arguments:
            - '@akeneo_referenceentity.infrastructure.persistence.query.find_reference_entity_items'

    akeneo_referenceentity.infrastructure.action.reference_entity.get:
        class: Akeneo\ReferenceEntity\Infrastructure\Controller\ReferenceEntity\GetAction
        arguments:
            - '@akeneo_referenceentity.infrastructure.persistence.query.find_reference_entity_details'
            - '@akeneo_referenceentity.application.reference_entity_permission.can_edit_reference_entity_query_handler'
            - '@security.token_storage'

    akeneo_referenceentity.infrastructure.action.reference_entity.edit:
        class: Akeneo\ReferenceEntity\Infrastructure\Controller\ReferenceEntity\EditAction
        arguments:
            - '@akeneo_referenceentity.application.reference_entity.edit_reference_entity_handler'
            - '@akeneo_referenceentity.application.reference_entity_permission.can_edit_reference_entity_query_handler'
            - '@security.token_storage'
            - '@reference_entity_serializer'
            - '@validator'

    akeneo_referenceentity.infrastructure.action.reference_entity.delete:
        class: Akeneo\ReferenceEntity\Infrastructure\Controller\ReferenceEntity\DeleteAction
        arguments:
        - '@oro_security.security_facade'
        - '@akeneo_referenceentity.application.reference_entity_permission.can_edit_reference_entity_query_handler'
        - '@security.token_storage'
        - '@serializer'
        - '@validator'
        - '@akeneo_referenceentity.application.reference_entity.delete_reference_entity_handler'

    # Reference Entity Permissions
    akeneo_referenceentity.infrastructure.action.reference_entity_permission.get:
        class: Akeneo\ReferenceEntity\Infrastructure\Controller\ReferenceEntityPermission\GetAction
        arguments:
            - '@akeneo.referencentity.infrastructure.persistence.query.find_reference_entity_permissions_details'
            - '@validator'
            - '@serializer'

    akeneo_referenceentity.infrastructure.action.reference_entity_permission.set:
        class: Akeneo\ReferenceEntity\Infrastructure\Controller\ReferenceEntityPermission\SetAction
        arguments:
            - '@akeneo_referenceentity.application.reference_entity_permission.set_reference_entity_permissions_handler'
            - '@akeneo_referenceentity.application.reference_entity_permission.can_edit_reference_entity_query_handler'
            - '@security.token_storage'
            - '@oro_security.security_facade'
            - '@validator'
            - '@serializer'

    # Attributes
    akeneo_referenceentity.infrastructure.action.attribute.create:
        class: Akeneo\ReferenceEntity\Infrastructure\Controller\Attribute\CreateAction
        arguments:
            - '@akeneo_referenceentity.application.attribute.create_attribute_handler'
            - '@akeneo_referenceentity.infrastructure.persistence.query.find_attribute_next_order'
            - '@akeneo_referenceentity.application.registry.create_attribute_command_factory_registry'
            - '@akeneo_referenceentity.application.reference_entity_permission.can_edit_reference_entity_query_handler'
            - '@security.token_storage'
            - '@serializer'
            - '@validator'
            - '@oro_security.security_facade'

    akeneo_referenceentity.infrastructure.action.attribute.index:
        class: Akeneo\ReferenceEntity\Infrastructure\Controller\Attribute\IndexAction
        arguments:
            - '@akeneo_referenceentity.infrastructure.persistence.query.find_attributes_details'
            - '@akeneo_referenceentity.infrastructure.persistence.query.reference_entity_exists'

    akeneo_referenceentity.infrastructure.action.attribute.edit:
        class: Akeneo\ReferenceEntity\Infrastructure\Controller\Attribute\EditAction
        arguments:
            - '@akeneo_referenceentity.application.factory.edit_attribute_command_factory'
            - '@akeneo_referenceentity.application.attribute.edit_attribute_handler'
            - '@akeneo_referenceentity.application.reference_entity_permission.can_edit_reference_entity_query_handler'
            - '@security.token_storage'
            - '@serializer'
            - '@validator'
            - '@oro_security.security_facade'

    akeneo_referenceentity.infrastructure.action.attribute.delete:
        class: Akeneo\ReferenceEntity\Infrastructure\Controller\Attribute\DeleteAction
        arguments:
            - '@akeneo_referenceentity.application.attribute.delete_attribute_handler'
            - '@oro_security.security_facade'
            - '@akeneo_referenceentity.application.reference_entity_permission.can_edit_reference_entity_query_handler'
            - '@security.token_storage'

    #  Records
    akeneo_referenceentity.infrastructure.action.record.create:
        class: Akeneo\ReferenceEntity\Infrastructure\Controller\Record\CreateAction
        arguments:
            - '@akeneo_referenceentity.application.record.create_record_handler'
            - '@akeneo_referenceentity.infrastructure.search.elasticsearch.record_indexer'
            - '@akeneo_referenceentity.application.reference_entity_permission.can_edit_reference_entity_query_handler'
            - '@security.token_storage'
            - '@reference_entity_serializer'
            - '@validator'
            - '@oro_security.security_facade'

    akeneo_referenceentity.infrastructure.action.record.index:
        class: Akeneo\ReferenceEntity\Infrastructure\Controller\Record\IndexAction
        arguments:
          - '@akeneo_referenceentity.application.record.search_record'

    akeneo_referenceentity.infrastructure.action.record.get:
        class: Akeneo\ReferenceEntity\Infrastructure\Controller\Record\GetAction
        arguments:
            - '@akeneo_referenceentity.infrastructure.persistence.query.find_record_details'
            - '@akeneo_referenceentity.application.reference_entity_permission.can_edit_reference_entity_query_handler'
            - '@security.token_storage'

    akeneo_referenceentity.infrastructure.action.record.edit:
        class: Akeneo\ReferenceEntity\Infrastructure\Controller\Record\EditAction
        arguments:
            - '@akeneo_referenceentity.application.factory.record.edit_record_command_factory'
            - '@akeneo_referenceentity.application.record.edit_record_handler'
            - '@validator'
            - '@akeneo_referenceentity.application.reference_entity_permission.can_edit_reference_entity_query_handler'
            - '@security.token_storage'
            - '@serializer'

    akeneo_referenceentity.infrastructure.action.record.delete:
        class: Akeneo\ReferenceEntity\Infrastructure\Controller\Record\DeleteAction
        arguments:
            - '@akeneo_referenceentity.application.record.delete_record_handler'
            - '@oro_security.security_facade'
            - '@akeneo_referenceentity.application.reference_entity_permission.can_edit_reference_entity_query_handler'
            - '@security.token_storage'
            - '@akeneo_referenceentity.infrastructure.search.elasticsearch.record_indexer'
            - '@validator'
            - '@reference_entity_serializer'

    akeneo_referenceentity.infrastructure.action.record.mass_delete:
        class: Akeneo\ReferenceEntity\Infrastructure\Controller\Record\MassDeleteAction
        arguments:
            - '@akeneo_referenceentity.application.record.mass_delete.mass_delete_records_handler'
            - '@oro_security.security_facade'
            - '@akeneo_referenceentity.application.reference_entity_permission.can_edit_reference_entity_query_handler'
            - '@security.token_storage'

    # Connector
    akeneo_referenceentity.infrastructure.connector.action.record.get:
        class: Akeneo\ReferenceEntity\Infrastructure\Connector\Api\Record\GetConnectorRecordAction
        arguments:
            - '@akeneo_referenceentity.infrastructure.persistence.query.find_connector_record_by_reference_entity_and_code'
            - '@akeneo_referenceentity.infrastructure.persistence.query.reference_entity_exists'
            - '@akeneo_referenceentity.infrasctucture.connector.add_hal_download_link_to_record_images'

    akeneo_referenceentity.infrasctucture.connector.add_hal_download_link_to_record_images:
        class: Akeneo\ReferenceEntity\Infrastructure\Connector\Api\Record\Hal\AddHalDownloadLinkToRecordImages
        arguments:
            - '@router'
            - '@akeneo_referenceentity.infrastructure.persistence.query.find_image_attribute_codes'

    akeneo_referenceentity.infrasctucture.connector.add_hal_download_link_to_reference_entity_image:
        class: Akeneo\ReferenceEntity\Infrastructure\Connector\Api\ReferenceEntity\Hal\AddHalDownloadLinkToReferenceEntityImage
        arguments:
            - '@router'

    akeneo_referenceentity.infrastructure.connector.add_hal_self_link_to_normalized_connector_attribute:
        class: Akeneo\ReferenceEntity\Infrastructure\Connector\Api\Attribute\Hal\AddHalSelfLinkToNormalizedConnectorAttribute
        arguments:
            - '@router'

    akeneo_referenceentity.infrastructure.connector.validate_attribute_properties_immutability:
        class: Akeneo\ReferenceEntity\Infrastructure\Connector\Api\Attribute\ValidateAttributePropertiesImmutability
        arguments:
            - '@akeneo_referenceentity.infrastructure.persistence.query.find_connector_attribute_by_identifier_and_code'

    akeneo_referenceentity.infrastructure.connector.action.records.get:
        class: Akeneo\ReferenceEntity\Infrastructure\Connector\Api\Record\GetConnectorRecordsAction
        arguments:
            - '@akeneo_referenceentity.infrastructure.persistence.query.reference_entity_exists'
            - '@akeneo_referenceentity.application.record.search_connector_record'
            - '@pim_api.pagination.search_after_hal_paginator'
            - '@akeneo_referenceentity.infrasctucture.connector.add_hal_download_link_to_record_images'
            - '%reference_entity_connector_records_limit_per_page%'
            - '@validator'
            - '@akeneo_referenceentity.infrastructure.connector.api.search_filters_validator'

    akeneo_referenceentity.infrastructure.connector.action.reference_entity.get:
        class: Akeneo\ReferenceEntity\Infrastructure\Connector\Api\ReferenceEntity\GetConnectorReferenceEntityAction
        arguments:
            - '@akeneo_referenceentity.infrastructure.persistence.query.find_connector_reference_entity_by_reference_entity_identifier'
            - '@akeneo_referenceentity.infrastructure.persistence.query.reference_entity_exists'
            - '@akeneo_referenceentity.infrasctucture.connector.add_hal_download_link_to_reference_entity_image'

    akeneo_referenceentity.infrastructure.connector.action.reference_entities.get:
        class: Akeneo\ReferenceEntity\Infrastructure\Connector\Api\ReferenceEntity\GetConnectorReferenceEntitiesAction
        arguments:
            - '@akeneo_referenceentity.infrastructure.persistence.query.find_connector_reference_entity_items'
            - '@pim_api.pagination.search_after_hal_paginator'
            - '@akeneo_referenceentity.infrasctucture.connector.add_hal_download_link_to_reference_entity_image'
            - '%reference_entity_connector_reference_entities_limit_per_page%'

    akeneo_referenceentity.infrastructure.connector.action.reference_entity.create_or_update:
        class: Akeneo\ReferenceEntity\Infrastructure\Connector\Api\ReferenceEntity\CreateOrUpdateReferenceEntityAction
        arguments:
            - '@akeneo_referenceentity.infrastructure.persistence.query.reference_entity_exists'
            - '@validator'
            - '@akeneo_referenceentity.application.reference_entity.create_reference_entity_handler'
            - '@akeneo_referenceentity.application.reference_entity.edit_reference_entity_handler'
            - '@router'
            - '@akeneo_referenceentity.infrastructure.connector.api.reference_entity_validator'
            - '@akeneo_referenceentity.infrastructure.persistence.query.find_file_data_by_file_key'
            - '@akeneo_referenceentity.infrastructure.persistence.repository.reference_entity'

    akeneo_referenceentity.infrastructure.connector.action.record.create_or_update:
        class: Akeneo\ReferenceEntity\Infrastructure\Connector\Api\Record\CreateOrUpdateRecordAction
        arguments:
            - '@akeneo_referenceentity.infrastructure.persistence.query.reference_entity_exists'
            - '@akeneo_referenceentity.infrastructure.persistence.query.record_exists'
            - '@akeneo_referenceentity.application.factory.record.connector.edit_record_command_factory'
            - '@akeneo_referenceentity.application.record.edit_record_handler'
            - '@akeneo_referenceentity.application.record.create_record_handler'
            - '@router'
            - '@akeneo_referenceentity.infrastructure.connector.api.record_validator'
            - '@validator'

    akeneo_referenceentity.infrastructure.connector.action.records.create_or_update:
        class: Akeneo\ReferenceEntity\Infrastructure\Connector\Api\Record\CreateOrUpdateRecordsAction
        arguments:
            - '@akeneo_referenceentity.infrastructure.persistence.query.reference_entity_exists'
            - '@akeneo_referenceentity.infrastructure.persistence.query.record_exists'
            - '@akeneo_referenceentity.application.factory.record.connector.edit_record_command_factory'
            - '@akeneo_referenceentity.application.record.edit_record_handler'
            - '@akeneo_referenceentity.application.record.create_record_handler'
            - '@router'
            - '@validator'
            - '@pim_api.normalizer.exception.violation'
            - '@akeneo_referenceentity.infrastructure.connector.api.record_validator'
            - '@akeneo_referenceentity.infrastructure.connector.api.record_list_validator'
            - '%reference_entity_connector_maximum_records_to_process_per_request%'

    akeneo_referenceentity.infrastructure.connector.action.reference_entity_attributes.get:
        class: Akeneo\ReferenceEntity\Infrastructure\Connector\Api\Attribute\GetConnectorReferenceEntityAttributesAction
        arguments:
            - '@akeneo_referenceentity.infrastructure.persistence.query.find_connector_reference_entity_attributes_by_reference_entity_identifier'
            - '@akeneo_referenceentity.infrastructure.persistence.query.reference_entity_exists'
            - '@akeneo_referenceentity.infrastructure.connector.add_hal_self_link_to_normalized_connector_attribute'

    akeneo_referenceentity.infrastructure.connector.action.reference_entity_attribute.get:
        class: Akeneo\ReferenceEntity\Infrastructure\Connector\Api\Attribute\GetConnectorAttributeAction
        arguments:
            - '@akeneo_referenceentity.infrastructure.persistence.query.find_connector_attribute_by_identifier_and_code'
            - '@akeneo_referenceentity.infrastructure.persistence.query.reference_entity_exists'

    akeneo_referenceentity.infrastructure.connector.action.reference_entity_attribute.create_or_update:
        class: Akeneo\ReferenceEntity\Infrastructure\Connector\Api\Attribute\CreateOrUpdateAttributeAction
        arguments:
            - '@akeneo_referenceentity.application.registry.create_attribute_command_factory_registry'
            - '@akeneo_referenceentity.infrastructure.persistence.query.find_attribute_next_order'
            - '@akeneo_referenceentity.infrastructure.persistence.query.attribute_exists'
            - '@akeneo_referenceentity.application.attribute.create_attribute_handler'
            - '@router'
            - '@akeneo.referencentity.infrastructure.persistence.query.get_attribute_identifier'
            - '@akeneo_referenceentity.application.factory.edit_attribute_command_factory'
            - '@akeneo_referenceentity.application.attribute.edit_attribute_handler'
            - '@akeneo_referenceentity.infrastructure.persistence.query.reference_entity_exists'
            - '@validator'
            - '@akeneo_referenceentity.infrastructure.connector.api.create.attribute_creation_validator'
            - '@akeneo_referenceentity.infrastructure.connector.api.edit.attribute_edition_validator'
            - '@akeneo_referenceentity.infrastructure.connector.validate_attribute_properties_immutability'

    akeneo_referenceentity.infrastructure.connector.action.reference_entity_attribute_option.create_or_update:
        class: Akeneo\ReferenceEntity\Infrastructure\Connector\Api\Attribute\CreateOrUpdateAttributeOptionAction
        arguments:
            - '@router'
            - '@akeneo_referenceentity.infrastructure.connector.api.attribute_option_validator'
            - '@validator'
            - '@akeneo_referenceentity.infrastructure.persistence.query.reference_entity_exists'
            - '@akeneo_referenceentity.infrastructure.persistence.query.attribute_exists'
            - '@akeneo_referenceentity.domain.persistence.query.attribute_supports_options'
            - '@akeneo.referencentity.infrastructure.persistence.query.get_attribute_identifier'
            - '@akeneo_referenceentity.infrastructure.persistence.repository.attribute'
            - '@akeneo_referenceentity.application.attribute.edit_attribute_option_handler'
            - '@akeneo_referenceentity.application.attribute.append_attribute_option_handler'

    akeneo_referenceentity.infrastructure.connector.action.reference_entity_attribute_option.get:
        class: Akeneo\ReferenceEntity\Infrastructure\Connector\Api\Attribute\GetConnectorAttributeOptionAction
        arguments:
            - '@akeneo_referenceentity.infrastructure.persistence.query.find_connector_attribute_option'
            - '@akeneo_referenceentity.infrastructure.persistence.query.reference_entity_exists'

    akeneo_referenceentity.infrastructure.connector.action.media_file_download:
        class: Akeneo\ReferenceEntity\Infrastructure\Connector\Api\MediaFile\DownloadMediaFileAction
        arguments:
            - '@akeneo_referenceentity.infrastructure.persistence.repository.media_file'
            - '@akeneo_file_storage.file_storage.filesystem_provider'

    akeneo_referenceentity.infrastructure.connector.action.reference_entity_attribute_options.get:
        class: Akeneo\ReferenceEntity\Infrastructure\Connector\Api\Attribute\GetConnectorAttributeOptionsAction
        arguments:
            - '@akeneo_referenceentity.infrastructure.persistence.query.find_connector_attribute_options'
            - '@akeneo_referenceentity.infrastructure.persistence.query.reference_entity_exists'
            - '@akeneo_referenceentity.infrastructure.persistence.query.attribute_exists'
            - '@akeneo_referenceentity.domain.persistence.query.attribute_supports_options'

    akeneo_referenceentity.infrastructure.connector.action.media_file_upload:
        class: Akeneo\ReferenceEntity\Infrastructure\Connector\Api\MediaFile\UploadMediaFileAction
        arguments:
            - '@akeneo_file_storage.file_storage.file.file_storer'
            - '@router'
