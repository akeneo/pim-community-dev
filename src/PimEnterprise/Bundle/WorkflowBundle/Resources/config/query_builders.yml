services:
    pimee_workflow.doctrine.query.published_product_query_builder_factory:
        class: '%pim_catalog.query.elasticsearch.product_query_builder_factory.class%'
        arguments:
            - '%pim_catalog.query.product_query_builder.class%'
            - '@pim_catalog.repository.attribute'
            - '@pim_catalog.query.filter.product_registry'
            - '@pim_catalog.query.sorter.registry'
            - '@pimee_workflow.factory.published_product_cursor'
            - '@pim_catalog.query.product_query_builder_resolver'

    pimee_workflow.doctrine.query.published_product_query_builder_from_size_factory:
        class: '%pim_catalog.query.elasticsearch.product_query_builder_factory.class%'
        arguments:
            - '%pim_catalog.query.product_query_builder.class%'
            - '@pim_catalog.repository.attribute'
            - '@pim_catalog.query.filter.product_registry'
            - '@pim_catalog.query.sorter.registry'
            - '@pimee_workflow.factory.published_product_from_size_cursor'
            - '@pim_catalog.elasticsearch.product_query_builder_from_size_resolver'

    pimee_workflow.doctrine.query.published_product_query_builder_search_after_size_factory:
        class: '%pim_catalog.query.elasticsearch.product_query_builder_factory.class%'
        arguments:
            - '%pim_catalog.query.product_query_builder.class%'
            - '@pim_catalog.repository.attribute'
            - '@pim_catalog.query.filter.product_registry'
            - '@pim_catalog.query.sorter.registry'
            - '@pimee_workflow.factory.published_product_search_after_size_cursor'
            - '@pim_catalog.elasticsearch.product_query_builder_search_after_resolver'

    pimee_workflow.doctrine.query.published_product_query_builder_factory_with_permissions:
        class: '%pimee_catalog.query.elasticsearch.product_query_builder_factory.class%'
        decorates: pimee_workflow.doctrine.query.published_product_query_builder_factory
        decoration_inner_name: pimee_workflow.doctrine.query.published_product_query_builder_factory.without_permission
        arguments:
            - '@pimee_workflow.doctrine.query.published_product_query_builder_factory.without_permission'
            - '@security.token_storage'
            - '@pimee_security.repository.category_access'

    pimee_workflow.doctrine.query.published_product_query_builder_from_size_factory_with_permissions:
        class: '%pimee_catalog.query.elasticsearch.product_query_builder_factory.class%'
        decorates: pimee_workflow.doctrine.query.published_product_query_builder_from_size_factory
        decoration_inner_name: pimee_workflow.doctrine.query.published_product_query_builder_from_size_factory.without_permission
        arguments:
            - '@pimee_workflow.doctrine.query.published_product_query_builder_from_size_factory.without_permission'
            - '@security.token_storage'
            - '@pimee_security.repository.category_access'

    pimee_workflow.doctrine.query.published_product_query_builder_search_after_size_factory_with_permissions:
        class: '%pimee_catalog.query.elasticsearch.product_query_builder_factory.class%'
        decorates: pimee_workflow.doctrine.query.published_product_query_builder_search_after_size_factory
        decoration_inner_name: pimee_workflow.doctrine.query.published_product_query_builder_search_after_size_factory.without_permission
        arguments:
            - '@pimee_workflow.doctrine.query.published_product_query_builder_search_after_size_factory.without_permission'
            - '@security.token_storage'
            - '@pimee_security.repository.category_access'
