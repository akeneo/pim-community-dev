{% import 'PimUIBundle:Default:page_elements.html.twig' as elements %}
{% import 'PimDataGridBundle::macros.html.twig' as dataGrid %}

{% block head_script %}
    {% include 'PimEnterpriseProductAssetBundle:ProductAsset:_create-js-handler.html.twig' %}
{% endblock %}

{% block content %}
<script>
    require(
        [
            'pim/common/breadcrumbs',
            'pim/fetcher-registry',
            'pim/form-builder',
            'oro/mediator'
        ],
        function(
            Breadcrumbs,
            FetcherRegistry,
            FormBuilder,
            mediator
        ) {
            $(function() {
                var breadcrumbs = new Breadcrumbs({
                    config: {
                        tab: 'pim-menu-asset'
                    }
                });
                breadcrumbs.configure().then(function () {
                    breadcrumbs.render();
                    $('*[data-drop-zone="breadcrumbs"]').append(breadcrumbs.$el);
                });

                FetcherRegistry.initialize().done(function () {
                    FormBuilder.buildForm('pim-menu-user-navigation').then(function (form) {
                        form.setElement('.user-menu').render();
                    }.bind(this));
                });

                mediator.trigger('pim_menu:highlight:tab', { extension: 'pim-menu-asset' });
            });
        }
    );
</script>

<div class="AknDefault-mainContent">
    {% set title %}
        {{ 'pimee_product_asset.page_tab.title.index'|trans }}
    {% endset %}

    {% set titleButtons %}
        {% include 'PimEnrichBundle:Locale:_locale_switcher.html.twig' with {
        'locales':           locales,
        'currentLocaleCode': dataLocale.code,
        'routeName':         'pimee_product_asset_index'
        } only %}
    {% endset %}

    {% set buttons %}
        {% if resource_granted('pimee_product_asset_create') %}
            <a class="AknButton AknButton--apply create-asset" href="javascript:void(0);" title="{{ 'btn.create.asset'|trans|capitalize }}" data-form-url="{{ path('pimee_product_asset_create', {'dataLocale': dataLocale.code}) }}">
                {{ 'btn.create.asset'|trans|capitalize }}
            </a>
        {% endif %}
    {% endset %}

    {{ elements.page_header(title, buttons, titleButtons) }}

    {% set categoriesGranted = true %}
    {# This style is temporary and will be dropped on PEFization of this screen #}
    <div class="row-fluid {{ categoriesGranted ? 'has-sidebar': '' }}" style="display: flex; height: 100%; margin-left: -40px; margin-right: -40px;">
        {% if categoriesGranted %}
            <div id="tree" data-datalocale="{{ locale_code() }}" data-name="category" data-type="tree" class="filter-item" data-relatedentity="asset"></div>
        {% endif %}
        <div id="product-grid" style="flex-grow: 1;">
            {{ dataGrid.renderStatefulGrid('asset-grid', { dataLocale: dataLocale.code, currentUser: app.user }, {}, {}, 'pimee_asset_categorytree', true) }}
        </div>
    </div>
</div>
{% endblock %}
