parameters:
    pim_enrich.controller.category_tree.class:              PimEnterprise\Bundle\EnrichBundle\Controller\CategoryTreeController
    pim_enrich.controller.product.class:                    PimEnterprise\Bundle\EnrichBundle\Controller\ProductController
    pim_enrich.controller.product_model.class:              PimEnterprise\Bundle\EnrichBundle\Controller\ProductModelController
    pim_enrich.controller.locale.class:                     PimEnterprise\Bundle\EnrichBundle\Controller\LocaleController
    pimee_enrich.controller.rest.asset_category.class:      PimEnterprise\Bundle\EnrichBundle\Controller\Rest\AssetCategoryController
    pimee_enrich.controller.rule_relation.class:            PimEnterprise\Bundle\EnrichBundle\Controller\RuleRelationController
    pimee_enrich.controller.channel.class:                  PimEnterprise\Bundle\EnrichBundle\Controller\Rest\ChannelController

services:
    # overriden to add security checks and use a smarter product saver which update draft or working copy
    pim_enrich.controller.product:
        class: '%pim_enrich.controller.product.class%'
        arguments:
            - '@translator'
            - '@pim_catalog.repository.product'
            - '@pim_catalog.repository.category'
            - '@pim_catalog.saver.product'
            - '@pim_catalog.builder.product'
            - '@pim_catalog.values_filler.product'
            - '%pim_catalog.entity.category.class%'
            - '@oro_security.security_facade'
            - 'pim_enrich_product_categories_view'
            - '@@PimEnrich/Product/listCategories.json.twig'
            - '@pim_catalog.manager.category'

    pim_enrich.controller.product_model:
        class: '%pim_enrich.controller.product_model.class%'
        arguments:
            - '@pim_catalog.repository.product_model'
            - '@pim_catalog.values_filler.entity_with_family_variant'
            - '@pim_catalog.repository.category'
            - '@oro_security.security_facade'
            - '%pim_catalog.entity.category.class%'
            - 'pim_enrich_product_model_categories_view'
            - '@@PimEnrich/ProductModel/listCategories.json.twig'
            - '@pim_catalog.manager.category'

    pim_enrich.controller.rest.product:
        class: '%pim_enrich.controller.rest.product.class%'
        arguments:
            - '@pim_catalog.repository.product'
            - '@pim_catalog.repository.attribute'
            - '@pim_catalog.updater.product'
            - '@pimee_workflow.saver.product_delegating'
            - '@pim_internal_api_serializer'
            - '@pim_catalog.validator.product'
            - '@pim_user.context.user'
            - '@pim_catalog.filter.chained'
            - '@pimee_enrich.filter.product_edit_data'
            - '@pim_catalog.remover.product'
            - '@pim_catalog.builder.product'
            - '@pim_catalog.localization.localizer.converter'
            - '@pim_catalog.comparator.filter.product'
            - '@pim_enrich.converter.enrich_to_standard.product_value'
            - '@pim_enrich.normalizer.product_violation'
            - '@pim_catalog.builder.variant_product'


    pimee_enrich.controller.rule_relation:
        class: '%pimee_enrich.controller.rule_relation.class%'
        arguments:
            - '@akeneo_rule_engine.repository.rule_relation'
            - '@pim_internal_api_serializer'
            - '@pim_catalog.resolver.fqcn'

    # overidden to filter categories with a category access repository that handles permissions
    pim_enrich.controller.category_tree.product:
        class: '%pim_enrich.controller.category_tree.class%'
        arguments:
            - '@event_dispatcher'
            - '@pim_user.context.user'
            - '@pim_catalog.saver.category'
            - '@pim_catalog.remover.category'
            - '@pim_catalog.factory.category'
            - '@pim_catalog.repository.category'
            - '@oro_security.security_facade'
            - { related_entity: product, form_type: '%pim_enrich.form.type.category.class%', acl: pim_enrich_product, route: pim_enrich }
            - '@pimee_security.repository.category_access'
            - '@security.token_storage'
        calls:
            - [ setContainer, [ '@service_container' ] ]

    pim_enrich.controller.category_tree.published_product:
        class: '%pim_enrich.controller.category_tree.class%'
        arguments:
            - '@event_dispatcher'
            - '@pim_user.context.user'
            - '@pim_catalog.saver.category'
            - '@pim_catalog.remover.category'
            - '@pim_catalog.factory.category'
            - '@pim_catalog.repository.category'
            - '@oro_security.security_facade'
            - { related_entity: published_product, form_type: '%pim_enrich.form.type.category.class%', acl: pim_enrich_product, route: pim_enrich }
            - '@pimee_security.repository.category_access'
            - '@security.token_storage'
        calls:
            - [ setContainer, [ '@service_container' ] ]

    pim_enrich.controller.file:
        class: '%pim_enrich.controller.file.class%'
        arguments:
            - '@liip_imagine.controller'
            - '@akeneo_file_storage.file_storage.filesystem_provider'
            - '@akeneo_file_storage.repository.file_info'
            - '@pim_enrich.guesser.file_type'
            - '@pim_enrich.provider.default_image'
            - ['catalogStorage', 'assetStorage']

    pim_enrich.controller.locale:
        class: '%pim_enrich.controller.locale.class%'
        arguments:
            - '@form.factory'

    pimee_enrich.controller.rest.channel:
        class: '%pimee_enrich.controller.channel.class%'
        arguments:
            - '@pimee_product_asset.repository.channel_configuration'
            - '@pim_internal_api_serializer'

    pim_enrich.controller.rest.attribute:
        class: '%pim_enrich.controller.rest.attribute.class%'
        arguments:
            - '@pim_catalog.repository.attribute'
            - '@pim_internal_api_serializer'
            - '@security.token_storage'
            - '@pim_catalog.filter.chained'
            - '@pimee_enrich.repository.attribute.search'
            - '@pim_catalog.updater.attribute'
            - '@validator'
            - '@pim_catalog.saver.attribute'
            - '@pim_catalog.remover.attribute'
            - '@pim_catalog.factory.attribute'
            - '@pim_user.context.user'
            - '@pim_catalog.localization.localizer.number'
            - '@pim_enrich.normalizer.attribute'
            - '@translator'
            - '@pim_catalog.doctrine.query.attribute_is_an_family_variant_axis'

    pim_enrich.controller.rest.job_instance:
        class: '%pim_enrich.controller.rest.job_instance.class%'
        arguments:
            - '@akeneo_batch.job.job_instance_repository'
            - '@akeneo_batch.job.job_registry'
            - '@pim_serializer'
            - '@akeneo_batch.updater.job_instance'
            - '@akeneo_batch.saver.job_instance'
            - '@akeneo_batch.remover.job_instance'
            - '@validator'
            - '@akeneo_batch.job.job_parameters_validator'
            - '@akeneo_batch.job_parameters_factory'
            - '@pim_connector.launcher.authenticated_job_launcher'
            - '@security.token_storage'
            - '@router'
            - '@pim_enrich.provider.form.chained'
            - '@pim_catalog.filter.chained'
            - '@pim_enrich.normalizer.violation'
            - '@akeneo_batch.job_instance_factory'
            - '@event_dispatcher'
            - '@pim_catalog.filter.chained'
            - '%upload_tmp_dir%'

    pimee_enrich.controller.rest.asset_category:
        class: '%pimee_enrich.controller.rest.asset_category.class%'
        arguments:
            - '@pimee_product_asset.repository.asset_category'
            - '@pim_internal_api_serializer'
