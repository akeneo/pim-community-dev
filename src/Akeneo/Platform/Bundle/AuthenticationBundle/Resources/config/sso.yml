services:
    akeneo_authentication.sso.configuration.repository:
        class: 'Akeneo\Platform\Bundle\AuthenticationBundle\Sso\Configuration\Persistence\Sql\SqlRepository'
        arguments:
            - '@database_connection'

    akeneo_authentication.sso.configuration.create_or_update_handler:
        class: 'Akeneo\Platform\Component\Authentication\Sso\Configuration\Application\CreateOrUpdateConfigurationHandler'
        arguments:
            - '@akeneo_authentication.sso.configuration.repository'

    akeneo_authentication.sso.configuration.ui.controller:
        class: 'Akeneo\Platform\Bundle\AuthenticationBundle\Sso\Configuration\UI\Controller'
        arguments:
            - '@validator'
            - '@pim_internal_api_serializer'
            - '@akeneo_authentication.sso.configuration.create_or_update_handler'
            - '@akeneo_authentication.sso.configuration.repository'
            - '@akeneo_authentication.sso.configuration.service_provider_default_configuration'
            - '@akeneo_authentication.sso.log.create_archive'
            - '%env(AKENEO_PIM_URL)%'

    akeneo_authentication.sso.configuration.service_provider_default_configuration:
        class: 'Akeneo\Platform\Bundle\AuthenticationBundle\Sso\Configuration\ServiceProviderDefaultConfiguration'
        arguments:
            - '%env(AKENEO_PIM_URL)%'

    onelogin_auth:
        class: 'OneLogin\Saml2\Auth'
        factory: 'onelogin_auth.factory:create'

    onelogin_auth.factory:
        class: 'Akeneo\Platform\Bundle\AuthenticationBundle\Sso\OneLoginAuthFactory'
        arguments:
            - '@akeneo_authentication.sso.configuration.repository'
            - '%hslavich_onelogin_saml.settings%'

    akeneo_authentication.sso.log.create_archive:
        class: 'Akeneo\Platform\Bundle\AuthenticationBundle\Sso\Log\CreateArchive'
        arguments:
            - '%logs_dir%'
            - '%tmp_storage_dir%'

    hslavich_onelogin_saml.saml_token_factory:
        class: 'Akeneo\Platform\Bundle\AuthenticationBundle\Sso\SamlTokenFactory'

    akeneo_authentication.sso.firewall_map:
        class: 'Akeneo\Platform\Bundle\AuthenticationBundle\Sso\FirewallMap'
        decorates: 'security.firewall.map'
        decoration_inner_name: 'security.firewall.map.inner'
        arguments:
            - '@security.firewall.map.inner'
            - '@akeneo_authentication.sso.configuration.repository'

    akeneo_authentication.sso.user.factory:
        class: 'Akeneo\Platform\Bundle\AuthenticationBundle\Sso\User\Factory'

    akeneo_authentication.sso.user.unknown_user_exception_listener:
        class: 'Akeneo\Platform\Bundle\AuthenticationBundle\Sso\User\UnknownUserExceptionListener'
        arguments:
            - '@templating'
        tags:
            - { name: kernel.event_listener, event: kernel.exception }

    akeneo_authentication.sso.user.provider:
        class: 'Akeneo\Platform\Bundle\AuthenticationBundle\Sso\User\Provider'
        arguments:
            - '@pim_user.repository.user'
            - '@akeneo_authentication.sso.configuration.repository'
