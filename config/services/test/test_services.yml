parameters:
    comm_panel_api_url: 'http://localhost:8088'
    akeneo_integration_tests.loader.reference_data_loader.class: Akeneo\Test\IntegrationTestsBundle\Loader\ReferenceDataLoader
    akeneo_integration_tests.loader.fixtures_loader.class: Akeneo\Test\IntegrationTestsBundle\Loader\FixturesLoader
    akeneo_integration_tests.loader.database_schema_handler.class: Akeneo\Test\IntegrationTestsBundle\Loader\DatabaseSchemaHandler
    akeneo_integration_tests.doctrine.connection.connection_closer.class: Akeneo\Test\IntegrationTestsBundle\Doctrine\Connection\ConnectionCloser
    akeneo_integration_tests.security.system_user_authenticator.class: Akeneo\Test\IntegrationTestsBundle\Security\SystemUserAuthenticator
    akeneo_integration_tests.launcher.job_launcher.class: Akeneo\Test\IntegrationTestsBundle\Launcher\JobLauncher
    akeneo_integration_tests.launcher.job_execution_observer.class: Akeneo\Test\IntegrationTestsBundle\Jobs\JobExecutionObserver

imports:
    - { resource: ../../../src/Akeneo/Connectivity/Connection/back/tests/CatalogBuilder/Resources/config/loaders.yml }
    - { resource: ../../../src/Akeneo/Connectivity/Connection/back/tests/Integration/Resources/config/services.yml }
    - { resource: ../../../src/Akeneo/Platform/Bundle/FeatureFlagBundle/Resources/config/test_services.yml }

services:

    _defaults:
        public: true

    akeneo_integration_tests.loader.reference_data_loader:
        class: '%akeneo_integration_tests.loader.reference_data_loader.class%'
        arguments:
            - '@doctrine.orm.entity_manager'
            - '%kernel.bundles%'
            - 'AcmeAppBundle'
            - '\Acme\Bundle\AppBundle\Entity\Fabric'
            - '\Acme\Bundle\AppBundle\Entity\Color'

    akeneo_integration_tests.loader.fixtures_loader:
        class: '%akeneo_integration_tests.loader.fixtures_loader.class%'
        arguments:
            - '@kernel'
            - '@akeneo_integration_tests.loader.database_schema_handler'
            - '@akeneo_integration_tests.security.system_user_authenticator'
            - '@akeneo_integration_tests.loader.reference_data_loader'
            - '@oneup_flysystem.archivist_filesystem'
            - '@akeneo_batch.job_repository'
            - '@pim_installer.fixture_loader.job_loader'
            - '@oro_security.acl.manager'
            - '@pim_catalog.elasticsearch.indexer.product'
            - '@pim_catalog.elasticsearch.indexer.product_model'
            - '@akeneo_elasticsearch.registry.clients'
            - '@database_connection'
            - '@akeneo_measure.installer.measurement_installer'
            - '@messenger.transport.business_event'
            - '@event_dispatcher'
            - '@akeneo_integration_tests.launcher.job_launcher'
            - '%env(APP_DATABASE_HOST)%'
            - '%env(APP_DATABASE_NAME)%'
            - '%env(APP_DATABASE_USER)%'
            - '%env(APP_DATABASE_PASSWORD)%'
            - '%kernel.cache_dir%/sql-dump/'
            - '%index_hosts%'
            - '@Akeneo\Connectivity\Connection\Application\Apps\Command\GenerateAsymmetricKeysHandler'

    akeneo_integration_tests.loader.database_schema_handler:
        class: '%akeneo_integration_tests.loader.database_schema_handler.class%'
        arguments:
            - '@database_connection'

    akeneo_integration_tests.doctrine.connection.connection_closer:
        class: '%akeneo_integration_tests.doctrine.connection.connection_closer.class%'
        arguments:
            - '@doctrine'

    akeneo_integration_tests.security.system_user_authenticator:
        class: '%akeneo_integration_tests.security.system_user_authenticator.class%'
        arguments:
            - '@pim_user.factory.user'
            - '@pim_user.repository.group'
            - '@pim_user.repository.role'
            - '@security.token_storage'

    akeneo_integration_tests.launcher.job_launcher:
        class: '%akeneo_integration_tests.launcher.job_launcher.class%'
        arguments:
            - '@kernel'
            - '@database_connection'
            - !tagged akeneo.pim.tests.pub_sub_queue_status.job
            - '@logger'

    akeneo_integration_tests.catalogs:
        class: 'Akeneo\Test\IntegrationTestsBundle\Configuration\Catalog'

    akeneo_integration_tests.message_bus_observer:
        class: Symfony\Component\Messenger\TraceableMessageBus
        decorates: messenger.default_bus
        decoration_inner_name: messenger.default_bus.inner
        arguments:
            - '@messenger.default_bus.inner'
