services:
    # Controllers
    Akeneo\SupplierPortal\Retailer\Infrastructure\ProductFileDropping\Controller\DownloadProductFile:
        public: true
        arguments:
            - '@Akeneo\SupplierPortal\Retailer\Application\ProductFileDropping\DownloadProductFileHandler'
            - '@security.token_storage'

    Akeneo\SupplierPortal\Retailer\Infrastructure\ProductFileDropping\Controller\AllSupplierFilesList:
        public: true
        arguments:
            - '@Akeneo\SupplierPortal\Retailer\Domain\ProductFileDropping\Read\GetAllSupplierFiles'
            - '@Akeneo\SupplierPortal\Retailer\Domain\ProductFileDropping\Read\GetAllSupplierFilesCount'

    Akeneo\SupplierPortal\Retailer\Infrastructure\ProductFileDropping\Controller\SupplierFilesList:
        public: true
        arguments:
            - '@Akeneo\SupplierPortal\Retailer\Domain\ProductFileDropping\Read\GetSupplierFiles'
            - '@Akeneo\SupplierPortal\Retailer\Domain\ProductFileDropping\Read\GetSupplierFilesCount'

    # GCS Bucket services
    Akeneo\SupplierPortal\Retailer\Domain\ProductFileDropping\DownloadStoredProductFile:
        class: Akeneo\SupplierPortal\Retailer\Infrastructure\ProductFileDropping\DownloadStoredProductFileFromGCSBucket
        arguments:
            - '@akeneo_file_storage.file_storage.filesystem_provider'

    Akeneo\SupplierPortal\Retailer\Domain\ProductFileDropping\DeleteProductFilesFromPaths:
        class: Akeneo\SupplierPortal\Retailer\Infrastructure\ProductFileDropping\DeleteProductFilesFromPathsInGCSBucket
        arguments:
            - '@akeneo_file_storage.file_storage.filesystem_provider'
            - '@monolog.logger.supplier_portal'

    Akeneo\SupplierPortal\Retailer\Infrastructure\ProductFileDropping\DeleteUnknownSupplierDirectoriesInGCSBucket:
        arguments:
            - '@akeneo_file_storage.file_storage.filesystem_provider'
            - '@Akeneo\SupplierPortal\Retailer\Domain\Supplier\GetAllSupplierCodes'
            - '@monolog.logger.supplier_portal'

    # PIM Notification service
    Akeneo\SupplierPortal\Retailer\Domain\ProductFileDropping\Notifier:
        class: Akeneo\SupplierPortal\Retailer\Infrastructure\ProductFileDropping\PIMNotifier
        arguments:
            - '@pim_notification.notifier'
            - '@pim_user.repository.user'

    # Query/Handlers
    Akeneo\SupplierPortal\Retailer\Application\ProductFileDropping\DownloadProductFileHandler:
        arguments:
            - '@Akeneo\SupplierPortal\Retailer\Domain\ProductFileDropping\Read\GetProductFilePathAndFileName'
            - '@Akeneo\SupplierPortal\Retailer\Domain\ProductFileDropping\DownloadStoredProductFile'
            - '@event_dispatcher'
            - '@Akeneo\SupplierPortal\Retailer\Domain\Supplier\Read\GetSupplierCodeFromSupplierFileIdentifier'
            - '@monolog.logger.supplier_portal'

    # Queries
    Akeneo\SupplierPortal\Retailer\Domain\ProductFileDropping\Read\GetProductFilePathAndFileName:
        class: Akeneo\SupplierPortal\Retailer\Infrastructure\ProductFileDropping\Query\Sql\DatabaseGetProductFilePathAndFileName
        arguments:
            - '@database_connection'

    # Event subscribers
    Akeneo\SupplierPortal\Retailer\Application\ProductFileDropping\Subscriber\NotifyUsersOnSupplierFileAdded:
        arguments:
            - '@Akeneo\SupplierPortal\Retailer\Domain\ProductFileDropping\Notifier'
        tags:
            - 'kernel.event_subscriber'

    Akeneo\SupplierPortal\Retailer\Infrastructure\ProductFileDropping\Subscriber\LogOnContributorAdded:
        arguments:
            - '@monolog.logger.supplier_portal'
        tags:
            - { name: kernel.event_subscriber }

    Akeneo\SupplierPortal\Retailer\Infrastructure\ProductFileDropping\Subscriber\LogOnProductFileDownloaded:
        arguments:
            - '@monolog.logger.supplier_portal'
        tags:
            - { name: kernel.event_subscriber }

    # Jobs
    supplier_portal.job.clean_supplier_product_files:
        class: '%pim_connector.job.simple_job.class%'
        arguments:
            - 'supplier_portal_supplier_product_files_clean'
            - '@event_dispatcher'
            - '@akeneo_batch.job_repository'
            -
                - '@supplier_portal.job.step.clean_supplier_product_files'
            - false
            - false
        tags:
            - { name: akeneo_batch.job, connector: 'Supplier Portal', type: 'scheduled_job' }

    supplier_portal.job.step.clean_supplier_product_files:
        class: '%pim_connector.step.tasklet.class%'
        arguments:
            - 'generate_dictionary'
            - '@event_dispatcher'
            - '@akeneo_batch.job_repository'
            - '@Akeneo\SupplierPortal\Retailer\Infrastructure\ProductFileDropping\Job\CleanSupplierProductFiles'

    supplier_portal.job_parameters.default_values_provider.clean_supplier_product_files:
        class: Akeneo\Tool\Component\Batch\Job\JobParameters\EmptyDefaultValuesProvider
        arguments:
            - [ 'supplier_portal_supplier_product_files_clean' ]
        tags:
            - { name: akeneo_batch.job.job_parameters.default_values_provider }

    supplier_portal.job_parameters.constraint_collection_provider.clean_supplier_product_files:
        class: Akeneo\Tool\Component\Batch\Job\JobParameters\EmptyConstraintCollectionProvider
        arguments:
            - [ 'supplier_portal_supplier_product_files_clean' ]
        tags:
            - { name: akeneo_batch.job.job_parameters.constraint_collection_provider }

    Akeneo\SupplierPortal\Retailer\Infrastructure\ProductFileDropping\Job\CleanSupplierProductFiles:
        arguments:
            - '@Akeneo\SupplierPortal\Supplier\Domain\ProductFileDropping\GetProductFilePathsOfOldProductFiles'
            - '@Akeneo\SupplierPortal\Retailer\Domain\ProductFileDropping\DeleteProductFilesFromPaths'
            - '@Akeneo\SupplierPortal\Supplier\Domain\ProductFileDropping\DeleteOldProductFiles'
            - '@Akeneo\SupplierPortal\Retailer\Infrastructure\ProductFileDropping\DeleteUnknownSupplierDirectoriesInGCSBucket'
            - '@monolog.logger.supplier_portal'

    # Command
    Akeneo\SupplierPortal\Retailer\Infrastructure\ProductFileDropping\Command\CleanSupplierProductFilesCommand:
        arguments:
            - '@Akeneo\Tool\Bundle\BatchBundle\JobExecution\ExecuteJobExecutionHandler'
            - '@Akeneo\Tool\Bundle\BatchBundle\JobExecution\CreateJobExecutionHandler'
        tags:
            - { name: console.command }
