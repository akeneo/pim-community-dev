parameters:
    pimee_workflow.saver.product_delegating.class: Akeneo\Pim\WorkOrganization\Workflow\Bundle\Doctrine\Common\Saver\DelegatingProductSaver
    pimee_workflow.saver.product_model_delegating.class: Akeneo\Pim\WorkOrganization\Workflow\Bundle\Doctrine\Common\Saver\DelegatingProductModelSaver

services:
    # product working copy saver, we alias the product saver from community edition to make the behavior more explicit
    pimee_workflow.saver.working_copy_product:
        alias: pim_catalog.saver.product

    pimee_workflow.saver.working_copy_product_model:
        alias: pim_catalog.saver.product_model

    pimee_workflow.saver.published_product:
        class: '%pim_catalog.saver.product.class%'
        arguments:
            - '@doctrine.orm.entity_manager'
            - '@event_dispatcher'
            - '@pimee_workflow.synchronizer.published_product_unique_data'

    pimee_workflow.synchronizer.published_product_unique_data:
        class: '%pim_catalog.synchronizer.product_unique_data.class%'
        arguments:
            - '@pimee_workflow.factory.published_product_unique_data'
            - '@pim_catalog.repository.cached_attribute'

    # product draft saver
    pimee_workflow.saver.product_draft:
        class: '%akeneo_storage_utils.saver.base.class%'
        arguments:
            - '@pimee_workflow.object_manager.product_draft'
            - '@event_dispatcher'
            - '%pimee_workflow.model.product_draft.class%'

    pimee_workflow.saver.product_model_draft:
        class: '%akeneo_storage_utils.saver.base.class%'
        arguments:
            - '@doctrine.orm.entity_manager'
            - '@event_dispatcher'
            - '%pimee_workflow.model.product_model_draft.class%'

    # this product saver delegates to draft or working copy savers depending on user permissions
    pimee_workflow.saver.product_delegating:
        class: '%pimee_workflow.saver.product_delegating.class%'
        arguments:
            - '@doctrine.orm.entity_manager'
            - '@event_dispatcher'
            - '@security.authorization_checker'
            - '@pimee_workflow.product.builder.draft'
            - '@security.token_storage'
            - '@pimee_workflow.repository.product_draft'
            - '@pimee_workflow.remover.product_draft'
            - '@pim_catalog.synchronizer.product_unique_data'
            - '@pimee_catalog.security.merger.merge_data_on_product'
            - '@pim_catalog.repository.product_without_permission'
            - '@Akeneo\Pim\WorkOrganization\Workflow\Component\Factory\PimUserDraftSourceFactory'

    pimee_workflow.saver.product_model_delegating:
        class: '%pimee_workflow.saver.product_model_delegating.class%'
        arguments:
            - '@doctrine.orm.entity_manager'
            - '@pim_catalog.saver.product_model'
            - '@pimee_workflow.saver.product_model_draft'
            - '@security.authorization_checker'
            - '@security.token_storage'
            - '@pimee_workflow.product_model.builder.draft'
            - '@pimee_workflow.remover.product_model_draft'
            - '@pimee_catalog.security.merger.merge_data_on_product_model'
            - '@pim_catalog.repository.product_model'
            - '@pimee_workflow.repository.product_model_draft'
            - '@pim_catalog.saver.product_model'
            - '@Akeneo\Pim\WorkOrganization\Workflow\Component\Factory\PimUserDraftSourceFactory'
