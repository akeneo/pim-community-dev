apiVersion: iam.cnrm.cloud.google.com/v1beta1
kind: IAMPolicy
metadata:
  name: {{ include "timmy.fullname" . }}-cloudscheduler-invoker
  namespace: {{ .Release.Namespace | quote }}
  annotations:
    argocd.argoproj.io/sync-wave: "1"
    argocd.argoproj.io/sync-options: "Replace=true"
spec:
  resourceRef:
    apiVersion: cloudfunctions.cnrm.cloud.google.com/v1beta1
    kind: CloudFunctionsFunction
    name: {{ include "timmy.fullname" . }}-{{ .Values.cloudScheduler.functionName }}
  bindings:
    - role: "roles/cloudfunctions.invoker"
      members:
        - "serviceAccount:{{ include "timmy.deploymentGSAEmail" . }}"
