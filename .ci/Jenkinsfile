stage("Test") {
  parallel(
    "A": {
        mypod(label: "test", containers: [
            containerTemplate(name: "php", image: 'php:fpm', resourceRequestCpu: '200m', resourceRequestMemory: '200Mi')
        ]) {
            container("php") {
                sh "sleep 60"
            }
        }
    },
    "B": {
        mypod(label: "test", containers: [
            containerTemplate(name: "php", image: 'php:fpm', resourceRequestCpu: '200m', resourceRequestMemory: '200Mi')
        ]) {
            container("php") {
                sh "sleep 60"
            }
        }
    },
    "C": {
        mypod(label: "test", containers: [
            containerTemplate(name: "php", image: 'php:fpm', resourceRequestCpu: '200m', resourceRequestMemory: '200Mi')
        ]) {
            container("php") {
                sh "sleep 60"
            }
        }
    },
    "D": {
        mypod(label: "test", containers: [
            containerTemplate(name: "php", image: 'php:fpm', resourceRequestCpu: '200m', resourceRequestMemory: '200Mi')
        ]) {
            container("php") {
                sh "sleep 60"
            }
        }
    },
    "E": {
        mypod(label: "test", containers: [
            containerTemplate(name: "php", image: 'php:fpm', resourceRequestCpu: '200m', resourceRequestMemory: '200Mi')
        ]) {
            container("php") {
                sh "sleep 60"
            }
        }
    },
    "F": {
        mypod(label: "test", containers: [
            containerTemplate(name: "php", image: 'php:fpm', resourceRequestCpu: '200m', resourceRequestMemory: '200Mi')
        ]) {
            container("php") {
                sh "sleep 60"
            }
        }
    },
    "G": {
        mypod(label: "test", containers: [
            containerTemplate(name: "php", image: 'php:fpm', resourceRequestCpu: '200m', resourceRequestMemory: '200Mi')
        ]) {
            container("php") {
                sh "sleep 60"
            }
        }
    },
    "H": {
        mypod(label: "test", containers: [
            containerTemplate(name: "php", image: 'php:fpm', resourceRequestCpu: '200m', resourceRequestMemory: '200Mi')
        ]) {
            container("php") {
                sh "sleep 60"
            }
        }
    },
    "I": {
        mypod(label: "test", containers: [
            containerTemplate(name: "php", image: 'php:fpm', resourceRequestCpu: '200m', resourceRequestMemory: '200Mi')
        ]) {
            container("php") {
                sh "sleep 60"
            }
        }
    },
    "J": {
        mypod(label: "test", containers: [
            containerTemplate(name: "php", image: 'php:fpm', resourceRequestCpu: '200m', resourceRequestMemory: '200Mi')
        ]) {
            container("php") {
                sh "sleep 60"
            }
        }
    },
    "K": {
        mypod(label: "test", containers: [
            containerTemplate(name: "php", image: 'php:fpm', resourceRequestCpu: '200m', resourceRequestMemory: '200Mi')
        ]) {
            container("php") {
                sh "sleep 60"
            }
        }
    },
    "L": {
        mypod(label: "test", containers: [
            containerTemplate(name: "php", image: 'php:fpm', resourceRequestCpu: '200m', resourceRequestMemory: '200Mi')
        ]) {
            container("php") {
                sh "sleep 60"
            }
        }
    },
    "M": {
        mypod(label: "test", containers: [
            containerTemplate(name: "php", image: 'php:fpm', resourceRequestCpu: '200m', resourceRequestMemory: '200Mi')
        ]) {
            container("php") {
                sh "sleep 60"
            }
        }
    },
    "N": {
        mypod(label: "test", containers: [
            containerTemplate(name: "php", image: 'php:fpm', resourceRequestCpu: '200m', resourceRequestMemory: '200Mi')
        ]) {
            container("php") {
                sh "sleep 60"
            }
        }
    },
    "O": {
        mypod(label: "test", containers: [
            containerTemplate(name: "php", image: 'php:fpm', resourceRequestCpu: '200m', resourceRequestMemory: '200Mi')
        ]) {
            container("php") {
                sh "sleep 60"
            }
        }
    },
    "P": {
        mypod(label: "test", containers: [
            containerTemplate(name: "php", image: 'php:fpm', resourceRequestCpu: '200m', resourceRequestMemory: '200Mi')
        ]) {
            container("php") {
                sh "sleep 60"
            }
        }
    },
    "Q": {
        mypod(label: "test", containers: [
            containerTemplate(name: "php", image: 'php:fpm', resourceRequestCpu: '200m', resourceRequestMemory: '200Mi')
        ]) {
            container("php") {
                sh "sleep 60"
            }
        }
    },
    "R": {
        mypod(label: "test", containers: [
            containerTemplate(name: "php", image: 'php:fpm', resourceRequestCpu: '200m', resourceRequestMemory: '200Mi')
        ]) {
            container("php") {
                sh "sleep 60"
            }
        }
    },
    "S": {
        mypod(label: "test", containers: [
            containerTemplate(name: "php", image: 'php:fpm', resourceRequestCpu: '200m', resourceRequestMemory: '200Mi')
        ]) {
            container("php") {
                sh "sleep 60"
            }
        }
    },
    "T": {
        mypod(label: "test", containers: [
            containerTemplate(name: "php", image: 'php:fpm', resourceRequestCpu: '200m', resourceRequestMemory: '200Mi')
        ]) {
            container("php") {
                sh "sleep 60"
            }
        }
    },
    "U": {
        mypod(label: "test", containers: [
            containerTemplate(name: "php", image: 'php:fpm', resourceRequestCpu: '200m', resourceRequestMemory: '200Mi')
        ]) {
            container("php") {
                sh "sleep 60"
            }
        }
    },
    "V": {
        mypod(label: "test", containers: [
            containerTemplate(name: "php", image: 'php:fpm', resourceRequestCpu: '200m', resourceRequestMemory: '200Mi')
        ]) {
            container("php") {
                sh "sleep 60"
            }
        }
    },
    "W": {
        mypod(label: "test", containers: [
            containerTemplate(name: "php", image: 'php:fpm', resourceRequestCpu: '200m', resourceRequestMemory: '200Mi')
        ]) {
            container("php") {
                sh "sleep 60"
            }
        }
    },
    "X": {
        mypod(label: "test", containers: [
            containerTemplate(name: "php", image: 'php:fpm', resourceRequestCpu: '200m', resourceRequestMemory: '200Mi')
        ]) {
            container("php") {
                sh "sleep 60"
            }
        }
    },
    "Y": {
        mypod(label: "test", containers: [
            containerTemplate(name: "php", image: 'php:fpm', resourceRequestCpu: '200m', resourceRequestMemory: '200Mi')
        ]) {
            container("php") {
                sh "sleep 60"
            }
        }
    },
    "Z": {
        mypod(label: "test", containers: [
            containerTemplate(name: "php", image: 'php:fpm', resourceRequestCpu: '200m', resourceRequestMemory: '200Mi')
        ]) {
            container("php") {
                sh "sleep 60"
            }
        }
    }
  )
}

def mypod(Map params = [:], Closure body) {
    String label = params.get('label', null)
    String uuid = UUID.randomUUID().toString()

    timeout(time: 4, unit: 'HOURS') {
        return steps.podTemplate(name: label + "-" + uuid, label: label + "-" + uuid, containers: params.get('containers', [])) {
            node(label + "-" + uuid) {
                body()
            }
        }
    }
}