import {useState} from 'react';
import {Meta, Story, ArgsTable, Canvas} from '@storybook/addon-docs/blocks';
import {Table, TableSortDirection} from './Table.tsx';
import {Badge} from '..';

<Meta
  title="Components/Table"
  component={Table}
  argTypes={{
    level: {control: {type: 'select', options: ['primary', 'warning', 'danger']}},
  }}
  args={{level: 'primary', children: 'Table text'}}
/>

# Table

## Usage

TODO

### TODO

TODO

## Playground

<Canvas>
  <Story name="Standard">
    {args => {
      return <Table {...args} />;
    }}
  </Story>
</Canvas>

<ArgsTable story="Standard" />

## Basic table
<Canvas>
    <Story name="Basic Table">
        {args => {
            return (
                <Table selectable={true} amountSelectedRows={0}>
                    <Table.Header>
                        <Table.HeaderCell>Icon</Table.HeaderCell>
                        <Table.HeaderCell sortable={true} onDirectionChange={(direction) => {}} direction='DESC'>Name</Table.HeaderCell>
                        <Table.HeaderCell>Family</Table.HeaderCell>
                        <Table.HeaderCell>Order</Table.HeaderCell>
                        <Table.HeaderCell>Genus</Table.HeaderCell>
                        <Table.HeaderCell>Conservation status</Table.HeaderCell>
                    </Table.Header>
                    <Table.Body>
                        <Table.Row onSelectToggle={(state) => {}} isSelected={true} onClick={() => {}}>
                            <Table.Cell>
                                <img width={44} src='https://res.cloudinary.com/teepublic/image/private/s--_MbNlVzr--/t_Preview/b_rgb:ffffff,c_limit,f_auto,h_630,q_90,w_630/v1493316151/production/designs/1531821_1.jpg'/>
                            </Table.Cell>
                            <Table.Cell>The giant raccoons</Table.Cell>
                            <Table.Cell>Raccoons</Table.Cell>
                            <Table.Cell>Carnivora</Table.Cell>
                            <Table.Cell>Ursus</Table.Cell>
                            <Table.Cell><Badge>VU</Badge></Table.Cell>
                        </Table.Row>
                    </Table.Body>
                </Table>
            );
        }}
    </Story>
</Canvas>

## Sortable header
<Canvas>
    <Story name="Sortable header">
        {args => {
            const [sortedColumn, setSortedColumn] = useState({
                columnName: null,
                sortDirection: null,
            });
            const computeDirection = (columnName) => {
                if (columnName !== sortedColumn.columnName) {
                    return TableSortDirection.NONE;
                }
                return sortedColumn.sortDirection;
            }
            const handleDirectionChange = (columnName) => {
                return (direction) => {
                    setSortedColumn({
                        columnName: columnName,
                        sortDirection: direction
                    })
                }
            }
            const data = [
                {
                    name: 'The giant panda',
                    family: 'Ursidae',
                    order: 'Carnivora',
                    genus: 'Ailuropoda',
                    conservation_status: 'vu',
                    conservation_status_level: 'warning'
                },
                {
                    name: 'Red panda',
                    family: 'Ailuridae',
                    order: 'Carnivora',
                    genus: 'Ailurus',
                    conservation_status: 'en',
                    conservation_status_level: 'danger'
                },
                {
                    name: 'American black bear, not a panda',
                    family: 'Ursidae',
                    order: 'Carnivora',
                    genus: 'Ursus',
                    conservation_status: 'lc',
                    conservation_status_level: 'primary'
                },
            ];
            const sortedData = sortedColumn.columnName === null ? data : data.sort((a, b) => {
                return sortedColumn.sortDirection === TableSortDirection.DESC ?
                    a[sortedColumn.columnName].localeCompare(b[sortedColumn.columnName]) :
                    b[sortedColumn.columnName].localeCompare(a[sortedColumn.columnName]);
            });
            return (
                <Table>
                    <Table.Header>
                        <Table.HeaderCell sortable={true} onDirectionChange={handleDirectionChange('name')} direction={computeDirection('name')}>Name</Table.HeaderCell>
                        <Table.HeaderCell sortable={true} onDirectionChange={handleDirectionChange('family')} direction={computeDirection('family')}>Family</Table.HeaderCell>
                        <Table.HeaderCell>Order</Table.HeaderCell>
                        <Table.HeaderCell>Genus</Table.HeaderCell>
                        <Table.HeaderCell>Conservation status</Table.HeaderCell>
                    </Table.Header>
                    <Table.Body>
                        {
                            sortedData.map((row) => {
                                return (
                                    <Table.Row key={row.name}>
                                        <Table.Cell>{row.name}</Table.Cell>
                                        <Table.Cell>{row.family}</Table.Cell>
                                        <Table.Cell>{row.order}</Table.Cell>
                                        <Table.Cell>{row.genus}</Table.Cell>
                                        <Table.Cell>
                                            <Badge level={row.conservation_status_level}>{row.conservation_status}</Badge>
                                        </Table.Cell>
                                    </Table.Row>
                                )
                            })
                        }
                    </Table.Body>
                </Table>
            );
        }}
    </Story>
</Canvas>

## Selectable lines
<Canvas>
    <Story name="Selectable lines">
        {args => {
            const [selectedLines, setSelectedLines] = useState([]);
            const handleToggleSelected = (lineId) => {
                if (selectedLines.indexOf(lineId) === -1) {
                    setSelectedLines([...selectedLines, lineId]);
                } else {
                    setSelectedLines(selectedLines.filter(currentValue => currentValue !== lineId));
                }
            }
            const data = [
                {
                    id: 1,
                    name: 'The giant panda',
                    family: 'Ursidae',
                    order: 'Carnivora',
                    genus: 'Ailuropoda',
                    conservation_status: 'vu',
                    conservation_status_level: 'warning'
                },
                {
                    id: 2,
                    name: 'Red panda',
                    family: 'Ailuridae',
                    order: 'Carnivora',
                    genus: 'Ailurus',
                    conservation_status: 'en',
                    conservation_status_level: 'danger'
                },
                {
                    id: 3,
                    name: 'American black bear, not a panda',
                    family: 'Ursidae',
                    order: 'Carnivora',
                    genus: 'Ursus',
                    conservation_status: 'lc',
                    conservation_status_level: 'primary'
                },
            ];
            return (
                <Table isSelectable={true} amountSelectedRows={selectedLines.length}>
                    <Table.Header>
                        <Table.HeaderCell>Name</Table.HeaderCell>
                        <Table.HeaderCell>Family</Table.HeaderCell>
                        <Table.HeaderCell>Order</Table.HeaderCell>
                        <Table.HeaderCell>Genus</Table.HeaderCell>
                        <Table.HeaderCell>Conservation status</Table.HeaderCell>
                    </Table.Header>
                    <Table.Body>
                        {
                            data.map((row) => {
                                return (
                                    <Table.Row key={row.id} onSelectToggle={() => {handleToggleSelected(row.id)}} isSelected={selectedLines.indexOf(row.id) !== -1}>
                                        <Table.Cell>{row.name}</Table.Cell>
                                        <Table.Cell>{row.family}</Table.Cell>
                                        <Table.Cell>{row.order}</Table.Cell>
                                        <Table.Cell>{row.genus}</Table.Cell>
                                        <Table.Cell>
                                            <Badge level={row.conservation_status_level}>{row.conservation_status}</Badge>
                                        </Table.Cell>
                                    </Table.Row>
                                )
                            })
                        }
                    </Table.Body>
                </Table>
            );
        }}
    </Story>
</Canvas>


## Clickable lines
<Canvas>
    <Story name="Clickable lines">
        {args => {
            const [data, setData] = useState([
                {
                    id: 1,
                    name: 'The giant panda',
                    family: 'Ursidae',
                    order: 'Carnivora',
                    genus: 'Ailuropoda',
                    conservation_status: 'vu',
                    conservation_status_level: 'warning',
                    count: 0,
                },
                {
                    id: 2,
                    name: 'Red panda',
                    family: 'Ailuridae',
                    order: 'Carnivora',
                    genus: 'Ailurus',
                    conservation_status: 'en',
                    conservation_status_level: 'danger',
                    count: 0,
                },
                {
                    id: 3,
                    name: 'American black bear, not a panda',
                    family: 'Ursidae',
                    order: 'Carnivora',
                    genus: 'Ursus',
                    conservation_status: 'lc',
                    conservation_status_level: 'primary',
                    count: 0,
                },
            ]);
            const handleClick = (rowId) => {
                setData(data => {
                    return data.map((row) => {
                        return row.id === rowId ? {...row, count: row.count + 1} : row;
                    })
                })
            }
            return (
                <Table>
                    <Table.Header>
                        <Table.HeaderCell>Name</Table.HeaderCell>
                        <Table.HeaderCell>Family</Table.HeaderCell>
                        <Table.HeaderCell>Order</Table.HeaderCell>
                        <Table.HeaderCell>Genus</Table.HeaderCell>
                        <Table.HeaderCell>Conservation status</Table.HeaderCell>
                        <Table.HeaderCell>Click count</Table.HeaderCell>
                    </Table.Header>
                    <Table.Body>
                        {
                            data.map((row) => {
                                return (
                                    <Table.Row key={row.id} onClick={() => handleClick(row.id)}>
                                        <Table.Cell>{row.name}</Table.Cell>
                                        <Table.Cell>{row.family}</Table.Cell>
                                        <Table.Cell>{row.order}</Table.Cell>
                                        <Table.Cell>{row.genus}</Table.Cell>
                                        <Table.Cell>
                                            <Badge level={row.conservation_status_level}>{row.conservation_status}</Badge>
                                        </Table.Cell>
                                        <Table.Cell>{row.count}</Table.Cell>
                                    </Table.Row>
                                )
                            })
                        }
                    </Table.Body>
                </Table>
            );
        }}
    </Story>
</Canvas>
