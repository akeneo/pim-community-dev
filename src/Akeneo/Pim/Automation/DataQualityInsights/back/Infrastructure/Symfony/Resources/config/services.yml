parameters:
    env(DATA_QUALITY_INSIGHTS_JWT_VERIFYING_KEY): 'OXvfb6/iSYOgqD8w044j8PTMWDwbSKjgJDhrNu3NwAc='
    env(AKENEO_PIM_URL): ''
    env(PAPO_PROJECT_CODE_TRUNCATED): ''
    env(PAPO_PROJECT_CODE_HASHED): ''

services:
    Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Clock\SystemClock: ~

    Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Install\InitializeCriteriaEvaluation:
        public: true
        arguments:
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\FeatureFlag\DataQualityInsightsFeature'
            - '@database_connection'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Application\CriteriaEvaluation\CreateProductsCriteriaEvaluations'
            - '@akeneo_batch.job.job_instance_repository'
            - '@security.token_storage'
            - '@akeneo_batch_queue.launcher.queue_job_launcher'
            - '@pim_user.factory.user'

    Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Install\InitializeJobs:
        public: true
        arguments:
            - '@pim_enrich.repository.job_instance'
            - '@database_connection'

    Akeneo\Pim\Automation\DataQualityInsights\Application\CriteriaEvaluation\CreateProductsCriteriaEvaluations:
        arguments:
            - '@Akeneo\Pim\Automation\DataQualityInsights\Application\CriteriaEvaluationRegistry'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Repository\CriterionEvaluationRepository'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Clock\SystemClock'

    Akeneo\Pim\Automation\DataQualityInsights\Application\CriteriaEvaluationRegistry:
        arguments:
            - !tagged akeneo.pim.automation.data_quality_insights.evaluate_criterion

    Akeneo\Pim\Automation\DataQualityInsights\Application\CriteriaEvaluation\EvaluatePendingCriteria:
        arguments:
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Repository\CriterionEvaluationRepository'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Application\CriteriaEvaluationRegistry'
            - '@logger'

    Akeneo\Pim\Automation\DataQualityInsights\Application\GetProductAxesRates:
        arguments:
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Query\GetLatestCriteriaEvaluationsByProductIdQuery'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Application\Axis\ComputeEnrichmentRates'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Application\Axis\ComputeConsistencyRates'

    Akeneo\Pim\Automation\DataQualityInsights\Application\GetProductEvaluation:
        arguments:
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Query\GetLatestCriteriaEvaluationsByProductIdQuery'



    Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Consistency\TitleFormattingService:
        arguments:
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Client\Franklin'
            - '@logger'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Consistency\TitleFormattingToken'

    Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Consistency\TitleFormattingToken:
        arguments:
            - '%env(DATA_QUALITY_INSIGHTS_JWT_VERIFYING_KEY)%'
            - '%env(AKENEO_PIM_URL)%'
            - '%kernel.project_dir%'
            - '%env(PAPO_PROJECT_CODE_TRUNCATED)%'
            - '%env(PAPO_PROJECT_CODE_HASHED)%'

    Akeneo\Pim\Automation\DataQualityInsights\Application\ConsolidateProductAxisRates:
        arguments:
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Query\GetLatestCriteriaEvaluationsByProductIdQuery'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Application\Axis\ComputeEnrichmentRates'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Application\Axis\ComputeConsistencyRates'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Repository\ProductAxisRateRepository'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Clock\SystemClock'

    Akeneo\Pim\Automation\DataQualityInsights\Application\ConsolidateDashboardRates:
        arguments:
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Query\GetRanksDistributionFromProductAxisRatesQuery'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Query\GetAllCategoryCodesQuery'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Query\GetAllFamilyCodesQuery'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Repository\DashboardRatesProjectionRepository'

    Akeneo\Pim\Automation\DataQualityInsights\Application\PurgeOutdatedData:
        arguments:
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Repository\DashboardRatesProjectionRepository'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Repository\CriterionEvaluationRepository'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Repository\ProductAxisRateRepository'

# PIM enrichment BC anti-corruption layers
    akeneo.pim.automation.calculate_completeness_of_required_attributes:
        class: Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Enrichment\CalculateProductCompleteness
        arguments:
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Query\GetProductIdentifierFromProductIdQuery'
            - '@pim_catalog.completeness.calculator'

    akeneo.pim.automation.calculate_completeness_of_non_required_attributes:
        class: Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Enrichment\CalculateProductCompleteness
        arguments:
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Query\GetProductIdentifierFromProductIdQuery'
            - '@akeneo.pim.automation.completeness.non_required_attributes.calculator'

    akeneo.pim.automation.completeness.non_required_attributes.calculator:
        class: Akeneo\Pim\Enrichment\Component\Product\Completeness\CompletenessCalculator
        arguments:
            - '@akeneo.pim.enrichment.completeness.query.get_product_masks'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Query\GetNonRequiredAttributesMasksQuery'

    Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Enrichment\BuildProductValues:
        arguments:
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Query\GetProductRawValuesByAttributeQuery'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Query\GetLocalesByChannelQuery'

    Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Enrichment\GetProductAttributesCodes:
        arguments:
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Query\GetAttributesByTypeFromProductQuery'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Query\GetAttributeAsMainTitleValueFromProductId'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Query\GetLocalizableAttributesByTypeFromProductQuery'

    Akeneo\Pim\Automation\DataQualityInsights\Application\CriteriaEvaluation\Consistency\TextChecker: '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Consistency\TextChecker\AspellChecker'
    Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Consistency\TextChecker\AspellChecker:
        arguments:
            $binaryPath: '%env(ASPELL_BINARY_PATH)%'
            $aspellDictionary: '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Consistency\TextChecker\AspellDictionary'
            $globalOffsetCalculator: '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Consistency\TextChecker\Source\GlobalOffsetCalculator'
            $textCheckerDictionaryRepository: '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Repository\TextCheckerDictionaryRepository'

    Akeneo\Pim\Automation\DataQualityInsights\Application\CriteriaEvaluation\Consistency\SupportedLocaleChecker: '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Consistency\TextChecker\SupportedPrefixLocaleChecker'
    Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Consistency\TextChecker\SupportedPrefixLocaleChecker: ~
    Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Consistency\TextChecker\Source\GlobalOffsetCalculator: ~

    Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Consistency\TextChecker\ProductValueInDatabaseDictionarySource:
        public: true
        arguments:
            $db: '@database_connection'

    Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Consistency\TextChecker\AspellDictionaryLocalFilesystem: ~

    Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Consistency\TextChecker\AspellDictionary:
        arguments:
            $mountManager: '@oneup_flysystem.mount_manager'
            $clock: '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Clock\SystemClock'
            $localFilesystemProvider : '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Consistency\TextChecker\AspellDictionaryLocalFilesystem'

    Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Consistency\TextChecker\AspellDictionaryGenerator:
        public: true
        arguments:
            $aspellDictionary: '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Consistency\TextChecker\AspellDictionary'
            $allActivatedLocalesQuery: '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Query\GetAllActivatedLocalesQuery'
            $clock: '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Clock\SystemClock'
