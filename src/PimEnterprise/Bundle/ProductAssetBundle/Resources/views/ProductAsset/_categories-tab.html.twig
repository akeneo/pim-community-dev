<div class="tabsection tab-pane" id="pimee_product_asset-tabs-categories">
    <script type="text/javascript">
        require(
            ['jquery', 'pim/tree/associate'],
            function ($, TreeAssociate) {
                'use strict';
                $(function () {
                    new TreeAssociate('#trees', '#{{ form.categories.vars.id }}', {
                        list_categories: 'pimee_product_asset_listcategories',
                        children:        'pimee_asset_categorytree_children'
                    });
                });
            }
        );
    </script>

    {{ form_widget(form.categories) }}

    <div class="tabbable tabs-left">
        <ul class="AknVerticalNavtab AknVerticalNavtab--condensed nav nav-tabs" id="trees-list">
            <li class="AknVerticalNavtab-item AknVerticalNavtab-header"></li>
            {% for tree in trees %}
                {% set aClass = "" %}
                {% set iClass = "gray" %}
                {% if (tree['itemCount'] > 0) %}
                    {% set aClass = "tree-has-item" %}
                    {% set iClass = "green" %}
                {% endif %}
                <li data-tree="{{ tree['tree'].code }}" data-tree-id="{{ tree['tree'].id }}" class="AknVerticalNavtab-item active">
                    <a class="AknVerticalNavtab-link" href="javascript:void(0);" id="tree-link-{{ tree['tree'].id }}" class="{{ aClass }}">
                        <div>
                            <i class="icon-ok {{ iClass }}"></i>
                            {{ tree['tree'].label }}
                        </div>
                        <span class="badge" data-tree-id="{{ tree['tree'].code }}">{{ tree['itemCount'] }}</span>
                    </a>
                </li>
            {% endfor %}
        </ul>

        <div class="AknTabContainer-content tab-content">
            {% set selectedTree = 0 %}
            {% if trees %}
                {% if app.user.assetDefaultTree is defined and app.user.assetDefaultTree.code is defined %}
                    {% for tree in trees %}
                        {% if tree['tree'].code == app.user.defaultTree.code %}
                            {% set selectedTree = tree['tree'].id %}
                        {% endif %}
                    {% endfor %}
                {% else %}
                    {% set firstTree = trees|first %}
                    {% set selectedTree = firstTree['tree'].id %}
                {% endif %}
            {% endif %}
            <div id="trees" data-id="{{ asset.id }}" data-datalocale="{{ currentLocale }}" data-selected-tree="{{ selectedTree }}">
                {% for tree in trees %}
                    <div class="tree root-unselectable" data-tree-id="{{ tree['tree'].id }}">
                        <div class="AknTabHeader">
                            <h3 class="AknTabHeader-title">{{ tree['tree'].label }}</h3>
                        </div>
                        <div id="tree-{{ tree['tree'].id }}" class="buffer-small-left"></div>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% set activeTab = true %}
