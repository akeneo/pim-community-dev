# Activating the Onboarder feature in Akeneo PIM Enterprise

## 1. An Onboarder instance has been deployed

During the Onboarder deployment, a YAML file was generated for the PIM. It contains the Helm values allowing to
activate the Onboarder feature in the PIM.

This file is located in `./gen_files/pim-values.yaml`, in the directory the Onboarder `main.tf` file was created.

## 2. Update the PIM `values.yaml`

Merge the values generated by the Onboarder with the PIM values. You can either copy/paste the content of the values
generated by the Onboarder into the PIM values, or use the following `yq` command:

```bash
$ yq m -i <path to the PIM Serenity>/values.yaml <path to the Onboarder>/gen_files/pim-values.yaml
```

## 3. Upgrade the PIM

Only for this one upgrade, as we activate the Onboarder feature for the first time, a special hook need to be run by
Helm.

Edit the PIM `values.yaml` file, and turn on this hook with the following content:

```yaml
onboarder:
    pushCatalogToOnboarder:
      enabled: true
```

Or using `yq`:

```bash
$ yq w -i values.yaml "onboarder.pushCatalogToOnboarder.enabled" true
```

This hook will push the PIM catalog data (only structure, no products) to the Onboarder to have them synchronized for
the first time. Depending on the catalog volume, this can take several minutes.

For example, pushing the reference catalog provided by the Akeneo Data Generator takes 25 seconds. This corresponds to:
- 1000 reference entities
- 26 attribute groups
- 604 attributes
- 125 families
- 2680 attribute options

You can then upgrade the PIM instance:

```bash
terraform init -upgrade
terraform apply
```

## 4. Remove the one-shot upgrade hook


Edit again the PIM `values.yaml` file to remove the `onboarder.pushCatalogToOnboarder.enabled` value, as this hook shall
never be played again.

You can do so with `yq`:

```bash
$ yq d -i values.yaml "onboarder.pushCatalogToOnboarder"
```
