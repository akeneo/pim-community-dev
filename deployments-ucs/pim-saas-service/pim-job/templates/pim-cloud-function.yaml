apiVersion: cloudfunctions.gcp.jet.crossplane.io/v1alpha1
kind: Function
metadata:
  name: {{ .Values.pim.cloudFunction.name }} 
spec:
  forProvider:
    availableMemoryMb: {{ .Values.pim.cloudFunction.memory }}
    description: "transform command into pub/sub message"
    entryPoint: "publishCommand"
    name: {{ .Values.pim.cloudFunction.name }}
    runtime: "nodejs16"
    sourceArchiveBucket: "{{ .Values.pim.cloudFunction.bucket}}"
    sourceArchiveObject: "{{ .Values.pim.cloudFunction.sourceSode }}"
    triggerHttp: true
    region: "{{ .Values.pim.cloudFunction.region }}"
    environmentVariables:
      projectId: "{{ .Values.projectId }}"
      tenantContext: "tenant_contexts"
  providerConfigRef:
    name: "provider-config-jet-gcp"
---
apiVersion: cloudfunctions.gcp.jet.crossplane.io/v1alpha1
kind: FunctionIAMMember
metadata:
  name: {{ .Values.pim.cloudFunction.name }} 
spec:
  forProvider:
    cloudFunction: {{ .Values.pim.cloudFunction.name }} 
    member: "allAuthenticatedUsers"
    role: "roles/cloudfunctions.invoker"
    region: "{{ .Values.pim.cloudFunction.region }}"
  providerConfigRef:
    name: "provider-config-jet-gcp"