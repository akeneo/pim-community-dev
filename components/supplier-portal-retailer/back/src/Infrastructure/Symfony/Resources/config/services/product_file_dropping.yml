services:
    # Controllers
    Akeneo\SupplierPortal\Retailer\Infrastructure\ProductFileDropping\Controller\DownloadProductFile:
        public: true
        arguments:
            - '@Akeneo\SupplierPortal\Retailer\Application\ProductFileDropping\Read\DownloadProductFile\DownloadProductFileHandler'
            - '@event_dispatcher'
            - '@security.token_storage'

    Akeneo\SupplierPortal\Retailer\Infrastructure\ProductFileDropping\Controller\ListProductFiles:
        public: true
        arguments:
            - '@Akeneo\SupplierPortal\Retailer\Application\ProductFileDropping\Read\ListProductFiles\ListProductFilesHandler'

    Akeneo\SupplierPortal\Retailer\Infrastructure\ProductFileDropping\Controller\ListSupplierProductFiles:
        public: true
        arguments:
            - '@Akeneo\SupplierPortal\Retailer\Application\ProductFileDropping\Read\ListSupplierProductFiles\ListSupplierProductFilesHandler'

    Akeneo\SupplierPortal\Retailer\Infrastructure\ProductFileDropping\Controller\CommentProductFile:
        public: true
        arguments:
            - '@Akeneo\SupplierPortal\Retailer\Application\ProductFileDropping\Write\CommentProductFile\CommentProductFileHandler'

    Akeneo\SupplierPortal\Retailer\Infrastructure\ProductFileDropping\Controller\GetProductFile:
        public: true
        arguments:
            - '@Akeneo\SupplierPortal\Retailer\Domain\ProductFileDropping\GetProductFileWithComments'

    # GCS Bucket services
    Akeneo\SupplierPortal\Retailer\Domain\ProductFileDropping\StoreProductsFile:
        class: Akeneo\SupplierPortal\Retailer\Infrastructure\ProductFileDropping\GoogleCloudStorage\StoreProductsFileInGCSBucket
        arguments:
            - '@akeneo_file_storage.file_storage.filesystem_provider'
            - '@monolog.logger.supplier_portal'

    Akeneo\SupplierPortal\Retailer\Domain\ProductFileDropping\DownloadStoredProductFile:
        class: Akeneo\SupplierPortal\Retailer\Infrastructure\ProductFileDropping\GoogleCloudStorage\DownloadStoredProductFileFromGCSBucket
        arguments:
            - '@akeneo_file_storage.file_storage.filesystem_provider'
            - '@monolog.logger.supplier_portal'

    Akeneo\SupplierPortal\Retailer\Domain\ProductFileDropping\DeleteProductFilesFromPaths:
        class: Akeneo\SupplierPortal\Retailer\Infrastructure\ProductFileDropping\GoogleCloudStorage\DeleteProductFilesFromPathsInGCSBucket
        arguments:
            - '@akeneo_file_storage.file_storage.filesystem_provider'
            - '@monolog.logger.supplier_portal'

    Akeneo\SupplierPortal\Retailer\Infrastructure\ProductFileDropping\GoogleCloudStorage\DeleteUnknownSupplierDirectoriesInGCSBucket:
        arguments:
            - '@akeneo_file_storage.file_storage.filesystem_provider'
            - '@Akeneo\SupplierPortal\Retailer\Domain\Supplier\GetAllSupplierCodes'
            - '@monolog.logger.supplier_portal'

    # PIM Notification service
    Akeneo\SupplierPortal\Retailer\Domain\ProductFileDropping\Notifier:
        class: Akeneo\SupplierPortal\Retailer\Infrastructure\ProductFileDropping\PIMNotifier
        arguments:
            - '@pim_notification.notifier'
            - '@pim_user.repository.user'

    # Command/Handlers
    Akeneo\SupplierPortal\Retailer\Application\ProductFileDropping\Write\CreateProductFile\CreateProductFileHandler:
        arguments:
            - '@Akeneo\SupplierPortal\Retailer\Domain\Supplier\Read\GetSupplierFromContributorEmail'
            - '@Akeneo\SupplierPortal\Retailer\Domain\ProductFileDropping\Write\ProductFileRepository'
            - '@Akeneo\SupplierPortal\Retailer\Domain\ProductFileDropping\StoreProductsFile'
            - '@validator'
            - '@event_dispatcher'
            - '@monolog.logger.supplier_portal'

    Akeneo\SupplierPortal\Retailer\Application\ProductFileDropping\Write\CommentProductFileForSupplier\CommentProductFileHandlerForSupplier:
        arguments:
            - '@Akeneo\SupplierPortal\Retailer\Domain\ProductFileDropping\Write\ProductFileRepository'

    Akeneo\SupplierPortal\Retailer\Application\ProductFileDropping\Write\CommentProductFile\CommentProductFileHandler:
        arguments:
            - '@Akeneo\SupplierPortal\Retailer\Domain\ProductFileDropping\Write\ProductFileRepository'
            - '@validator'

    Akeneo\SupplierPortal\Retailer\Application\ProductFileDropping\Write\MarkCommentsAsReadBySupplier\MarkCommentsAsReadBySupplierHandler:
        arguments:
            - '@Akeneo\SupplierPortal\Retailer\Domain\ProductFileDropping\MarkCommentsAsReadBySupplier'
            - '@Akeneo\SupplierPortal\Retailer\Domain\ProductFileDropping\Write\ProductFileRepository'

    # Query/Handlers
    Akeneo\SupplierPortal\Retailer\Application\ProductFileDropping\Read\DownloadProductFile\DownloadProductFileHandler:
        arguments:
            - '@Akeneo\SupplierPortal\Retailer\Domain\ProductFileDropping\GetProductFilePathAndFileName'
            - '@Akeneo\SupplierPortal\Retailer\Domain\ProductFileDropping\DownloadStoredProductFile'

    Akeneo\SupplierPortal\Retailer\Application\ProductFileDropping\Read\DownloadProductFileForSupplier\DownloadProductFileHandlerForSupplier:
        arguments:
            - '@Akeneo\SupplierPortal\Retailer\Domain\ProductFileDropping\GetProductFilePathAndFileNameForSupplier'
            - '@Akeneo\SupplierPortal\Retailer\Domain\ProductFileDropping\DownloadStoredProductFile'
            - '@Akeneo\SupplierPortal\Retailer\Domain\Supplier\Read\GetSupplierFromContributorEmail'

    Akeneo\SupplierPortal\Retailer\Application\ProductFileDropping\Read\ListProductFiles\ListProductFilesHandler:
        arguments:
            - '@Akeneo\SupplierPortal\Retailer\Domain\ProductFileDropping\ListProductFiles'
            - '@Akeneo\SupplierPortal\Retailer\Domain\ProductFileDropping\CountProductFiles'

    Akeneo\SupplierPortal\Retailer\Application\ProductFileDropping\Read\ListSupplierProductFiles\ListSupplierProductFilesHandler:
        arguments:
            - '@Akeneo\SupplierPortal\Retailer\Domain\ProductFileDropping\ListSupplierProductFiles'
            - '@Akeneo\SupplierPortal\Retailer\Domain\ProductFileDropping\CountProductFiles'

    Akeneo\SupplierPortal\Retailer\Application\ProductFileDropping\Read\ListProductFilesForSupplier\ListProductFilesForSupplierHandler:
        arguments:
            - '@Akeneo\SupplierPortal\Retailer\Domain\ProductFileDropping\ListProductFilesForSupplier'
            - '@Akeneo\SupplierPortal\Retailer\Domain\Supplier\Read\GetSupplierFromContributorEmail'
            - '@Akeneo\SupplierPortal\Retailer\Domain\ProductFileDropping\GetProductFilesCount'

    # Queries
    Akeneo\SupplierPortal\Retailer\Domain\ProductFileDropping\GetProductFilePathAndFileName:
        class: Akeneo\SupplierPortal\Retailer\Infrastructure\ProductFileDropping\Query\Sql\DatabaseGetProductFilePathAndFileName
        arguments:
            - '@database_connection'

    Akeneo\SupplierPortal\Retailer\Domain\ProductFileDropping\GetProductFilePathAndFileNameForSupplier:
        class: Akeneo\SupplierPortal\Retailer\Infrastructure\ProductFileDropping\Query\Sql\DatabaseGetProductFilePathAndFileNameForSupplier
        arguments:
            - '@database_connection'

    Akeneo\SupplierPortal\Retailer\Domain\ProductFileDropping\ListSupplierProductFiles:
        class: Akeneo\SupplierPortal\Retailer\Infrastructure\ProductFileDropping\Query\Sql\DatabaseListSupplierProductFiles
        arguments:
            - '@database_connection'

    Akeneo\SupplierPortal\Retailer\Domain\ProductFileDropping\ListProductFilesForSupplier:
        class: Akeneo\SupplierPortal\Retailer\Infrastructure\ProductFileDropping\Query\Sql\DatabaseListProductFilesForSupplier
        arguments:
            - '@database_connection'

    Akeneo\SupplierPortal\Retailer\Domain\ProductFileDropping\GetProductFilePathsOfOldProductFiles:
        class: Akeneo\SupplierPortal\Retailer\Infrastructure\ProductFileDropping\Query\Sql\DatabaseGetProductFilePathsOfOldProductFiles
        arguments:
            - '@database_connection'

    Akeneo\SupplierPortal\Retailer\Domain\ProductFileDropping\DeleteOldProductFiles:
        public: true
        class: Akeneo\SupplierPortal\Retailer\Infrastructure\ProductFileDropping\Query\Sql\DatabaseDeleteOldProductFiles
        arguments:
            - '@database_connection'

    Akeneo\SupplierPortal\Retailer\Domain\ProductFileDropping\CountProductFiles:
        class: Akeneo\SupplierPortal\Retailer\Infrastructure\ProductFileDropping\Query\Sql\DatabaseCountProductFiles
        arguments:
            - '@database_connection'

    Akeneo\SupplierPortal\Retailer\Domain\ProductFileDropping\GetProductFilesCount:
        class: Akeneo\SupplierPortal\Retailer\Infrastructure\ProductFileDropping\Query\Sql\DatabaseGetProductFilesCount
        arguments:
            - '@database_connection'

    Akeneo\SupplierPortal\Retailer\Domain\ProductFileDropping\ListProductFiles:
        class: Akeneo\SupplierPortal\Retailer\Infrastructure\ProductFileDropping\Query\Sql\DatabaseListProductFiles
        arguments:
            - '@database_connection'

    Akeneo\SupplierPortal\Retailer\Domain\ProductFileDropping\GetProductFileWithComments:
        class: Akeneo\SupplierPortal\Retailer\Infrastructure\ProductFileDropping\Query\Sql\DatabaseGetProductFileWithComments
        arguments:
            - '@database_connection'

    Akeneo\SupplierPortal\Retailer\Domain\ProductFileDropping\MarkCommentsAsReadBySupplier:
        class: Akeneo\SupplierPortal\Retailer\Infrastructure\ProductFileDropping\Query\Sql\DatabaseMarkCommentsAsReadBySupplier
        arguments:
            - '@database_connection'

    # Event subscribers
    Akeneo\SupplierPortal\Retailer\Application\ProductFileDropping\Subscriber\NotifyUsersOnProductFileAdded:
        arguments:
            - '@Akeneo\SupplierPortal\Retailer\Domain\ProductFileDropping\Notifier'
        tags:
            - 'kernel.event_subscriber'

    Akeneo\SupplierPortal\Retailer\Infrastructure\Supplier\SuccessMetrics\Subscriber\LogOnContributorAdded:
        arguments:
            - '@monolog.logger.supplier_portal'
        tags:
            - { name: kernel.event_subscriber }

    Akeneo\SupplierPortal\Retailer\Infrastructure\ProductFileDropping\SuccessMetrics\Subscriber\LogOnProductFileDownloaded:
        arguments:
            - '@Akeneo\SupplierPortal\Retailer\Domain\Supplier\Read\GetSupplierCodeFromProductFileIdentifier'
            - '@monolog.logger.supplier_portal'
        tags:
            - { name: kernel.event_subscriber }

    # Jobs
    supplier_portal.job.clean_supplier_product_files:
        class: '%pim_connector.job.simple_job.class%'
        arguments:
            - 'supplier_portal_supplier_product_files_clean'
            - '@event_dispatcher'
            - '@akeneo_batch.job_repository'
            -
                - '@supplier_portal.job.step.clean_supplier_product_files'
            - false
            - false
        tags:
            - { name: akeneo_batch.job, connector: 'Supplier Portal', type: 'scheduled_job' }

    supplier_portal.job.step.clean_supplier_product_files:
        class: '%pim_connector.step.tasklet.class%'
        arguments:
            - 'generate_dictionary'
            - '@event_dispatcher'
            - '@akeneo_batch.job_repository'
            - '@Akeneo\SupplierPortal\Retailer\Infrastructure\ProductFileDropping\Job\CleanSupplierProductFiles'

    supplier_portal.job_parameters.default_values_provider.clean_supplier_product_files:
        class: Akeneo\Tool\Component\Batch\Job\JobParameters\EmptyDefaultValuesProvider
        arguments:
            - [ 'supplier_portal_supplier_product_files_clean' ]
        tags:
            - { name: akeneo_batch.job.job_parameters.default_values_provider }

    supplier_portal.job_parameters.constraint_collection_provider.clean_supplier_product_files:
        class: Akeneo\Tool\Component\Batch\Job\JobParameters\EmptyConstraintCollectionProvider
        arguments:
            - [ 'supplier_portal_supplier_product_files_clean' ]
        tags:
            - { name: akeneo_batch.job.job_parameters.constraint_collection_provider }

    Akeneo\SupplierPortal\Retailer\Infrastructure\ProductFileDropping\Job\CleanSupplierProductFiles:
        arguments:
            - '@Akeneo\SupplierPortal\Retailer\Domain\ProductFileDropping\GetProductFilePathsOfOldProductFiles'
            - '@Akeneo\SupplierPortal\Retailer\Domain\ProductFileDropping\DeleteProductFilesFromPaths'
            - '@Akeneo\SupplierPortal\Retailer\Domain\ProductFileDropping\DeleteOldProductFiles'
            - '@Akeneo\SupplierPortal\Retailer\Infrastructure\ProductFileDropping\GoogleCloudStorage\DeleteUnknownSupplierDirectoriesInGCSBucket'
            - '@monolog.logger.supplier_portal'

    # Command
    Akeneo\SupplierPortal\Retailer\Infrastructure\ProductFileDropping\Command\CleanSupplierProductFilesCommand:
        arguments:
            - '@Akeneo\Tool\Bundle\BatchBundle\JobExecution\ExecuteJobExecutionHandlerInterface'
            - '@Akeneo\Tool\Bundle\BatchBundle\JobExecution\CreateJobExecutionHandlerInterface'
        tags:
            - { name: console.command }

    # Repositories
    Akeneo\SupplierPortal\Retailer\Domain\ProductFileDropping\Write\ProductFileRepository:
        public: true
        class: Akeneo\SupplierPortal\Retailer\Infrastructure\ProductFileDropping\Repository\Sql\DatabaseRepository
        arguments:
            - '@database_connection'

    # Service APIs
    Akeneo\SupplierPortal\Retailer\Infrastructure\ProductFileDropping\ServiceAPI\DownloadProductFile\DownloadProductFile:
        arguments:
            - '@Akeneo\SupplierPortal\Retailer\Application\ProductFileDropping\Read\DownloadProductFileForSupplier\DownloadProductFileHandlerForSupplier'

    Akeneo\SupplierPortal\Retailer\Infrastructure\ProductFileDropping\ServiceAPI\UploadProductFile\UploadProductFile:
        arguments:
            - '@Akeneo\SupplierPortal\Retailer\Application\ProductFileDropping\Write\CreateProductFile\CreateProductFileHandler'
            - '@monolog.logger.supplier_portal'

    Akeneo\SupplierPortal\Retailer\Infrastructure\ProductFileDropping\ServiceAPI\GetProductFiles\GetProductFiles:
        arguments:
            - '@Akeneo\SupplierPortal\Retailer\Application\ProductFileDropping\Read\ListProductFilesForSupplier\ListProductFilesForSupplierHandler'

    Akeneo\SupplierPortal\Retailer\Infrastructure\ProductFileDropping\ServiceAPI\CommentProductFile\CommentProductFile:
        arguments:
            - '@Akeneo\SupplierPortal\Retailer\Application\ProductFileDropping\Write\CommentProductFileForSupplier\CommentProductFileHandlerForSupplier'

    Akeneo\SupplierPortal\Retailer\Infrastructure\ProductFileDropping\ServiceAPI\MarkCommentsAsRead\MarkCommentsAsRead:
        arguments:
            - '@Akeneo\SupplierPortal\Retailer\Application\ProductFileDropping\Write\MarkCommentsAsReadBySupplier\MarkCommentsAsReadBySupplierHandler'
