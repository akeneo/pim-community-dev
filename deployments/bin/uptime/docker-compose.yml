version: '3.7'

services:
  composer:
    image: 'composer:2.1'
    volumes:
      - ./composer.json:/app/composer.json
      - ./vendor:/app/vendor
  php:
    image: eu.gcr.io/akeneo-ci/php-deployment:latest
    environment:
      PROJECT: '${PROJECT:-akecld-saas-dev}'
      LOG_LEVEL: '${LOG_LEVEL:-info}'
      GOOGLE_APPLICATION_CREDENTIALS: '/tmp/.config/gcloud/gcloud-service-key.json'
    working_dir: '/app'
    volumes:
      - ./:/app
      - ${GOOGLE_APPLICATION_CREDENTIALS:-~/.config/gcloud/application_default_credentials.json}:/tmp/.config/gcloud/gcloud-service-key.json
