#!/usr/bin/env bash
set -eu -o pipefail

if [ "$#" -ne 3 ]; then
    echo "The arguments composer-command, ce-owner and ce-branch are mandatory."
fi

composerCommand=$1
ceOwner=$2
ceBranch=$3

if [ "$ceBranch" != "master" ]; then
    if [ "$ceOwner" != "akeneo" ]; then
        composer config repositories.pim-community-dev '{"type": "vcs", "url": "https://github.com/'"$ceOwner"'/pim-community-dev"}'
    fi
    composer require --no-update "akeneo/pim-community-dev:dev-$ceBranch@dev"
fi

composer $composerCommand --no-ansi --optimize-autoloader --no-interaction --no-progress --prefer-dist --no-suggest
