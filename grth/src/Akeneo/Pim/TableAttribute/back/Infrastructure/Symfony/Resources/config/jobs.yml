services:
    # Jobs
    pim_table_attribute.job.csv_option_export:
        class: '%pim_connector.job.simple_job.class%'
        arguments:
            - 'csv_table_attribute_options_export'
            - '@event_dispatcher'
            - '@akeneo_batch.job_repository'
            -
                - '@pim_table_attribute.step.csv_option_export'
            - true
        tags:
            - { name: akeneo_batch.job, connector: '%pim_connector.connector_name.csv%', type: '%pim_connector.job.export_type%' }

    pim_table_attribute.job.xlsx_option_export:
        class: '%pim_connector.job.simple_job.class%'
        arguments:
            - 'xlsx_table_attribute_options_export'
            - '@event_dispatcher'
            - '@akeneo_batch.job_repository'
            -
                - '@pim_table_attribute.step.xlsx_option_export'
            - true
        tags:
            - { name: akeneo_batch.job, connector: '%pim_connector.connector_name.xlsx%', type: '%pim_connector.job.export_type%' }

    pim_table_attribute.job.csv_values_export:
        class: '%pim_connector.job.simple_job.class%'
        arguments:
            - 'csv_table_attribute_values_export'
            - '@event_dispatcher'
            - '@akeneo_batch.job_repository'
            -
                - '@pim_table_attribute.step.csv_values_export'
            - true
        tags:
            - { name: akeneo_batch.job, connector: '%pim_connector.connector_name.csv%', type: '%pim_connector.job.export_type%' }

    pim_table_attribute.job.xlsx_values_export:
        class: '%pim_connector.job.simple_job.class%'
        arguments:
            - 'xlsx_table_attribute_values_export'
            - '@event_dispatcher'
            - '@akeneo_batch.job_repository'
            -
                - '@pim_table_attribute.step.xlsx_values_export'
            - true
        tags:
            - { name: akeneo_batch.job, connector: '%pim_connector.connector_name.xlsx%', type: '%pim_connector.job.export_type%' }


    pim_table_attribute.job.csv_option_import:
        class: '%pim_connector.job.simple_job.class%'
        arguments:
            - 'csv_table_attribute_options_import'
            - '@event_dispatcher'
            - '@akeneo_batch.job_repository'
            -
                - '@pim_connector.step.charset_validator'
                - '@pim_table_attribute.step.csv_option_import'
            - true
        tags:
            - { name: akeneo_batch.job, connector: '%pim_connector.connector_name.csv%', type: '%pim_connector.job.import_type%' }

    pim_table_attribute.job.xlsx_option_import:
        class: '%pim_connector.job.simple_job.class%'
        arguments:
            - 'xlsx_table_attribute_options_import'
            - '@event_dispatcher'
            - '@akeneo_batch.job_repository'
            -
                - '@pim_connector.step.charset_validator'
                - '@pim_table_attribute.step.xlsx_option_import'
            - true
        tags:
            - { name: akeneo_batch.job, connector: '%pim_connector.connector_name.xlsx%', type: '%pim_connector.job.import_type%' }

    # Steps
    pim_table_attribute.step.csv_option_export:
        class: '%pim_connector.step.item_step.class%'
        arguments:
            - 'export'
            - '@event_dispatcher'
            - '@akeneo_batch.job_repository'
            - '@Akeneo\Pim\TableAttribute\Infrastructure\Connector\Reader\Database\SelectOptionDetailsReader'
            - '@Akeneo\Pim\TableAttribute\Infrastructure\Connector\Processor\Normalization\SelectOptionDetailsProcessor'
            - '@pim_table_attribute.writer.select_option.file.csv'
            - 1000
            - '@akeneo_batch.job.job_stopper'

    pim_table_attribute.step.xlsx_option_export:
        class: '%pim_connector.step.item_step.class%'
        arguments:
            - 'export'
            - '@event_dispatcher'
            - '@akeneo_batch.job_repository'
            - '@Akeneo\Pim\TableAttribute\Infrastructure\Connector\Reader\Database\SelectOptionDetailsReader'
            - '@Akeneo\Pim\TableAttribute\Infrastructure\Connector\Processor\Normalization\SelectOptionDetailsProcessor'
            - '@pim_table_attribute.writer.select_option.file.xlsx'
            - 1000
            - '@akeneo_batch.job.job_stopper'

    pim_table_attribute.step.csv_values_export:
        class: '%pim_connector.step.item_step.class%'
        arguments:
            - 'export'
            - '@event_dispatcher'
            - '@akeneo_batch.job_repository'
            - '@Akeneo\Pim\TableAttribute\Infrastructure\Connector\Reader\Database\TableValuesReader'
            - '@Akeneo\Pim\TableAttribute\Infrastructure\Connector\Processor\Normalization\TableValuesProcessor'
            - '@pim_table_attribute.writer.select_option.file.csv'
            - 1000
            - '@akeneo_batch.job.job_stopper'

    pim_table_attribute.step.xlsx_values_export:
        class: '%pim_connector.step.item_step.class%'
        arguments:
            - 'export'
            - '@event_dispatcher'
            - '@akeneo_batch.job_repository'
            - '@Akeneo\Pim\TableAttribute\Infrastructure\Connector\Reader\Database\SelectOptionDetailsReader'
            - '@Akeneo\Pim\TableAttribute\Infrastructure\Connector\Processor\Normalization\SelectOptionDetailsProcessor'
            - '@pim_table_attribute.writer.select_option.file.xlsx'
            - 1000
            - '@akeneo_batch.job.job_stopper'

    pim_table_attribute.step.csv_option_import:
        class: '%pim_connector.step.item_step.class%'
        arguments:
            - 'import'
            - '@event_dispatcher'
            - '@akeneo_batch.job_repository'
            - '@pim_table_attribute.reader.file.csv_table_option'
            - '@Akeneo\Pim\TableAttribute\Infrastructure\Connector\Processor\Denormalization\SelectOptionDetailsProcessor'
            - '@Akeneo\Pim\TableAttribute\Infrastructure\Connector\Writer\Database\SelectOption'
            - 1000
            - '@akeneo_batch.job.job_stopper'

    pim_table_attribute.step.xlsx_option_import:
        class: '%pim_connector.step.item_step.class%'
        arguments:
            - 'import'
            - '@event_dispatcher'
            - '@akeneo_batch.job_repository'
            - '@pim_table_attribute.reader.file.xlsx_table_option'
            - '@Akeneo\Pim\TableAttribute\Infrastructure\Connector\Processor\Denormalization\SelectOptionDetailsProcessor'
            - '@Akeneo\Pim\TableAttribute\Infrastructure\Connector\Writer\Database\SelectOption'
            - 1000
            - '@akeneo_batch.job.job_stopper'

    # readers
    Akeneo\Pim\TableAttribute\Infrastructure\Connector\Reader\Database\SelectOptionDetailsReader:
        arguments:
            - '@Akeneo\Pim\TableAttribute\Domain\TableConfiguration\Query\CountSelectOptions'
            - '@Akeneo\Pim\TableAttribute\Domain\TableConfiguration\Query\GetSelectOptionDetails'

    pim_table_attribute.reader.file.csv_table_option:
        class: 'Akeneo\Tool\Component\Connector\Reader\File\Csv\Reader'
        arguments:
            - '@pim_connector.reader.file.csv_iterator_factory'
            - '@Akeneo\Pim\TableAttribute\Infrastructure\Connector\ArrayConverter\FlatToStandard\SelectOptionDetails'

    pim_table_attribute.reader.file.xlsx_table_option:
        class: 'Akeneo\Tool\Component\Connector\Reader\File\Xlsx\Reader'
        arguments:
            - '@pim_connector.reader.file.xlsx_iterator_factory'
            - '@Akeneo\Pim\TableAttribute\Infrastructure\Connector\ArrayConverter\FlatToStandard\SelectOptionDetails'

    Akeneo\Pim\TableAttribute\Infrastructure\Connector\ArrayConverter\FlatToStandard\SelectOptionDetails:
        arguments:
            - '@pim_connector.array_convertor.checker.fields_requirement'

    # processors
    Akeneo\Pim\TableAttribute\Infrastructure\Connector\Processor\Normalization\SelectOptionDetailsProcessor: ~

    Akeneo\Pim\TableAttribute\Infrastructure\Connector\Processor\Denormalization\SelectOptionDetailsProcessor:
        arguments:
            - '@Akeneo\Pim\TableAttribute\Domain\TableConfiguration\Repository\SelectOptionCollectionRepository'
            - '@validator'
            - '@Akeneo\Pim\TableAttribute\Domain\TableConfiguration\Query\CountSelectOptions'

    # writers
    pim_table_attribute.writer.select_option.file.csv:
        class: Akeneo\Tool\Component\Connector\Writer\File\Csv\Writer
        arguments:
            - '@Akeneo\Pim\TableAttribute\Infrastructure\Connector\ArrayConverter\StandardToFlat\SelectOptionDetails'
            - '@pim_connector.factory.flat_item_buffer'
            - '@pim_table_attribute.writer.file.select_options.flat_item_buffer_flusher'

    pim_table_attribute.writer.select_option.file.xlsx:
        class: Akeneo\Tool\Component\Connector\Writer\File\Xlsx\Writer
        arguments:
            - '@Akeneo\Pim\TableAttribute\Infrastructure\Connector\ArrayConverter\StandardToFlat\SelectOptionDetails'
            - '@pim_connector.factory.flat_item_buffer'
            - '@pim_table_attribute.writer.file.select_options.flat_item_buffer_flusher'

    pim_table_attribute.writer.file.select_options.flat_item_buffer_flusher:
        class: '%pim_connector.writer.file.flat_item_buffer_flusher.class%'
        arguments:
            - '@pim_connector.writer.file.default.column_presenter'
            - '@pim_table_attribute.file.select_options.column_sorter'

    pim_table_attribute.file.select_options.column_sorter:
        class: '%pim_connector.writer.file.default.column_sorter.class%'
        arguments:
            - '@pim_connector.array_converter.field_splitter'
            - [ 'attribute', 'column', 'code' ]

    Akeneo\Pim\TableAttribute\Infrastructure\Connector\Writer\Database\SelectOption:
        arguments:
            - '@Akeneo\Pim\TableAttribute\Domain\TableConfiguration\Repository\SelectOptionCollectionRepository'

    # Constraint providers
    pim_table_attribute.job.job_parameters.constraint_collection_provider.simple_csv_export:
        class: 'Akeneo\Tool\Component\Connector\Job\JobParameters\ConstraintCollectionProvider\SimpleCsvExport'
        arguments:
            - ['csv_table_attribute_options_export']
        tags:
            - { name: akeneo_batch.job.job_parameters.constraint_collection_provider }

    pim_table_attribute.job.job_parameters.constraint_collection_provider.simple_xlsx_export:
        class: 'Akeneo\Tool\Component\Connector\Job\JobParameters\ConstraintCollectionProvider\SimpleXlsxExport'
        arguments:
            - ['xlsx_table_attribute_options_export']
        tags:
            - { name: akeneo_batch.job.job_parameters.constraint_collection_provider }

    pim_table_attribute.job.job_parameters.constraint_collection_provider.simple_csv_import:
        class: 'Akeneo\Tool\Component\Connector\Job\JobParameters\ConstraintCollectionProvider\SimpleCsvImport'
        arguments:
            - [ 'csv_table_attribute_options_import' ]
        tags:
            - { name: akeneo_batch.job.job_parameters.constraint_collection_provider }

    pim_table_attribute.job.job_parameters.constraint_collection_provider.simple_xlsx_import:
        class: 'Akeneo\Tool\Component\Connector\Job\JobParameters\ConstraintCollectionProvider\SimpleXlsxImport'
        arguments:
            - [ 'xlsx_table_attribute_options_import' ]
        tags:
            - { name: akeneo_batch.job.job_parameters.constraint_collection_provider }

    Akeneo\Pim\TableAttribute\Infrastructure\Connector\Provider\TableValuesCsvExportProvider:
        tags:
            - { name: akeneo_batch.job.job_parameters.constraint_collection_provider }
            - { name: akeneo_batch.job.job_parameters.default_values_provider }

    Akeneo\Pim\TableAttribute\Infrastructure\Connector\Provider\TableValuesXlsxExportProvider:
        tags:
            - { name: akeneo_batch.job.job_parameters.constraint_collection_provider }
            - { name: akeneo_batch.job.job_parameters.default_values_provider }

    # Default values providers
    pim_table_attribute.job.job_parameters.default_values_provider.simple_csv_export:
        class: 'Akeneo\Tool\Component\Connector\Job\JobParameters\DefaultValuesProvider\SimpleCsvExport'
        arguments:
            - ['csv_table_attribute_options_export']
        tags:
            - { name: akeneo_batch.job.job_parameters.default_values_provider }

    pim_table_attribute.job.job_parameters.default_values_provider.simple_xlsx_export:
        class: 'Akeneo\Tool\Component\Connector\Job\JobParameters\DefaultValuesProvider\SimpleXlsxExport'
        arguments:
            - ['xlsx_table_attribute_options_export']
        tags:
            - { name: akeneo_batch.job.job_parameters.default_values_provider }

    pim_table_attribute.job.job_parameters.default_values_provider.simple_csv_import:
        class: 'Akeneo\Tool\Component\Connector\Job\JobParameters\DefaultValuesProvider\SimpleCsvImport'
        arguments:
            - [ 'csv_table_attribute_options_import' ]
        tags:
            - { name: akeneo_batch.job.job_parameters.default_values_provider }

    pim_table_attribute.job.job_parameters.default_values_provider.simple_xlsx_import:
        class: 'Akeneo\Tool\Component\Connector\Job\JobParameters\DefaultValuesProvider\SimpleXlsxImport'
        arguments:
            - [ 'xlsx_table_attribute_options_import' ]
        tags:
            - { name: akeneo_batch.job.job_parameters.default_values_provider }
