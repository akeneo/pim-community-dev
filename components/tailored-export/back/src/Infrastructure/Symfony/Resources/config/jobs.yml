services:
  akeneo.tailored_export.job.xlsx_product.export:
    class: '%pim_connector.job.simple_job.class%'
    arguments:
      - '%akeneo.tailored_export.connector.xlsx_product.code%'
      - '@event_dispatcher'
      - '@akeneo_batch.job_repository'
      -
        - '@akeneo.tailored_export.connector.step.xlsx_product.export'
        - '@akeneo.job_automation.connector.step.upload'
      - true
    tags:
      - { name: akeneo_batch.job, connector: '%akeneo.tailored_export.connector.name%', type: '%pim_connector.job.export_type%' }

  akeneo.tailored_export.job.csv_product.export:
    class: '%pim_connector.job.simple_job.class%'
    arguments:
      - '%akeneo.tailored_export.connector.csv_product.code%'
      - '@event_dispatcher'
      - '@akeneo_batch.job_repository'
      -
        - '@akeneo.tailored_export.connector.step.csv_product.export'
        - '@akeneo.job_automation.connector.step.upload'
      - true
    tags:
      - { name: akeneo_batch.job, connector: '%akeneo.tailored_export.connector.name%', type: '%pim_connector.job.export_type%' }

  akeneo.tailored_export.job.xlsx_product_model.export:
    class: '%pim_connector.job.simple_job.class%'
    arguments:
      - '%akeneo.tailored_export.connector.xlsx_product_model.code%'
      - '@event_dispatcher'
      - '@akeneo_batch.job_repository'
      -
        - '@akeneo.tailored_export.connector.step.xlsx_product_model.export'
        - '@akeneo.job_automation.connector.step.upload'
      - true
    tags:
      - { name: akeneo_batch.job, connector: '%akeneo.tailored_export.connector.name%', type: '%pim_connector.job.export_type%' }

  akeneo.tailored_export.job.csv_product_model.export:
    class: '%pim_connector.job.simple_job.class%'
    arguments:
      - '%akeneo.tailored_export.connector.csv_product_model.code%'
      - '@event_dispatcher'
      - '@akeneo_batch.job_repository'
      -
        - '@akeneo.tailored_export.connector.step.csv_product_model.export'
        - '@akeneo.job_automation.connector.step.upload'
      - true
    tags:
      - { name: akeneo_batch.job, connector: '%akeneo.tailored_export.connector.name%', type: '%pim_connector.job.export_type%' }

  akeneo.tailored_export.connector.reader.database.product:
    class: 'Akeneo\Platform\TailoredExport\Infrastructure\Connector\Reader\Database\ProductReader'
    arguments:
      - '@pim_catalog.query.product_query_builder_factory_for_reading_purpose'

  akeneo.tailored_export.connector.reader.database.product_model:
    class: 'Akeneo\Platform\TailoredExport\Infrastructure\Connector\Reader\Database\ProductReader'
    arguments:
      - '@pim_catalog.query.product_model_query_builder_factory'

  akeneo.tailored_export.connector.processor.product_export:
    class: 'Akeneo\Platform\TailoredExport\Infrastructure\Connector\Processor\EntityWithValuesExportProcessor'
    arguments:
      - '@akeneo.pim.structure.query.get_attributes'
      - '@akeneo.pim.structure.query.get_association_types'
      - '@Akeneo\Platform\TailoredExport\Infrastructure\Hydrator\ValueCollectionHydrator'
      - '@Akeneo\Platform\TailoredExport\Infrastructure\Hydrator\ColumnCollectionHydrator'
      - '@Akeneo\Platform\TailoredExport\Application\MapValues\MapValuesQueryHandler'
      - '@Akeneo\Platform\TailoredExport\Application\ExtractMedia\ExtractMediaQueryHandler'

  akeneo.tailored_export.connector.processor.product_model_export:
    class: 'Akeneo\Platform\TailoredExport\Infrastructure\Connector\Processor\EntityWithValuesExportProcessor'
    arguments:
      - '@akeneo.pim.structure.query.get_attributes'
      - '@akeneo.pim.structure.query.get_association_types'
      - '@Akeneo\Platform\TailoredExport\Infrastructure\Hydrator\ValueCollectionHydrator'
      - '@Akeneo\Platform\TailoredExport\Infrastructure\Hydrator\ColumnCollectionHydrator'
      - '@Akeneo\Platform\TailoredExport\Application\MapValues\MapValuesQueryHandler'
      - '@Akeneo\Platform\TailoredExport\Application\ExtractMedia\ExtractMediaQueryHandler'

  akeneo.tailored_export.connector.xlsx.file_writer_factory:
    class: Akeneo\Platform\TailoredExport\Infrastructure\Connector\Writer\File\FileWriterFactory
    arguments:
      - 'xlsx'

  akeneo.tailored_export.connector.csv.file_writer_factory:
    class: Akeneo\Platform\TailoredExport\Infrastructure\Connector\Writer\File\FileWriterFactory
    arguments:
      - 'csv'

  akeneo.tailored_export.connector.writer.xlsx.product:
    class: 'Akeneo\Platform\TailoredExport\Infrastructure\Connector\Writer\File\Xlsx\EntityWithValuesWriter'
    arguments:
      - '@filesystem'
      - '@akeneo.tailored_export.connector.xlsx.file_writer_factory'

  akeneo.tailored_export.connector.writer.csv.product:
    class: 'Akeneo\Platform\TailoredExport\Infrastructure\Connector\Writer\File\Csv\EntityWithValuesWriter'
    arguments:
      - '@filesystem'
      - '@akeneo.tailored_export.connector.csv.file_writer_factory'

  akeneo.tailored_export.connector.writer.xlsx.product_model:
    class: 'Akeneo\Platform\TailoredExport\Infrastructure\Connector\Writer\File\Xlsx\EntityWithValuesWriter'
    arguments:
      - '@filesystem'
      - '@akeneo.tailored_export.connector.xlsx.file_writer_factory'

  akeneo.tailored_export.connector.writer.csv.product_model:
    class: 'Akeneo\Platform\TailoredExport\Infrastructure\Connector\Writer\File\Csv\EntityWithValuesWriter'
    arguments:
      - '@filesystem'
      - '@akeneo.tailored_export.connector.csv.file_writer_factory'

  akeneo.tailored_export.connector.step.xlsx_product.export:
    class: '%pim_connector.step.item_step.class%'
    arguments:
      - 'export'
      - '@event_dispatcher'
      - '@akeneo_batch.job_repository'
      - '@akeneo.tailored_export.connector.reader.database.product'
      - '@akeneo.tailored_export.connector.processor.product_export'
      - '@akeneo.tailored_export.connector.writer.xlsx.product'
      - '%pim_job_product_batch_size%'
      - '@akeneo_batch.job.job_stopper'

  akeneo.tailored_export.connector.step.csv_product.export:
    class: '%pim_connector.step.item_step.class%'
    arguments:
      - 'export'
      - '@event_dispatcher'
      - '@akeneo_batch.job_repository'
      - '@akeneo.tailored_export.connector.reader.database.product'
      - '@akeneo.tailored_export.connector.processor.product_export'
      - '@akeneo.tailored_export.connector.writer.csv.product'
      - '%pim_job_product_batch_size%'
      - '@akeneo_batch.job.job_stopper'

  akeneo.tailored_export.connector.step.xlsx_product_model.export:
    class: '%pim_connector.step.item_step.class%'
    arguments:
      - 'export'
      - '@event_dispatcher'
      - '@akeneo_batch.job_repository'
      - '@akeneo.tailored_export.connector.reader.database.product_model'
      - '@akeneo.tailored_export.connector.processor.product_model_export'
      - '@akeneo.tailored_export.connector.writer.xlsx.product_model'
      - '%pim_job_product_batch_size%'
      - '@akeneo_batch.job.job_stopper'

  akeneo.tailored_export.connector.step.csv_product_model.export:
    class: '%pim_connector.step.item_step.class%'
    arguments:
      - 'export'
      - '@event_dispatcher'
      - '@akeneo_batch.job_repository'
      - '@akeneo.tailored_export.connector.reader.database.product_model'
      - '@akeneo.tailored_export.connector.processor.product_model_export'
      - '@akeneo.tailored_export.connector.writer.csv.product_model'
      - '%pim_job_product_batch_size%'
      - '@akeneo_batch.job.job_stopper'

  akeneo.tailored_export.job.job_parameters.xlsx_product_default_values_provider:
    class: 'Akeneo\Platform\TailoredExport\Infrastructure\Connector\DefaultValueProvider\XlsxProductDefaultValueProvider'
    arguments:
      - '@akeneo_pim_enrichment.job.job_parameters.default_values_provider.simple_xlsx_export'
      -
        - '%akeneo.tailored_export.connector.xlsx_product.code%'
    tags:
      - { name: akeneo_batch.job.job_parameters.default_values_provider }

  akeneo.tailored_export.job.job_parameters.csv_product_default_values_provider:
    class: 'Akeneo\Platform\TailoredExport\Infrastructure\Connector\DefaultValueProvider\CsvProductDefaultValueProvider'
    arguments:
      - '@akeneo_pim_enrichment.job.job_parameters.default_values_provider.simple_csv_export'
      - - '%akeneo.tailored_export.connector.csv_product.code%'
    tags:
      - { name: akeneo_batch.job.job_parameters.default_values_provider }

  akeneo.tailored_export.job.job_parameters.xlsx_product_model_default_values_provider:
    class: 'Akeneo\Platform\TailoredExport\Infrastructure\Connector\DefaultValueProvider\XlsxProductModelDefaultValueProvider'
    arguments:
      - '@akeneo_pim_enrichment.job.job_parameters.default_values_provider.simple_xlsx_export'
      -
        - '%akeneo.tailored_export.connector.xlsx_product_model.code%'
    tags:
      - { name: akeneo_batch.job.job_parameters.default_values_provider }

  akeneo.tailored_export.job.job_parameters.csv_product_model_default_values_provider:
    class: 'Akeneo\Platform\TailoredExport\Infrastructure\Connector\DefaultValueProvider\CsvProductModelDefaultValueProvider'
    arguments:
      - '@akeneo_pim_enrichment.job.job_parameters.default_values_provider.simple_csv_export'
      - - '%akeneo.tailored_export.connector.csv_product_model.code%'
    tags:
      - { name: akeneo_batch.job.job_parameters.default_values_provider }

  akeneo.tailored_export.job.job_parameters.xlsx_constraint_collection_provider:
    class: 'Akeneo\Platform\TailoredExport\Infrastructure\Connector\ConstraintCollectionProvider'
    arguments:
      - '@pim_user.job.job_parameters.constraint_collection_provider.simple_xlsx_export'
      -
        - '%akeneo.tailored_export.connector.xlsx_product.code%'
        - '%akeneo.tailored_export.connector.xlsx_product_model.code%'
    tags:
      - { name: akeneo_batch.job.job_parameters.constraint_collection_provider }

  akeneo.tailored_export.job.job_parameters.csv_constraint_collection_provider:
    class: 'Akeneo\Platform\TailoredExport\Infrastructure\Connector\ConstraintCollectionProvider'
    arguments:
      - '@pim_user.job.job_parameters.constraint_collection_provider.simple_csv_export'
      - - '%akeneo.tailored_export.connector.csv_product.code%'
        - '%akeneo.tailored_export.connector.csv_product_model.code%'
    tags:
      - { name: akeneo_batch.job.job_parameters.constraint_collection_provider }
