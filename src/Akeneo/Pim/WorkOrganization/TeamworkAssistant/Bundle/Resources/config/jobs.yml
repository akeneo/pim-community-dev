parameters:
    pimee_teamwork_assistant.project_calculation.connector_name: 'teamwork assistant'

    ### Project calculation job
    pimee_teamwork_assistant.project_calculation.job_name: 'project_calculation'
    pimee_teamwork_assistant.project_calculation.job_type: 'project_calculation'
    pimee_teamwork_assistant.prepare_project_calculation.tasklet_name: 'prepare_project_calculation'
    pimee_teamwork_assistant.project_calculation.tasklet_name: 'project_calculation'
    pimee_teamwork_assistant.clean_contributor_group.tasklet_name: 'clean_contributor_group'

    pimee_teamwork_assistant.tasklet.prepare_project_calculation.class: 'Akeneo\Pim\WorkOrganization\TeamworkAssistant\Component\Job\ProjectCalculation\PrepareProjectCalculationTasklet'
    pimee_teamwork_assistant.tasklet.clean_contributor_group.class: 'Akeneo\Pim\WorkOrganization\TeamworkAssistant\Component\Job\ProjectCalculation\CleanContributorGroupTasklet'
    pimee_teamwork_assistant.tasklet.project_calculation.class: 'Akeneo\Pim\WorkOrganization\TeamworkAssistant\Component\Job\ProjectCalculation\ProjectCalculationTasklet'
    pimee_teamwork_assistant.calculation_step.chained.class: 'Akeneo\Pim\WorkOrganization\TeamworkAssistant\Component\Job\ProjectCalculation\CalculationStep\ChainedCalculationStep'
    pimee_teamwork_assistant.calculation_step.add_user_group.class: 'Akeneo\Pim\WorkOrganization\TeamworkAssistant\Component\Job\ProjectCalculation\CalculationStep\AddUserGroupStep'
    pimee_teamwork_assistant.calculation_step.add_product.class: 'Akeneo\Pim\WorkOrganization\TeamworkAssistant\Component\Job\ProjectCalculation\CalculationStep\AddProductStep'
    pimee_teamwork_assistant.calculation_step.process_attribute_group_completeness.class: 'Akeneo\Pim\WorkOrganization\TeamworkAssistant\Component\Job\ProjectCalculation\CalculationStep\ProcessAttributeGroupCompletenessStep'
    pimee_teamwork_assistant.launcher.job.project_calculation.class: 'Akeneo\Pim\WorkOrganization\TeamworkAssistant\Bundle\Job\ProjectCalculationJobLauncher'
    pimee_teamwork_assistant.job.project_calculation_parameter.class: 'Akeneo\Pim\WorkOrganization\TeamworkAssistant\Component\Job\ProjectCalculation\ProjectCalculationJobParameters'

    ### Attribute group completeness calculation
    pimee_teamwork_assistant.refresh_project_completeness_calculation.job_name: 'refresh_project_completeness_calculation'
    pimee_teamwork_assistant.refresh_project_completeness_calculation.job_type: 'refresh_project_completeness_calculation'
    pimee_teamwork_assistant.refresh_project_completeness_calculation.tasklet_name: 'refresh_project_completeness_calculation'

    pimee_teamwork_assistant.launcher.job.refresh_project_completeness_calculation.class: 'Akeneo\Pim\WorkOrganization\TeamworkAssistant\Bundle\Job\RefreshProjectCompletenessJobLauncher'
    pimee_teamwork_assistant.tasklet.refresh_project_completeness_calculation.class: 'Akeneo\Pim\WorkOrganization\TeamworkAssistant\Component\Job\RefreshProjectCompleteness\RefreshProjectCompletenessTasklet'
    pimee_teamwork_assistant.job.refresh_project_completeness_calculation_parameter.class: 'Akeneo\Pim\WorkOrganization\TeamworkAssistant\Component\Job\RefreshProjectCompleteness\RefreshProjectCompletenessJobParameter'

services:
    ### Project calculation

    ### Tasklet
    pimee_teamwork_assistant.tasklet.project_calculation:
        class: '%pimee_teamwork_assistant.tasklet.project_calculation.class%'
        arguments:
            - '@pimee_teamwork_assistant.repository.product'
            - '@pimee_teamwork_assistant.repository.project'
            - '@pimee_teamwork_assistant.calculation_step.chained'
            - '@pimee_teamwork_assistant.saver.project'
            - '@pim_connector.doctrine.cache_clearer'
            - '@akeneo_batch.job_repository'
        public: false

    pimee_teamwork_assistant.tasklet.prepare_project_calculation:
        class: '%pimee_teamwork_assistant.tasklet.prepare_project_calculation.class%'
        arguments:
            - '@pimee_teamwork_assistant.repository.pre_processing'
            - '@pimee_teamwork_assistant.repository.project'
        public: false

    pimee_teamwork_assistant.tasklet.clean_contributor_group:
        class: '%pimee_teamwork_assistant.tasklet.clean_contributor_group.class%'
        arguments:
            - '@pimee_security.repository.locale_access'
            - '@pimee_teamwork_assistant.repository.project'
            - '@pimee_teamwork_assistant.saver.project'
        public: false

    pimee_teamwork_assistant.tasklet.start_project_completeness_computing:
        class: 'Akeneo\Pim\WorkOrganization\TeamworkAssistant\Component\Job\ProjectCalculation\StartProjectCompletenessComputing'
        arguments:
            - '@pimee_teamwork_assistant.repository.project'
            - '@pimee_teamwork_assistant.saver.project'
        public: false

    pimee_teamwork_assistant.tasklet.end_project_completeness_computing:
        class: 'Akeneo\Pim\WorkOrganization\TeamworkAssistant\Component\Job\ProjectCalculation\EndProjectCompletenessComputing'
        arguments:
            - '@pimee_teamwork_assistant.repository.project'
            - '@pimee_teamwork_assistant.saver.project'
        public: false

    ### Steps
    pimee_teamwork_assistant.step.project_calculation:
        class: '%pim_connector.step.tasklet.class%'
        arguments:
            - '%pimee_teamwork_assistant.project_calculation.tasklet_name%'
            - '@event_dispatcher'
            - '@akeneo_batch.job_repository'
            - '@pimee_teamwork_assistant.tasklet.project_calculation'
        public: false

    pimee_teamwork_assistant.step.prepare_project_calculation:
        class: '%pim_connector.step.tasklet.class%'
        arguments:
            - '%pimee_teamwork_assistant.prepare_project_calculation.tasklet_name%'
            - '@event_dispatcher'
            - '@akeneo_batch.job_repository'
            - '@pimee_teamwork_assistant.tasklet.prepare_project_calculation'
        public: false

    pimee_teamwork_assistant.step.clean_contributor_group:
        class: '%pim_connector.step.tasklet.class%'
        arguments:
            - '%pimee_teamwork_assistant.clean_contributor_group.tasklet_name%'
            - '@event_dispatcher'
            - '@akeneo_batch.job_repository'
            - '@pimee_teamwork_assistant.tasklet.clean_contributor_group'
        public: false

    pimee_teamwork_assistant.step.start_project_completeness_computing:
        class: '%pim_connector.step.tasklet.class%'
        arguments:
            - 'start_project_completeness_computing'
            - '@event_dispatcher'
            - '@akeneo_batch.job_repository'
            - '@pimee_teamwork_assistant.tasklet.start_project_completeness_computing'

    pimee_teamwork_assistant.step.end_project_completeness_computing:
        class: '%pim_connector.step.tasklet.class%'
        arguments:
            - 'start_project_completeness_computing'
            - '@event_dispatcher'
            - '@akeneo_batch.job_repository'
            - '@pimee_teamwork_assistant.tasklet.end_project_completeness_computing'

    ### Job
    pimee_teamwork_assistant.job.project_calculation:
        class: '%pim_connector.job.simple_job.class%'
        arguments:
            - '%pimee_teamwork_assistant.project_calculation.job_name%'
            - '@event_dispatcher'
            - '@akeneo_batch.job_repository'
            -
                - '@pimee_teamwork_assistant.step.prepare_project_calculation'
                - '@pimee_teamwork_assistant.step.start_project_completeness_computing'
                - '@pimee_teamwork_assistant.step.project_calculation'
                - '@pimee_teamwork_assistant.step.clean_contributor_group'
                - '@pimee_teamwork_assistant.step.end_project_completeness_computing'
            - false
            - false
        public: false
        tags:
            - { name: akeneo_batch.job, connector: '%pimee_teamwork_assistant.project_calculation.connector_name%', type: '%pimee_teamwork_assistant.project_calculation.job_type%' }

    ### Calculation step
    pimee_teamwork_assistant.calculation_step.add_user_group:
        class: '%pimee_teamwork_assistant.calculation_step.add_user_group.class%'
        arguments:
            - '@pimee_teamwork_assistant.calculator.contributor_group'
        public: false
        tags:
            - { name: pimee_teamwork_assistant.calculation_step, priority: 100 }

    pimee_teamwork_assistant.calculation_step.add_product:
        class: '%pimee_teamwork_assistant.calculation_step.add_product.class%'
        arguments:
            - '@pimee_teamwork_assistant.repository.pre_processing'
        public: false
        tags:
            - { name: pimee_teamwork_assistant.calculation_step, priority: 200 }

    pimee_teamwork_assistant.calculation_step.process_attribute_group_completeness:
        class: '%pimee_teamwork_assistant.calculation_step.process_attribute_group_completeness.class%'
        arguments:
            - '@pimee_teamwork_assistant.repository.pre_processing'
            - '@pimee_teamwork_assistant.calculator.attribute_group_completeness'
        public: false
        tags:
            - { name: pimee_teamwork_assistant.calculation_step, priority: 400 }

    pimee_teamwork_assistant.calculation_step.chained:
        class: '%pimee_teamwork_assistant.calculation_step.chained.class%'
        arguments:
            - []

    ### Job launcher
    pimee_teamwork_assistant.launcher.job.project_calculation:
        class: '%pimee_teamwork_assistant.launcher.job.project_calculation.class%'
        arguments:
            - '@akeneo_batch_queue.launcher.queue_job_launcher'
            - '@akeneo_batch.job.job_instance_repository'
            - '%pimee_teamwork_assistant.project_calculation.job_name%'

    Akeneo\Pim\WorkOrganization\TeamworkAssistant\Bundle\Job\ProjectsRecalculationLauncher:
        arguments:
            - '@Akeneo\Pim\WorkOrganization\TeamworkAssistant\Bundle\Persistence\Query\GetProjectCode'
            - '%pimee_teamwork_assistant.project_calculation.job_name%'
            - '@akeneo_batch.launcher.simple_job_launcher'
            - '@akeneo_batch.job.job_instance_repository'
            - '@logger'

    ### Job Parameters
    pimee_teamwork_assistant.job.project_calculation_parameter:
        class: '%pimee_teamwork_assistant.job.project_calculation_parameter.class%'
        arguments:
            - '%pimee_teamwork_assistant.project_calculation.job_name%'
        public: false
        tags:
            - { name: akeneo_batch.job.job_parameters.constraint_collection_provider }
            - { name: akeneo_batch.job.job_parameters.default_values_provider }

    ### Attribute group completeness calculation

    ### Tasklet
    pimee_teamwork_assistant.tasklet.refresh_project_completeness_calculation:
        class: '%pimee_teamwork_assistant.tasklet.refresh_project_completeness_calculation.class%'
        arguments:
            - '@pimee_teamwork_assistant.calculator.attribute_group_completeness'
            - '@pimee_teamwork_assistant.repository.pre_processing'
            - '@pim_catalog.repository.channel'
            - '@pim_catalog.repository.locale'
            - '@pim_catalog.repository.product'
        public: false

    ### Steps
    pimee_teamwork_assistant.step.refresh_project_completeness_calculation:
        class: '%pim_connector.step.tasklet.class%'
        arguments:
            - '%pimee_teamwork_assistant.refresh_project_completeness_calculation.tasklet_name%'
            - '@event_dispatcher'
            - '@akeneo_batch.job_repository'
            - '@pimee_teamwork_assistant.tasklet.refresh_project_completeness_calculation'
        public: false

    ### Job
    pimee_teamwork_assistant.job.refresh_project_completeness_calculation:
        class: '%pim_connector.job.simple_job.class%'
        arguments:
            - '%pimee_teamwork_assistant.refresh_project_completeness_calculation.job_name%'
            - '@event_dispatcher'
            - '@akeneo_batch.job_repository'
            -
                - '@pimee_teamwork_assistant.step.refresh_project_completeness_calculation'
            - false
            - false
        public: false
        tags:
            -
                name: akeneo_batch.job
                connector: '%pimee_teamwork_assistant.project_calculation.connector_name%'
                type: '%pimee_teamwork_assistant.refresh_project_completeness_calculation.job_type%'

    ### Job launcher
    pimee_teamwork_assistant.launcher.job.refresh_project_completeness_calculation:
        class: '%pimee_teamwork_assistant.launcher.job.refresh_project_completeness_calculation.class%'
        arguments:
            - '@akeneo_batch_queue.launcher.queue_job_launcher'
            - '@security.token_storage'
            - '@akeneo_batch.job.job_instance_repository'
            - '%pimee_teamwork_assistant.refresh_project_completeness_calculation.job_name%'

    ### Job Parameters
    pimee_teamwork_assistant.job.refresh_project_completeness_calculation_parameter:
        class: '%pimee_teamwork_assistant.job.refresh_project_completeness_calculation_parameter.class%'
        arguments:
            - '%pimee_teamwork_assistant.refresh_project_completeness_calculation.job_name%'
        public: false
        tags:
            - { name: akeneo_batch.job.job_parameters.constraint_collection_provider }
            - { name: akeneo_batch.job.job_parameters.default_values_provider }

    Akeneo\Pim\WorkOrganization\TeamworkAssistant\Bundle\Job\NotificationDueDateWarningTasklet:
        arguments:
            - '@pimee_teamwork_assistant.repository.project'
            - '@pimee_teamwork_assistant.notifier.project_due_date_reminder'
            - '@pimee_teamwork_assistant.repository.project_completeness'
            - '@pimee_teamwork_assistant.repository.user'
        public: false

    pimee_teamwork_assistant.step.project_notification_due_date:
        class: '%pim_connector.step.tasklet.class%'
        arguments:
            - 'project_notification_due_date'
            - '@event_dispatcher'
            - '@akeneo_batch.job_repository'
            - '@Akeneo\Pim\WorkOrganization\TeamworkAssistant\Bundle\Job\NotificationDueDateWarningTasklet'
        public: false

    pimee_teamwork_assistant.job.project_notification_due_date:
        class: '%pim_connector.job.simple_job.class%'
        arguments:
            - 'project_notification_due_date'
            - '@event_dispatcher'
            - '@akeneo_batch.job_repository'
            -
                - '@Akeneo\Tool\Component\Connector\Step\CheckJobUniqueStep'
                - '@pimee_teamwork_assistant.step.project_notification_due_date'
            - false
            - false
        public: false
        tags:
            -
                name: akeneo_batch.job
                connector: 'internal'
                type: 'scheduled_job'

    pimee_teamwork_assistant.job.job_parameters.default_values_provider.project_notification_due_date:
        class:
            'Akeneo\Tool\Component\Batch\Job\JobParameters\EmptyConstraintAndDefaultValuesProvider'
        arguments:
            - 'project_notification_due_date'
        tags:
            - { name: akeneo_batch.job.job_parameters.constraint_collection_provider }
            - { name: akeneo_batch.job.job_parameters.default_values_provider }