apiVersion: iam.cnrm.cloud.google.com/v1beta1
kind: IAMPolicy
metadata:
  name: {{ .Values.pim.cloudFunction.name }}
  annotations:
    argocd.argoproj.io/sync-wave: "1"
    argocd.argoproj.io/sync-options: "Replace=true"
spec:
  resourceRef:
    apiVersion: cloudfunctions.cnrm.cloud.google.com/v1beta1
    kind: CloudFunctionsFunction
    name: {{ .Values.pim.cloudFunction.name }}
  bindings:
    - role: "roles/cloudfunctions.invoker"
      members:
        - "serviceAccount:{{ .Values.pim.cloudFunction.serviceAccountEmail }}"