parameters:
    pimee_workflow.event_subscriber.published_product.check_removal.class:              PimEnterprise\Bundle\WorkflowBundle\EventSubscriber\PublishedProduct\CheckPublishedProductOnRemovalSubscriber
    pimee_workflow.event_subscriber.published_product.detach_product.class:             PimEnterprise\Bundle\WorkflowBundle\EventSubscriber\PublishedProduct\DetachProductPostPublishSubscriber
    pimee_workflow.event_subscriber.product_draft.replace_flash_message.class:          PimEnterprise\Bundle\WorkflowBundle\EventSubscriber\ProductDraft\ReplaceProductUpdatedFlashMessageSubscriber
    pimee_workflow.event_subscriber.product_draft.send_for_approval.class:              PimEnterprise\Bundle\WorkflowBundle\EventSubscriber\ProductDraft\SendForApprovalSubscriber
    pimee_workflow.event_subscriber.import.new_proposals.class:                         PimEnterprise\Bundle\WorkflowBundle\EventSubscriber\Import\ImportProposalsSubscriber
    pimee_workflow.event_subscriber.product_draft.approve_notification.class:           PimEnterprise\Bundle\WorkflowBundle\EventSubscriber\ProductDraft\ApproveNotificationSubscriber
    pimee_workflow.event_subscriber.product_draft.refuse_notification.class:            PimEnterprise\Bundle\WorkflowBundle\EventSubscriber\ProductDraft\RefuseNotificationSubscriber
    pimee_workflow.event_subscriber.product_draft.remove_notification.class:            PimEnterprise\Bundle\WorkflowBundle\EventSubscriber\ProductDraft\RemoveNotificationSubscriber
    pimee_workflow.event_subscriber.product_draft.ensure_global_status.class:           PimEnterprise\Bundle\WorkflowBundle\EventSubscriber\ProductDraft\EnsureProductDraftGlobalStatusSubscriber
    pimee_workflow.subscriber.product_draft.exclude_deleted_attribute.class: PimEnterprise\Bundle\WorkflowBundle\EventSubscriber\ProductDraft\ORM\ExcludeDeletedAttributeSubscriber

services:
    ##
    # Published product events
    ##
    pimee_workflow.event_subscriber.published_product.check_removal:
        class: '%pimee_workflow.event_subscriber.published_product.check_removal.class%'
        arguments:
            - '@pimee_workflow.repository.published_product'
            - '@pimee_workflow.doctrine.query.published_product_query_builder_factory'
            - '@pim_catalog.repository.channel'
            - '@pim_catalog.repository.locale'
        tags:
            - { name: kernel.event_subscriber, priority: 255 }

    pimee_workflow.event_subscriber.published_product.detach_product:
        class: '%pimee_workflow.event_subscriber.published_product.detach_product.class%'
        arguments:
            - '@pim_catalog.object_manager.product'
            - '@doctrine.orm.entity_manager'
        tags:
            - { name: kernel.event_subscriber }

    ##
    # Import event subscribers
    ##
    pimee_workflow.event_subscriber.import.new_proposals:
        class: '%pimee_workflow.event_subscriber.import.new_proposals.class%'
        arguments:
            - '@pim_notification.notifier'
            - '@pim_user.repository.user'
            - '@pimee_workflow.provider.owner_groups'
            - '@pimee_workflow.provider.users_to_notify'
            - '@akeneo_batch.job.job_instance_repository'
            - '@pim_notification.factory.notification'
        tags:
            - { name: kernel.event_subscriber }

    ##
    # Product drafts event subscribers
    ##
    pimee_workflow.event_subscriber.product_draft.replace_flash_message:
        class: '%pimee_workflow.event_subscriber.product_draft.replace_flash_message.class%'
        arguments:
            - '@security.authorization_checker'
            - '@pim_catalog.repository.product'
        tags:
            - { name: kernel.event_subscriber }

    pimee_workflow.event_subscriber.product_draft.approve_notification:
        class: '%pimee_workflow.event_subscriber.product_draft.approve_notification.class%'
        arguments:
            - '@pim_notification.notifier'
            - '@pim_user.context.user'
            - '@pim_user.repository.user'
            - '@pim_catalog.repository.attribute'
            - '@pim_notification.factory.notification'
        tags:
            - { name: kernel.event_subscriber }

    pimee_workflow.event_subscriber.product_draft.refuse_notification:
        class: '%pimee_workflow.event_subscriber.product_draft.refuse_notification.class%'
        arguments:
            - '@pim_notification.notifier'
            - '@pim_user.context.user'
            - '@pim_user.repository.user'
            - '@pim_catalog.repository.attribute'
            - '@pim_notification.factory.notification'
        tags:
            - { name: kernel.event_subscriber }

    pimee_workflow.event_subscriber.product_draft.remove_notification:
        class: '%pimee_workflow.event_subscriber.product_draft.remove_notification.class%'
        arguments:
            - '@pim_notification.notifier'
            - '@pim_user.context.user'
            - '@pim_user.repository.user'
            - '@pim_catalog.repository.attribute'
            - '@pim_notification.factory.notification'
        tags:
            - { name: kernel.event_subscriber }

    pimee_workflow.event_subscriber.product_draft.send_for_approval:
        class: '%pimee_workflow.event_subscriber.product_draft.send_for_approval.class%'
        arguments:
            - '@pim_notification.notifier'
            - '@pim_user.repository.user'
            - '@pimee_workflow.provider.owner_groups'
            - '@pimee_workflow.provider.users_to_notify'
            - '@pim_notification.factory.notification'
        tags:
            - { name: kernel.event_subscriber }

    pimee_workflow.event_subscriber.product_draft.ensure_global_status:
        class: '%pimee_workflow.event_subscriber.product_draft.ensure_global_status.class%'
        tags:
            - { name: kernel.event_subscriber }

    pimee_workflow.subscriber.product_draft.exclude_deleted_attribute:
        class: '%pimee_workflow.subscriber.product_draft.exclude_deleted_attribute.class%'
        arguments:
            - '%pim_catalog.entity.attribute.class%'
        tags:
            - { name: doctrine.event_subscriber }
