parameters:
    pimee_security.updater.locale_access.class:           Akeneo\Pim\Permission\Component\Updater\LocaleAccessUpdater
    pimee_security.updater.product_category_access.class: Akeneo\Pim\Permission\Component\Updater\ProductCategoryAccessUpdater
    pimee_security.updater.attribute_group_access.class:  Akeneo\Pim\Permission\Component\Updater\AttributeGroupAccessUpdater
    pimee_security.updater.job_profile_access.class:      Akeneo\Pim\Permission\Component\Updater\JobProfileAccessUpdater

services:
    pimee_security.updater.locale_access:
        class: '%pimee_security.updater.locale_access.class%'
        arguments:
            - '@pim_user.repository.group'
            - '@pim_catalog.repository.locale'

    pimee_security.updater.product_category_access:
        class: '%pimee_security.updater.product_category_access.class%'
        arguments:
            - '@pim_user.repository.group'
            - '@pim_catalog.repository.product_category'

    pimee_security.updater.attribute_group_access:
        class: '%pimee_security.updater.attribute_group_access.class%'
        arguments:
            - '@pim_user.repository.group'
            - '@pim_catalog.repository.attribute_group'

    pimee_security.updater.job_profile_access:
        class: '%pimee_security.updater.job_profile_access.class%'
        arguments:
            - '@pim_user.repository.group'
            - '@akeneo_batch.job.job_instance_repository'

    pimee_catalog.security.updater.granted_product_model:
        class: 'Akeneo\Pim\Permission\Component\Updater\GrantedProductModelUpdater'
        decorates: pim_catalog.updater.product_model
        decoration_inner_name: pim_catalog.updater.product_model_with_values_permission
        arguments:
            - '@pim_catalog.updater.product_model_with_values_permission'
            - '@security.authorization_checker'
            - '@pim_catalog.comparator.filter.product_model'
            - '@pim_catalog.comparator.filter.product_model_field'
            - '@pim_catalog.comparator.filter.product_association'
            - ['categories']
            - ['associations', 'quantified_associations']

    pimee_catalog.security.updater.granted_product:
        class: 'Akeneo\Pim\Permission\Component\Updater\GrantedProductUpdater'
        decorates: pim_catalog.updater.product
        decoration_inner_name: pim_catalog.updater.product_with_values_permission # it uses a granted property setter, so permissions are used here...
        arguments:
            - '@pim_catalog.updater.product_with_values_permission'
            - '@security.authorization_checker'
            - '@pim_catalog.comparator.filter.product_field'
            - '@pim_catalog.comparator.filter.product_association'
            - '@pim_catalog.comparator.filter.product'
            - ['enabled', 'family', 'categories', 'groups']
            - ['associations', 'quantified_associations']

    pimee_catalog.security.updater.entity_with_granted_values_property_setter:
        class: 'Akeneo\Pim\Permission\Component\Updater\Setter\EntityWithGrantedValuesPropertySetter'
        decorates: pim_catalog.updater.property_setter
        decoration_inner_name: pim_catalog.updater.entity_with_values_property_setter_without_permission
        arguments:
            - '@pim_catalog.updater.entity_with_values_property_setter_without_permission'
            - '@security.authorization_checker'
            - '@pim_catalog.repository.cached_attribute'
            - '@pim_catalog.repository.cached_locale'

    pimee_catalog.security.updater.setter.granted_category_field:
        class: 'Akeneo\Pim\Permission\Component\Updater\Setter\GrantedCategoryFieldSetter'
        decorates: pim_catalog.updater.setter.category_field
        decoration_inner_name: pim_catalog.updater.category_field_without_permission
        arguments:
            - '@pim_catalog.updater.category_field_without_permission'
            - '@security.authorization_checker'
            - '@pimee_security.repository.category_access'
            - '@security.token_storage'
            - '@doctrine.orm.entity_manager'
            - ['categories']
        tags:
            - { name: 'pim_catalog.updater.setter' }

    pimee_catalog.security.updater.setter.granted_association_field:
        class: 'Akeneo\Pim\Permission\Component\Updater\Setter\GrantedAssociationFieldSetter'
        decorates: pim_catalog.updater.setter.association_field
        decoration_inner_name: pim_catalog.updater.association_field_without_permission
        arguments:
            - '@pim_catalog.updater.association_field_without_permission'
            - '@pim_catalog.repository.product_without_permission'
            - ['associations']
            - '@pim_catalog.repository.product_model_without_permission'
            - '@pimee_security.query.product_category_access'
            - '@pimee_security.query.product_model_category_access'
            - '@security.token_storage'
        tags:
            - { name: 'pim_catalog.updater.setter' }

    # CE overrides
    pim_catalog.updater.setter.association_field:
        class: 'Akeneo\Pim\Enrichment\Component\Product\Updater\Setter\AssociationFieldSetter'
        arguments:
            - '@pim_catalog.repository.product_without_permission'
            - '@pim_catalog.repository.product_model_without_permission'
            - '@pim_catalog.repository.group'
            - '@pim_catalog.association.two_way_association_updater'
            - '@pim_catalog.association.missing_association_adder'
            - '@pim_catalog.repository.association_type'
            - ['associations']
        tags:
            - { name: 'pim_catalog.updater.setter' }

    pim_catalog.updater.group:
        class: 'Akeneo\Pim\Enrichment\Component\Product\Updater\GroupUpdater'
        arguments:
            - '@pim_catalog.repository.group_type'
            - '@pim_catalog.repository.attribute'

    # CE overrides
    pim_catalog.updater.adder.association_field:
        class: '%pim_catalog.updater.adder.association_field.class%'
        arguments:
            - '@pim_catalog.repository.product_without_permission'
            - '@pim_catalog.repository.product_model_without_permission'
            - '@pim_catalog.repository.group'
            - '@pim_catalog.association.missing_association_adder'
            - '@pim_catalog.repository.association_type'
            - '@pim_catalog.association.two_way_association_updater'
            - [ 'associations' ]
        tags:
            - { name: 'pim_catalog.updater.adder' }
