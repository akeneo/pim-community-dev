parameters:
    env(DATA_QUALITY_INSIGHTS_JWT_VERIFYING_KEY): 'OXvfb6/iSYOgqD8w044j8PTMWDwbSKjgJDhrNu3NwAc='
    env(AKENEO_PIM_URL): ''
    env(PAPO_PROJECT_CODE_TRUNCATED): ''
    env(PAPO_PROJECT_CODE_HASHED): ''

services:
    Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Clock\SystemClock: ~

    Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Install\InitializeCriteriaEvaluation:
        public: true
        arguments:
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\FeatureFlag\DataQualityInsightsFeature'
            - '@database_connection'
            - '@akeneo.pim.automation.data_quality_insights.create_products_criteria_evaluations'

    Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Install\InitializeJobs:
        public: true
        arguments:
            - '@pim_enrich.repository.job_instance'
            - '@database_connection'

    akeneo.pim.automation.data_quality_insights.create_products_criteria_evaluations:
        class: Akeneo\Pim\Automation\DataQualityInsights\Application\CriteriaEvaluation\CreateCriteriaEvaluations
        public: true
        arguments:
            - '@akeneo.pim.automation.data_quality_insights.product_criteria_evaluation_registry'
            - '@akeneo.pim.automation.data_quality_insights.repository.product_criterion_evaluation'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Clock\SystemClock'

    akeneo.pim.automation.data_quality_insights.create_product_models_criteria_evaluations:
        class: Akeneo\Pim\Automation\DataQualityInsights\Application\CriteriaEvaluation\CreateCriteriaEvaluations
        public: true
        arguments:
            - '@akeneo.pim.automation.data_quality_insights.product_model_criteria_evaluation_registry'
            - '@akeneo.pim.automation.data_quality_insights.repository.product_model_criterion_evaluation'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Clock\SystemClock'

    akeneo.pim.automation.data_quality_insights.create_missing_products_criteria_evaluations:
        class: Akeneo\Pim\Automation\DataQualityInsights\Application\CriteriaEvaluation\CreateMissingCriteriaEvaluations
        arguments:
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Query\GetUpdatedProductsWithoutUpToDateEvaluationQuery'
            - '@akeneo.pim.automation.data_quality_insights.create_products_criteria_evaluations'

    akeneo.pim.automation.data_quality_insights.create_missing_product_models_criteria_evaluations:
        class: Akeneo\Pim\Automation\DataQualityInsights\Application\CriteriaEvaluation\CreateMissingCriteriaEvaluations
        arguments:
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Query\GetUpdatedProductModelsWithoutUpToDateEvaluationQuery'
            - '@akeneo.pim.automation.data_quality_insights.create_product_models_criteria_evaluations'

    akeneo.pim.automation.data_quality_insights.product_criteria_evaluation_registry:
        class: Akeneo\Pim\Automation\DataQualityInsights\Application\CriteriaEvaluationRegistry
        arguments:
            - !tagged akeneo.pim.automation.data_quality_insights.evaluate_product_criterion

    akeneo.pim.automation.data_quality_insights.product_model_criteria_evaluation_registry:
        class: Akeneo\Pim\Automation\DataQualityInsights\Application\CriteriaEvaluationRegistry
        arguments:
            - !tagged akeneo.pim.automation.data_quality_insights.evaluate_product_model_criterion

    Akeneo\Pim\Automation\DataQualityInsights\Application\CriteriaApplicabilityRegistry:
        arguments:
            - !tagged akeneo.pim.automation.data_quality_insights.evaluate_criterion_applicability

    Akeneo\Pim\Automation\DataQualityInsights\Application\AxisRegistry: ~

    akeneo.pim.automation.data_quality_insights.evaluate_products_pending_criteria:
        class: Akeneo\Pim\Automation\DataQualityInsights\Application\CriteriaEvaluation\EvaluatePendingCriteria
        arguments:
            - '@akeneo.pim.automation.data_quality_insights.repository.product_criterion_evaluation'
            - '@akeneo.pim.automation.data_quality_insights.product_criteria_evaluation_registry'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Application\CriteriaApplicabilityRegistry'
            - '@akeneo.pim.automation.data_quality_insights.query.get_product_pending_criteria_evaluations'
            - '@akeneo.pim.automation.data_quality_insights.query.get_evaluable_product_values'
            - '@logger'

    akeneo.pim.automation.data_quality_insights.evaluate_product_models_pending_criteria:
        class: Akeneo\Pim\Automation\DataQualityInsights\Application\CriteriaEvaluation\EvaluatePendingCriteria
        arguments:
            - '@akeneo.pim.automation.data_quality_insights.repository.product_model_criterion_evaluation'
            - '@akeneo.pim.automation.data_quality_insights.product_model_criteria_evaluation_registry'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Application\CriteriaApplicabilityRegistry'
            - '@akeneo.pim.automation.data_quality_insights.query.get_product_model_pending_criteria_evaluations'
            - '@akeneo.pim.automation.data_quality_insights.query.get_evaluable_product_model_values'
            - '@logger'

    akeneo.pim.automation.data_quality_insights.get_product_axes_rates:
        class: Akeneo\Pim\Automation\DataQualityInsights\Application\GetProductAxesRates
        arguments:
            - '@akeneo.pim.automation.data_quality_insights.query.get_up_to_date_latest_product_axes_rates'

    akeneo.pim.automation.data_quality_insights.get_product_model_axes_rates:
        class: Akeneo\Pim\Automation\DataQualityInsights\Application\GetProductAxesRates
        arguments:
            - '@akeneo.pim.automation.data_quality_insights.query.get_up_to_date_latest_product_model_axes_rates'

    akeneo.pim.automation.data_quality_insights.get_product_evaluation:
        class: Akeneo\Pim\Automation\DataQualityInsights\Application\GetProductEvaluation
        arguments:
            - '@akeneo.pim.automation.data_quality_insights.query.get_up_to_date_latest_product_evaluations'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Query\CachedGetLocalesByChannelQuery'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Application\AxisRegistry'

    akeneo.pim.automation.data_quality_insights.get_product_model_evaluation:
        class: Akeneo\Pim\Automation\DataQualityInsights\Application\GetProductEvaluation
        arguments:
            - '@akeneo.pim.automation.data_quality_insights.query.get_up_to_date_latest_product_model_evaluations'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Query\CachedGetLocalesByChannelQuery'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Application\AxisRegistry'

    Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Consistency\TitleFormattingService:
        arguments:
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Client\Franklin'
            - '@logger'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Consistency\TitleFormattingToken'

    Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Consistency\TitleFormattingToken:
        arguments:
            - '%env(DATA_QUALITY_INSIGHTS_JWT_VERIFYING_KEY)%'
            - '%env(AKENEO_PIM_URL)%'
            - '%kernel.project_dir%'
            - '%env(PAPO_PROJECT_CODE_TRUNCATED)%'
            - '%env(PAPO_PROJECT_CODE_HASHED)%'

    Akeneo\Pim\Automation\DataQualityInsights\Application\ComputeAxisRates:
        arguments:
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Query\CachedGetLocalesByChannelQuery'

    akeneo.pim.automation.data_quality_insights.consolidate_product_axes_rates:
        class: Akeneo\Pim\Automation\DataQualityInsights\Application\ConsolidateAxesRates
        arguments:
            - '@akeneo.pim.automation.data_quality_insights.query.get_latest_product_criteria_evaluations'
            - '@akeneo.pim.automation.data_quality_insights.repository.product_axis_rate'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Application\ComputeAxisRates'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Clock\SystemClock'

    akeneo.pim.automation.data_quality_insights.consolidate_product_model_axes_rates:
        class: Akeneo\Pim\Automation\DataQualityInsights\Application\ConsolidateAxesRates
        arguments:
            - '@akeneo.pim.automation.data_quality_insights.query.get_latest_product_model_criteria_evaluations'
            - '@akeneo.pim.automation.data_quality_insights.repository.product_model_axis_rate'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Application\ComputeAxisRates'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Clock\SystemClock'

    Akeneo\Pim\Automation\DataQualityInsights\Application\ConsolidateDashboardRates:
        arguments:
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Query\GetRanksDistributionFromProductAxisRatesQuery'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Query\GetAllCategoryCodesQuery'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Query\GetAllFamilyCodesQuery'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Repository\DashboardRatesProjectionRepository'

    Akeneo\Pim\Automation\DataQualityInsights\Application\PurgeOutdatedData:
        arguments:
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Repository\DashboardRatesProjectionRepository'
            - '@akeneo.pim.automation.data_quality_insights.repository.product_criterion_evaluation'
            - '@akeneo.pim.automation.data_quality_insights.repository.product_model_criterion_evaluation'
            - '@akeneo.pim.automation.data_quality_insights.repository.product_axis_rate'
            - '@akeneo.pim.automation.data_quality_insights.repository.product_model_axis_rate'

# PIM enrichment BC anti-corruption layers
    akeneo.pim.automation.calculate_product_completeness_of_required_attributes:
        class: Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Enrichment\CalculateProductCompleteness
        arguments:
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Query\GetProductIdentifierFromProductIdQuery'
            - '@pim_catalog.completeness.calculator'

    akeneo.pim.automation.calculate_product_completeness_of_non_required_attributes:
        class: Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Enrichment\CalculateProductCompleteness
        arguments:
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Query\GetProductIdentifierFromProductIdQuery'
            - '@akeneo.pim.automation.completeness_product_non_required_attributes_calculator'

    akeneo.pim.automation.completeness_product_non_required_attributes_calculator:
        class: Akeneo\Pim\Enrichment\Component\Product\Completeness\CompletenessCalculator
        arguments:
            - '@akeneo.pim.enrichment.completeness.query.get_product_masks'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Query\Completeness\GetNonRequiredAttributesMasksQuery'

    akeneo.pim.automation.calculate_product_model_completeness_of_required_attributes:
        class: Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Enrichment\CalculateProductModelCompleteness
        arguments:
            - '@akeneo.pim.enrichment.completeness.query.get_product_masks'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Query\Completeness\GetRequiredProductModelAttributesMaskQuery'
            - '@pim_catalog.repository.product_model_without_permission'

    akeneo.pim.automation.calculate_product_model_completeness_of_non_required_attributes:
        class: Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Enrichment\CalculateProductModelCompleteness
        arguments:
            - '@akeneo.pim.enrichment.completeness.query.get_product_masks'
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Query\Completeness\GetNonRequiredProductModelAttributesMaskQuery'
            - '@pim_catalog.repository.product_model_without_permission'

    Akeneo\Pim\Automation\DataQualityInsights\Application\CriteriaEvaluation\Consistency\TextChecker: '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Consistency\TextChecker\AspellChecker'
    Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Consistency\TextChecker\AspellChecker:
        arguments:
            $spellerProvider: '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Consistency\TextChecker\AspellSpellerProvider'
            $globalOffsetCalculator: '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Consistency\TextChecker\Result\AspellGlobalOffsetCalculator'
            $lineNumberCalculator: '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Consistency\TextChecker\Result\AspellLineNumberCalculator'
            $textCheckerDictionaryRepository: '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Repository\TextCheckerDictionaryRepository'

    Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Consistency\TextChecker\AspellSpellerProvider:
        arguments:
            - '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Consistency\TextChecker\AspellDictionary'
            - '@monolog.logger.quality'
            - '%env(ASPELL_BINARY_PATH)%'

    Akeneo\Pim\Automation\DataQualityInsights\Application\CriteriaEvaluation\Consistency\SupportedLocaleValidator: '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Consistency\TextChecker\SupportedLocale\ChainedSupportedLocaleValidator'
    Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Consistency\TextChecker\SupportedLocale\SupportedPrefixLocaleValidator:
        arguments:
            $allActivatedLocalesQuery: '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Query\GetAllActivatedLocalesQuery'
        tags:
            - { name: pimee_data_quality_insights.inner_supported_locale_validator }
    Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Consistency\TextChecker\SupportedLocale\SupportedPortugueseLocaleValidator:
        arguments:
            $allActivatedLocalesQuery: '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Persistence\Query\GetAllActivatedLocalesQuery'
        tags:
            - { name: pimee_data_quality_insights.inner_supported_locale_validator }
    Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Consistency\TextChecker\SupportedLocale\ChainedSupportedLocaleValidator:
        arguments:
            $supportedLocaleValidatorList: !tagged pimee_data_quality_insights.inner_supported_locale_validator

    Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Consistency\TextChecker\Result\AspellGlobalOffsetCalculator: ~
    Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Consistency\TextChecker\Result\AspellLineNumberCalculator: ~

    Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Consistency\TextChecker\ProductValueInDatabaseDictionarySource:
        public: true
        arguments:
            $db: '@database_connection'

    Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Consistency\TextChecker\AspellDictionaryLocalFilesystem: ~

    Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Consistency\TextChecker\AspellDictionary:
        arguments:
            $mountManager: '@oneup_flysystem.mount_manager'
            $clock: '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Clock\SystemClock'
            $localFilesystemProvider : '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Consistency\TextChecker\AspellDictionaryLocalFilesystem'
            $supportedLocaleValidator: '@Akeneo\Pim\Automation\DataQualityInsights\Application\CriteriaEvaluation\Consistency\SupportedLocaleValidator'

    Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Consistency\TextChecker\AspellDictionaryGenerator:
        public: true
        arguments:
            $aspellDictionary: '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Consistency\TextChecker\AspellDictionary'
            $supportedLocaleValidator: '@Akeneo\Pim\Automation\DataQualityInsights\Application\CriteriaEvaluation\Consistency\SupportedLocaleValidator'
            $clock: '@Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Clock\SystemClock'

    akeneo.pim.automation.data_quality_insights.get_product_title_suggestion:
        class: Akeneo\Pim\Automation\DataQualityInsights\Application\GetProductTitleSuggestion
        arguments:
            $getLatestCriteriaEvaluationsByProductIdQuery: '@akeneo.pim.automation.data_quality_insights.query.get_latest_product_criteria_evaluations'
            $getIgnoredProductTitleSuggestionQuery: '@akeneo.pim.automation.data_quality_insights.query.get_product_ignored_title_suggestion'

    akeneo.pim.automation.data_quality_insights.get_product_model_title_suggestion:
        class: Akeneo\Pim\Automation\DataQualityInsights\Application\GetProductTitleSuggestion
        arguments:
            $getLatestCriteriaEvaluationsByProductIdQuery: '@akeneo.pim.automation.data_quality_insights.query.get_latest_product_model_criteria_evaluations'
            $getIgnoredProductTitleSuggestionQuery: '@akeneo.pim.automation.data_quality_insights.query.get_product_model_ignored_title_suggestion'

    Akeneo\Pim\Automation\DataQualityInsights\Infrastructure\Structure\MapAttributeType: ~
